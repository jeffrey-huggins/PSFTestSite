function initSidebar(){$("#listing").html("");$("#title").text("Infection Control");$(".instruction").show();$("#Residents").val("");$("#editForm").html("");$("#listing").html("")}function updateTable(){var r=$("#occurredRangeFrom").val(),u=checkDate(r),t,i,n,f;if(u=="invalid")return alert("Error: Please enter a valid From Date (mm/dd/yyyy)"),!1;if(u=="infuture")return alert("Error: You can not have a From date that is in the future"),!1;if(t=$("#occuredRangeTo").val(),i=checkDate(t),i=="invalid")return alert("Error: Please enter a valid To Date (mm/dd/yyyy)"),!1;if(i=="infuture")return alert("Error: You can not have a To date that is in the future"),!1;n=$("#Residents option:selected").val();n!="0"&&n!=""&&($("#editForm").load(path+"InfectionControl/EditOrCreateInfectionVM?patientId="+n,loadEditForm),f=path+"InfectionControl/PatientInfo?="+n,$("#selectedResidentView").load(f,function(){$("#title").text("Infection Control for "+$("#residentName").text())}),$("#listing").load(path+"InfectionControl/GetInfectionList?patientId="+n+"&fromString="+encodeURIComponent(r)+"&toString="+encodeURIComponent(t),function(){$("#infectionTable").dataTable({bFilter:!1,bAutoWidth:!1,aaSorting:[[1,"desc"]],sDom:"frtS",iDisplayLength:-1});$("#infectionTable").on("click",".edit",function(n){n.preventDefault();$("#editForm").load(this.href,loadEditForm)});$("#infectionTable").on("click",".delete",function(n){n.preventDefault();var t=this.href;$.ajax({url:t,success:function(n){n.Success?updateTable():alert(n.data)},error:function(){alert("Server is not responding. Please reload page and try again")}})})}))}function wireupRecultureForm(){$("#addRecultureDate").on("click",function(){var n=$("#recultureTable"),t=n.dataTable().fnGetData().length;n.dataTable().fnAddData([getRecultureInputs(t),"<a href='#' class='removeReculture'>Remove<\/a>"]);n.find(".isDate").datepicker({onSelect:function(){$(this).parent().focus()}})});$("#recultureTable").on("click",".removeReculture",function(n){n.preventDefault();var t=$(this).closest("tr");t.hide();t.find("#deleteDate").val("true")});$("#recultureTable").find(".isDate").each(function(n,t){var i=$(t).closest("tr");i.attr("oldValue",$(t).val())});$("#recultureSave").on("click",function(){$("#recultureTable").find(".isDate").each(function(n,t){var i=$(t).closest("tr");i.attr("oldValue",$(t).val())});$("#recultureModal").dialog("close")})}function getRecultureInputs(n){var t="<input type='hidden' name='RecultureDates["+n+"].Reculture.ReCultureId' value='0'/>";return t+="<input type='hidden' name='RecultureDates["+n+"].DeleteDate' value='false' id='deleteDate' />",t+("<input type='text' name='RecultureDates["+n+"].Reculture.RecultureDate' class='isDate'/>")}function loadEditForm(){var n,t;$("#reculture").on("click",function(n){n.preventDefault();$("#recultureModal").dialog({modal:!0,close:function(){$("#recultureTable").find(".isDate").each(function(n,t){var i=$(t).closest("tr");$(t).val(i.attr("oldValue"));$(t).val()==""&&(i.hide(),i.find("#deleteDate").val("true"))});$("#recultureModal").dialog("destroy")}})});$("[type='checkbox']").removeAttr("data-val-required");$("[type='checkbox']").removeAttr("data-val");wireupRecultureForm();n=$("#Residents option:selected").val();$("#vaccinationList").load(path+"InfectionControl/GetVaccineList?patientId="+n,function(){var n=$("#vaccineTable").dataTable({bFilter:!1,bAutoWidth:!1,sScrollY:"100px",sDom:"frtS",iDisplayLength:-1,aoColumns:[null,{aDataSort:[4,1,0]},null,null,{bVisible:!1}]});n.fnSort([[1,"desc"]])});t=$("#Event_PatientIFCEventId").val();t=="0"&&$("#Event_OnsetDate").val("");$(".tableContainer").find("table").dataTable({bAutoWidth:!1,sScrollY:"150px",sDom:"rt",iDisplayLength:-1,aoColumns:[{bVisible:!1},null,{bSortable:!1}],aaSorting:[[0,"asc"]]});$("#recultureTable").dataTable({bAutoWidth:!1,sScrollY:"150px",sDom:"rt",iDisplayLength:-1});$(".filter").on("keyup",function(){var n=$(this).closest(".tableContainer"),t=n.find("[id$=Table]").dataTable();t.fnFilter("^"+$(this).val()+".*",1,!0)});$(".clearFilter").on("click",function(n){var t,i;n.preventDefault();t=$(this).closest(".tableContainer");t.find(".filter").val("");i=t.find("[id$=Table]").dataTable();i.fnFilter("^.*",1,!0)});$(".isDate").datepicker();$("#saveInfection").on("click",function(n){n.preventDefault();var t=$("#saveInfectionControl");t.valid()&&t.ajaxSubmit({dataType:"json",contentType:"application/json; charset=utf-8",success:function(n){n.success?updateTable():alert("Error: Event not found in database")},error:function(){alert("Server is not responding. Please reload page and try again")}})});$.validator.addMethod("table-count",function(n,t){var r=$(t).closest("div"),u=0,f,i;return r.find(".required").val()=="True"&&(u=1),f=parseInt($(t).val()),i=r.find(":checked").length,u<=i&&f>=i?!0:!1},"Make sure the proper number of items are checked.");$.validator.setDefaults({ignore:[]});$("#saveInfectionControl").removeData("validator");$("#saveInfectionControl").removeData("unobtrusiveValidation");$.validator.unobtrusive.parse($("#saveInfectionControl"));$("#saveInfectionControl").validate()}$("#sideBar").on("change","#Residents",function(){$("#Residents").val()!=""&&$("#Residents").val()!="0"?($(".instruction").hide(),updateTable()):($(".instruction").show(),$("#listing").html(""))});$("#sideBar").on("click","#lookbackUpdate",function(n){n.preventDefault();var i=getMomentDate($("#LookbackDate").val()),t=checkDate($("#LookbackDate").val());t=="invalid"?alert("Error: Please enter a valid Last Census Date (mm/dd/yyyy)"):t=="infuture"?alert("Error: You can not have a Census date that is in the future"):(ShowProgress(),$("#SideDDL").ajaxSubmit({url:path+"InfectionControl/UpdateSideBar",type:"POST",success:function(n){$("#sideBar").html(n);initSidebar()}}))});$("#sideBar").on("change","#Communities",function(){ShowProgress();$("#SideDDL").ajaxSubmit({url:path+"InfectionControl/UpdateSideBar",type:"POST",success:function(n){$("#sideBar").html(n);initSidebar()}})});$(".isDate").datepicker();$("#updateTable").on("click",updateTable);