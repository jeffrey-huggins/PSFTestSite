function PreparePage(){var n=$("#VaccinationHistoryTable").dataTable({bAutoWidth:!1,sScrollY:"300px",sDom:"rt",iDisplayLength:-1,aoColumns:[null,{aDataSort:[6,1,0]},null,null,{bSearchable:!1,bSortable:!1,sWidth:"40px"},{bSearchable:!1,bSortable:!1,sWidth:"40px"},{bVisible:!1}],oLanguage:{sEmptyTable:"No entries for date range selected"}});n.fnSort([[1,"desc"]]);$("#VaccinationHistoryTable").on("click","a.edit",function(n){n.preventDefault();var i=$(this).parents("tr")[0],t=$(this).closest("tr").attr("id");$.ajax({url:path+"Vaccination/GetVaccine",dataType:"json",cache:!1,type:"GET",data:{vaccineId:t},success:function(n){LaunchModal(n.PatientVaccine.VaccineTypeId,n)},error:function(){alert("Server is not responding. Please reload page and try again")}})});$("#VaccinationHistoryTable").on("click","a.delete",function(t){var i,r,u;t.preventDefault();i=confirm("Are you sure you want to delete?");i==!0&&(r=$(this).parents("tr")[0],u=$(this).closest("tr").attr("id"),$.ajax({url:path+"Vaccination/DeleteVaccine",cache:!1,type:"POST",data:{vaccineId:u},success:function(){n.fnDeleteRow(r)},error:function(){alert("Server is not responding. Please reload page and try again")}}))});$(function(){$("#ToDateRangeInvalid").val()=="1"&&alert('Error: Please enter a valid date in the Infection Date Range "To" Field (mm/dd/yyyy)');$("#FromDateRangeInvalid").val()=="1"&&alert('Error: Please enter a valid date in the Infection Date Range "From" Field (mm/dd/yyyy)');$("#ToDateRangeInFuture").val()=="1"&&alert('Error: Please enter a valid date that is not in the future in the Infection Date Range "To" Field');$("#FromDateRangeInFuture").val()=="1"&&alert('Error: Please enter a valid date that is not in the future in the Infection Date Range "From" Field');$("#FromAfterTo").val()=="1"&&alert('Error: You can not have the "From" Date after the "To" Date in the Infection Date Range Fields')});$(".isDate").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:-n.offsetHeight+"px",marginLeft:n.offsetWidth+"px"})}});$("#occurredRangeTo, #occurredRangeFrom").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:"5px",marginLeft:"0px"})}});$("#btnCreate").click(function(){LaunchModal($("#VaccineTypes").val())});SetupFluModal();SetupPneumoniaModal();SetupTBInitialModal();SetupTBAnnualModal()}function SetupFluModal(){var n=$("#flu");$("#btnSave_Flu").click(function(){ValidateFluForm(n)&&SaveVaccination($("form",n),function(){alert("Vaccination Record has been successfully saved.");$("#btnClose_Flu").click()},function(){alert("Vaccination Record save failure occurred!")})});$("#btnClear_Flu").click(function(){$("#VaccineId",n).val("");$("#VaccineDate_Flu",n).val("");$("#LotNumber_Flu",n).val("");$("#ConsentSignedFlg",n).prop("checked",!1);$("#OfferedRefusedFlg",n).prop("checked",!1);$("#OfferedRefusedDate_Flu",n).val("");$(".offeredRefusedDateShow",n).hide();$("#ImmunizationPriorToAdmissionFlg",n).prop("checked",!1)});$("#btnClose_Flu").click(function(){$(".modal, #flu").hide();$("#btnClear_Flu").click()});$("#OfferedRefusedFlg",n).click(function(){var t=$(this).is(":checked");t?$(".offeredRefusedDateShow",n).show():($(".offeredRefusedDateShow",n).hide(),$("#OfferedRefusedDate_Flu",n).val(""))})}function SetupPneumoniaModal(){var n=$("#pneumonia");$("#btnSave_Pneumonia").click(function(){ValidatePneumoniaForm(n)&&SaveVaccination($("form",n),function(){alert("Vaccination Record has been successfully saved.");$("#btnClose_Pneumonia").click()},function(){alert("Vaccination Record save failure occurred!")})});$("#btnClear_Pneumonia").click(function(){$("#VaccineId",n).val("");$("#PneumoniaVaccineTypes",n).val("");$("#VaccineDate_Pneumonia",n).val("");$("#NextDueDate",n).val("");$("#LotNumber_Pneumonia",n).val("");$("#ConsentSignedFlg",n).prop("checked",!1);$("#OfferedRefusedFlg",n).prop("checked",!1);$("#OfferedRefusedDate_Pneumonia",n).val("");$(".offeredRefusedDateShow",n).hide();$("#ImmunizationPriorToAdmissionFlg",n).prop("checked",!1)});$("#btnClose_Pneumonia").click(function(){$(".modal, #pneumonia").hide();$("#btnClear_Pneumonia").click()});$("#OfferedRefusedFlg",n).click(function(){var t=$(this).is(":checked");t?$(".offeredRefusedDateShow",n).show():($(".offeredRefusedDateShow",n).hide(),$("#OfferedRefusedDate_Pneumonia",n).val(""))})}function SetupTBInitialModal(){var n=$("#tb_initial");$("#btnSave_TB_Initial").click(function(){ValidateTBInitialForm(n)&&SaveVaccination($("form",n),function(){alert("Vaccination Record has been successfully saved.");$("#btnClose_TB_Initial").click()},function(){alert("Vaccination Record save failure occurred!")})});$("#btnClear_TB_Initial").click(function(){$("#VaccineId",n).val("");$("#ConsentSignedFlg",n).prop("checked",!1);$("#PPDStep1GivenDate",n).val("");$("#PPDStep1Site",n).val("");$("#PPDStep1ReadDate",n).val("");$("#PPDStep1ReactionFlg",n).prop("checked",!1);$("#PPDStep1ReactionMeasurement",n).val("");$(".reactionMeasurementStep1Show",n).hide();$("#PPDStep1LotNumber",n).val("");$("#PPDStep2GivenDate",n).val("");$("#PPDStep2Site",n).val("");$("#PPDStep2ReadDate",n).val("");$("#PPDStep2ReactionFlg",n).prop("checked",!1);$("#PPDStep2ReactionMeasurement",n).val("");$(".reactionMeasurementStep2Show",n).hide();$("#PPDStep2LotNumber",n).val("");$("#ChestXRayFlg_Y",n).prop("checked",!1);$("#ChestXRayFlg_N",n).prop("checked",!1);$("#ChestXRayFlg_NA",n).prop("checked",!0);$("#ChestXRayDate",n).val("");$("#ChestXRayQuestionnaireCompleteFlg",n).prop("checked",!1);$("#ChestXRayQuestionnaireCompleteDate",n).val("");$(".chestXRayDateShow",n).hide();$(".questionnaireShow",n).hide();$(".questionnaireDateShow",n).hide();$("#BMATFlg",n).prop("checked",!1);$("#BMATDate_Initial",n).val("");$(".bmatDateShow",n).hide()});$("#btnClose_TB_Initial").click(function(){$(".modal, #tb_initial").hide();$("#btnClear_TB_Initial").click()});$("#PPDStep1ReactionFlg",n).click(function(){var t=$(this).is(":checked");t?$(".reactionMeasurementStep1Show",n).show():($(".reactionMeasurementStep1Show",n).hide(),$("#PPDStep1ReactionMeasurement",n).val(""))});$("#PPDStep2ReactionFlg",n).click(function(){var t=$(this).is(":checked");t?$(".reactionMeasurementStep2Show",n).show():($(".reactionMeasurementStep2Show",n).hide(),$("#PPDStep2ReactionMeasurement",n).val(""))});$("#ChestXRayFlg_Y",n).click(function(){var t=$(this).is(":checked");t&&($(".chestXRayDateShow",n).show(),$(".questionnaireShow",n).hide(),$("#ChestXRayQuestionnaireCompleteFlg",n).prop("checked",!1),$("#ChestXRayQuestionnaireCompleteDate",n).val(""))});$("#ChestXRayFlg_N",n).click(function(){var t=$(this).is(":checked");t&&($(".questionnaireShow",n).show(),$(".chestXRayDateShow",n).hide(),$("#ChestXRayDate",n).val(""))});$("#ChestXRayFlg_NA",n).click(function(){var t=$(this).is(":checked");t&&($(".chestXRayDateShow",n).hide(),$("#ChestXRayDate",n).val(""),$(".questionnaireShow",n).hide(),$("#ChestXRayQuestionnaireCompleteFlg",n).prop("checked",!1),$("#ChestXRayQuestionnaireCompleteDate",n).val(""))});$("#ChestXRayQuestionnaireCompleteFlg",n).click(function(){var t=$(this).is(":checked");t?$(".questionnaireDateShow",n).show():($(".questionnaireDateShow",n).hide(),$("#ChestXRayQuestionnaireCompleteDate",n).val(""))});$("#BMATFlg",n).click(function(){var t=$(this).is(":checked");t?$(".bmatDateShow",n).show():($(".bmatDateShow",n).hide(),$("#BMATDate_Initial",n).val(""))})}function SetupTBAnnualModal(){var n=$("#tb_annual");$("#btnSave_TB_Annual").click(function(){ValidateTBAnnualForm(n)&&SaveVaccination($("form",n),function(){alert("Vaccination Record has been successfully saved.");$("#btnClose_TB_Annual").click()},function(){alert("Vaccination Record save failure occurred!")})});$("#btnClear_TB_Annual").click(function(){$("#VaccineId",n).val("");$("#ConsentSignedFlg",n).prop("checked",!1);$("#PPDGivenDate",n).val("");$("#PPDSite",n).val("");$("#PPDReadDate",n).val("");$("#PPDReactionFlg",n).prop("checked",!1);$("#PPDReactionMeasurement",n).val("");$(".reactionMeasurementShow",n).hide();$("#PPDLotNumber",n).val("");$("#QuestionnaireCompleteFlg",n).prop("checked",!1);$("#QuestionnaireCompleteDate",n).val("");$(".questionnaireShow",n).hide();$(".questionnaireDateShow",n).hide();$("#BMATFlg",n).prop("checked",!1);$("#BMATDate_Annual",n).val("");$(".bmatDateShow",n).hide()});$("#btnClose_TB_Annual").click(function(){$(".modal, #tb_annual").hide();$("#btnClear_TB_Annual").click()});$("#PPDReactionFlg",n).click(function(){var t=$(this).is(":checked");t?$(".reactionMeasurementShow",n).show():($(".reactionMeasurementShow",n).hide(),$("#PPDReactionMeasurement",n).val(""))});$("#QuestionnaireCompleteFlg",n).click(function(){var t=$(this).is(":checked");t?$(".questionnaireDateShow",n).show():($(".questionnaireDateShow",n).hide(),$("#QuestionnaireCompleteDate",n).val(""))});$("#BMATFlg",n).click(function(){var t=$(this).is(":checked");t?$(".bmatDateShow",n).show():($(".bmatDateShow",n).hide(),$("#BMATDate_Annual",n).val(""))})}function LaunchModal(n,t){var i;if(n==1)i=LaunchFluModal(t);else if(n==2)i=LaunchPneumoniaModal(t);else if(n==3)i=LaunchTBAnnualModal(t);else if(n==4)i=LaunchTBInitialModal(t);else return;$("#VaccineType",i).val(n)}function LaunchFluModal(n){var i=$("<div />"),t,r,u;return i.addClass("modal"),$("body").append(i),t=$("#flu"),t.show(),r=Math.max($(window).height()/2-t[0].offsetHeight/2,0),u=Math.max($(window).width()/2-t[0].offsetWidth/2,0),t.css({top:r,left:u}),n&&($("#VaccineId",t).val(n.PatientVaccineId),$("#VaccineDate_Flu",t).val(GetDateString(n.VaccineDate)),$("#LotNumber_Flu",t).val(n.LotNumber),$("#ConsentSignedFlg",t).prop("checked",n.PatientVaccine.ConsentSignedFlg),$("#OfferedRefusedFlg",t).prop("checked",n.PatientVaccine.OfferedRefusedFlg),n.PatientVaccine.OfferedRefusedFlg&&($(".offeredRefusedDateShow",t).show(),$("#OfferedRefusedDate_Flu",t).val(GetDateString(n.PatientVaccine.OfferedRefusedDate))),$("#ImmunizationPriorToAdmissionFlg",t).prop("checked",n.PatientVaccine.ImmunizationPriorToAdmissionFlg)),t}function LaunchPneumoniaModal(n){var i=$("<div />"),t,r,u;return i.addClass("modal"),$("body").append(i),t=$("#pneumonia"),t.show(),r=Math.max($(window).height()/2-t[0].offsetHeight/2,0),u=Math.max($(window).width()/2-t[0].offsetWidth/2,0),t.css({top:r,left:u}),n&&($("#VaccineId",t).val(n.PatientVaccineId),$("#PneumoniaVaccineTypes",t).val(n.VaccinePneumoniaTypeId),$("#VaccineDate_Pneumonia",t).val(GetDateString(n.VaccineDate)),$("#NextDueDate",t).val(GetDateString(n.NextDueDate)),$("#LotNumber_Pneumonia",t).val(n.LotNumber),$("#ConsentSignedFlg",t).prop("checked",n.PatientVaccine.ConsentSignedFlg),$("#OfferedRefusedFlg",t).prop("checked",n.PatientVaccine.OfferedRefusedFlg),n.PatientVaccine.OfferedRefusedFlg&&($(".offeredRefusedDateShow",t).show(),$("#OfferedRefusedDate_Pneumonia",t).val(GetDateString(n.PatientVaccine.OfferedRefusedDate))),$("#ImmunizationPriorToAdmissionFlg",t).prop("checked",n.PatientVaccine.ImmunizationPriorToAdmissionFlg)),t}function LaunchTBInitialModal(n){var i=$("<div />"),t,r,u;return i.addClass("modal"),$("body").append(i),t=$("#tb_initial"),t.show(),r=Math.max($(window).height()/3-t[0].offsetHeight/3,0),u=Math.max($(window).width()/2-t[0].offsetWidth/2,0),t.css({top:r,left:u}),n&&($("#VaccineId",t).val(n.PatientVaccineId),$("#ConsentSignedFlg",t).prop("checked",n.PatientVaccine.ConsentSignedFlg),$("#PPDStep1GivenDate",t).val(GetDateString(n.PPDStep1GivenDate)),$("#PPDStep1Site",t).val(n.PPDStep1SiteId==-1?"":n.PPDStep1SiteId),$("#PPDStep1ReadDate",t).val(GetDateString(n.PPDStep1ReadDate)),$("#PPDStep1ReactionFlg",t).prop("checked",n.PPDStep1ReactionFlg),n.PPDStep1ReactionFlg&&($("#PPDStep1ReactionMeasurement",t).val(n.PPDStep1ReactionMeasurementId),$(".reactionMeasurementStep1Show",t).show()),$("#PPDStep1LotNumber",t).val(n.PPDStep1LotNumber),$("#PPDStep2GivenDate",t).val(GetDateString(n.PPDStep2GivenDate)),$("#PPDStep2Site",t).val(n.PPDStep2SiteId==-1?"":n.PPDStep2SiteId),$("#PPDStep2ReadDate",t).val(GetDateString(n.PPDStep2ReadDate)),$("#PPDStep2ReactionFlg",t).prop("checked",n.PPDStep2ReactionFlg),n.PPDStep2ReactionFlg&&($("#PPDStep2ReactionMeasurement",t).val(n.PPDStep2ReactionMeasurementId),$(".reactionMeasurementStep2Show",t).show()),$("#PPDStep2LotNumber",t).val(n.PPDStep2LotNumber),IsFieldEmpty(n.ChestXRayFlg)?$("#ChestXRayFlg_NA",t).prop("checked",!0):n.ChestXRayFlg?($("#ChestXRayFlg_Y",t).prop("checked",!0),$("#ChestXRayDate",t).val(GetDateString(n.ChestXRayDate)),$(".chestXRayDateShow",t).show()):($("#ChestXRayFlg_N",t).prop("checked",!0),$("#ChestXRayQuestionnaireCompleteFlg",t).prop("checked",n.QuestionnaireCompleteFlg),$(".questionnaireShow",t).show(),n.QuestionnaireCompleteFlg&&($("#ChestXRayQuestionnaireCompleteDate",t).val(GetDateString(n.QuestionnaireCompleteDate)),$(".questionnaireDateShow",t).show())),$("#BMATFlg",t).prop("checked",n.BMATFlg),n.BMATFlg&&($("#BMATDate_Initial",t).val(GetDateString(n.BMATDate)),$(".bmatDateShow",t).show())),t}function LaunchTBAnnualModal(n){var i=$("<div />"),t,r,u;return i.addClass("modal"),$("body").append(i),t=$("#tb_annual"),t.show(),r=Math.max($(window).height()/2-t[0].offsetHeight/2,0),u=Math.max($(window).width()/2-t[0].offsetWidth/2,0),t.css({top:r,left:u}),n&&($("#VaccineId",t).val(n.PatientVaccineId),$("#ConsentSignedFlg",t).prop("checked",n.PatientVaccine.ConsentSignedFlg),$("#PPDGivenDate",t).val(GetDateString(n.PPDGivenDate)),$("#PPDSite",t).val(n.PPDSiteId==-1?"":n.PPDSiteId),$("#PPDReadDate",t).val(GetDateString(n.PPDReadDate)),$("#PPDReactionFlg",t).prop("checked",n.PPDReactionFlg),n.PPDReactionFlg&&($("#PPDReactionMeasurement",t).val(n.PPDReactionMeasurementId),$(".reactionMeasurementShow",t).show()),$("#PPDLotNumber",t).val(n.PPDLotNumber),$("#QuestionnaireCompleteFlg",t).prop("checked",n.QuestionnaireCompleteFlg),n.QuestionnaireCompleteFlg&&($("#QuestionnaireCompleteDate",t).val(GetDateString(n.QuestionnaireCompleteDate)),$(".questionnaireDateShow",t).show()),$("#BMATFlg",t).prop("checked",n.BMATFlg),n.BMATFlg&&($("#BMATDate_Annual",t).val(GetDateString(n.BMATDate)),$(".bmatDateShow",t).show())),t}function ValidateFluForm(n){var t=$("#VaccineDate_Flu",n).val(),r=$("#OfferedRefusedFlg",n).is(":checked"),i;if(!r&&IsFieldEmpty(t))return alert("Vaccine Date is a required field."),!1;if(!IsFieldEmpty(t)&&!IsDateValid(t))return alert("Vaccine Date must be in the format mm/dd/yyyy."),!1;if(IsDateFuture(t))return alert("Vaccine Date cannot be in the future."),!1;if(r){if(i=$("#OfferedRefusedDate_Flu",n).val(),IsFieldEmpty(i))return alert("Offered and Refused Date is a required field."),!1;if(!IsDateValid(i))return alert("Offered and Refused Date must be in the format mm/dd/yyyy."),!1;if(IsDateFuture(i))return alert("Offered and Refused Date cannot be in the future."),!1}return!0}function ValidatePneumoniaForm(n){var e=$("#PneumoniaVaccineTypes").val(),u,t,i,f,r;if(IsFieldEmpty(e))return alert("Vaccine Type is a required field."),!1;if(u=$("#ImmunizationPriorToAdmissionFlg",n).is(":checked"),!u&&e==1)return alert("Vaccine Type cannot be 'Unknown' unless immunization was prior to admission."),!1;if(t=$("#OfferedRefusedFlg",n).is(":checked"),i=$("#VaccineDate_Pneumonia",n).val(),!u&&!t&&IsFieldEmpty(i))return alert("Vaccine Date is a required field unless immunization was prior to admission."),!1;if(!IsFieldEmpty(i)&&!IsDateValid(i))return alert("Vaccine Date must be in the format mm/dd/yyyy."),!1;if(IsDateFuture(i))return alert("Vaccine Date cannot be in the future."),!1;if(f=$("#NextDueDate",n).val(),!t&&IsFieldEmpty(f))return alert("Next Due Date is a required field."),!1;if(!t&&!IsDateValid(f))return alert("Next Due Date must be in the format mm/dd/yyyy."),!1;if(t){if(r=$("#OfferedRefusedDate_Pneumonia",n).val(),IsFieldEmpty(r))return alert("Offered and Refused Date is a required field."),!1;if(!IsDateValid(r))return alert("Offered and Refused Date must be in the format mm/dd/yyyy."),!1;if(IsDateFuture(r))return alert("Offered and Refused Date cannot be in the future."),!1}return!0}function ValidateTBInitialForm(n){var r=$("#PPDStep1GivenDate",n).val(),c=$("#PPDStep1Site",n).val(),t=$("#PPDStep1ReadDate",n).val(),l=$("#PPDStep1ReactionFlg",n).is(":checked"),w=$("#PPDStep1ReactionMeasurement",n).val(),b=$("#PPDStep1LotNumber",n).val(),a=!IsFieldEmpty(r)||!IsFieldEmpty(c)||!IsFieldEmpty(t)||l||!IsFieldEmpty(b),f,e,h,o;if(a){if(IsFieldEmpty(r))return alert("PPD Step 1 Given Date is a required field."),!1;if(!IsDateValid(r))return alert("PPD Step 1 Given Date must be in the format mm/dd/yyyy."),!1;if(IsDateFuture(r))return alert("PPD Step 1 Given Date cannot be in the future."),!1;if(IsFieldEmpty(c))return alert("PPD Step 1 Site is a required field."),!1;if(!IsFieldEmpty(t)&&!IsDateValid(t))return alert("PPD Step 1 Read Date must be in the format mm/dd/yyyy."),!1;if(IsDateFuture(t))return alert("PPD Step 1 Read Date cannot be in the future."),!1;if(!IsFieldEmpty(t)&&(GetDateDiff(r,t)<2||GetDateDiff(r,t)>4))return alert("PPD Step 1 Read Date must be 2-4 days after the PPD Step 1 Given Date."),!1;if(l&IsFieldEmpty(w))return alert("PPD Step 1 Reaction Measurement is a required field."),!1}var u=$("#PPDStep2GivenDate",n).val(),v=$("#PPDStep2Site",n).val(),i=$("#PPDStep2ReadDate",n).val(),y=$("#PPDStep2ReactionFlg",n).is(":checked"),k=$("#PPDStep2ReactionMeasurement",n).val(),d=$("#PPDStep2LotNumber",n).val(),g=!IsFieldEmpty(u)||!IsFieldEmpty(v)||!IsFieldEmpty(i)||y||!IsFieldEmpty(d);if(g){if(IsFieldEmpty(u))return alert("PPD Step 2 Given Date is a required field."),!1;if(!IsDateValid(u))return alert("PPD Step 2 Given Date must be in the format mm/dd/yyyy."),!1;if(IsDateFuture(u))return alert("PPD Step 2 Given Date cannot be in the future."),!1;if(IsFieldEmpty(v))return alert("PPD Step 2 Site is a required field."),!1;if(!IsFieldEmpty(i)&&!IsDateValid(i))return alert("PPD Step 2 Read Date must be in the format mm/dd/yyyy."),!1;if(IsDateFuture(i))return alert("PPD Step 2 Read Date cannot be in the future."),!1;if(!IsFieldEmpty(i)&&(GetDateDiff(u,i)<2||GetDateDiff(u,i)>4))return alert("PPD Step 2 Read Date must be 2-4 days after the PPD Step 2 Given Date."),!1;if(y&IsFieldEmpty(k))return alert("PPD Step 2 Reaction Measurement is a required field."),!1}var p=$("#ChestXRayFlg_Y",n).is(":checked"),nt=$("#ChestXRayFlg_N",n).is(":checked"),s=!1;if(p){if(f=$("#ChestXRayDate",n).val(),IsFieldEmpty(f))return alert("Chest X-Ray Date Taken is a required field."),!1;if(!IsDateValid(f))return alert("Chest X-Ray Date Taken must be in the format mm/dd/yyyy."),!1;if(IsDateFuture(f))return alert("Chest X-Ray Date Taken cannot be in the future."),!1}if(nt&&(s=$("#ChestXRayQuestionnaireCompleteFlg",n).is(":checked"),s)){if(e=$("#ChestXRayQuestionnaireCompleteDate",n).val(),IsFieldEmpty(e))return alert("Questionnaire Complete Date is a required field."),!1;if(!IsDateValid(e))return alert("Questionnaire Complete Date must be in the format mm/dd/yyyy."),!1;if(IsDateFuture(e))return alert("Questionnaire Complete Date cannot be in the future."),!1}if(h=$("#BMATFlg",n).is(":checked"),h){if(o=$("#BMATDate_Initial",n).val(),IsFieldEmpty(o))return alert("BMAT Date is a required field."),!1;if(!IsDateValid(o))return alert("BMAT Date must be in the format mm/dd/yyyy."),!1;if(IsDateFuture(o))return alert("BMAT Date cannot be in the future."),!1}return!a&&!p&&!s&&!h?(alert("PPD Step 1, Chest X-Ray, Questionnaire or BMAT must be completed."),!1):!0}function ValidateTBAnnualForm(n){var i=$("#PPDGivenDate",n).val(),o=$("#PPDSite",n).val(),t=$("#PPDReadDate",n).val(),s=$("#PPDReactionFlg",n).is(":checked"),c=$("#PPDReactionMeasurement",n).val(),l=$("#PPDLotNumber",n).val(),h=!IsFieldEmpty(i)||!IsFieldEmpty(o)||!IsFieldEmpty(t)||s||!IsFieldEmpty(l),f,r,e,u;if(h){if(IsFieldEmpty(i))return alert("PPD Given Date is a required field."),!1;if(!IsDateValid(i))return alert("PPD Given Date must be in the format mm/dd/yyyy."),!1;if(IsDateFuture(i))return alert("PPD Given Date cannot be in the future."),!1;if(IsFieldEmpty(o))return alert("PPD Site is a required field."),!1;if(!IsFieldEmpty(t)&&!IsDateValid(t))return alert("PPD Read Date must be in the format mm/dd/yyyy."),!1;if(IsDateFuture(t))return alert("PPD Read Date cannot be in the future."),!1;if(!IsFieldEmpty(t)&&(GetDateDiff(i,t)<2||GetDateDiff(i,t)>4))return alert("PPD Read Date must be 2-4 days after the PPD Given Date."),!1;if(s&IsFieldEmpty(c))return alert("PPD Reaction Measurement is a required field."),!1}if(f=$("#QuestionnaireCompleteFlg",n).is(":checked"),f){if(r=$("#QuestionnaireCompleteDate",n).val(),IsFieldEmpty(r))return alert("Questionnaire Complete Date is a required field."),!1;if(!IsDateValid(r))return alert("Questionnaire Complete Date must be in the format mm/dd/yyyy."),!1;if(IsDateFuture(r))return alert("Questionnaire Complete Date cannot be in the future."),!1}if(e=$("#BMATFlg",n).is(":checked"),e){if(u=$("#BMATDate_Annual",n).val(),IsFieldEmpty(u))return alert("BMAT Date is a required field."),!1;if(!IsDateValid(u))return alert("BMAT Date must be in the format mm/dd/yyyy."),!1;if(IsDateFuture(u))return alert("BMAT Date cannot be in the future."),!1}return!h&&!f&&!e?(alert("PPD, Questionnaire or BMAT must be completed."),!1):!0}function SaveVaccination(n,t,i){$.ajax({url:$(n).attr("action"),dataType:"json",cache:!1,type:$(n).attr("method"),data:n.serialize(),success:function(i){UpdateVaccineHistoryTable(n,i);t&&t(i);$("#VaccineTypes").val("")},error:function(n){i?i(n):alert("Server is not responding. Please reload the page and try again")}})}function UpdateVaccineHistoryTable(n,t){var i=$("#VaccinationHistoryTable").dataTable(),u=GetRowData(t),f=$("#VaccineId",n).val(),r,e,o,s;f!=""?(r=document.getElementById(f),r!=null&&(e=i.fnGetPosition(r),i.fnUpdate(u,e),r.setAttribute("id",t.PatientVaccineId))):(o=i.fnAddData(u),s=i.fnSettings().aoData[o[0]].nTr,s.setAttribute("id",t.PatientVaccineId));i.fnSort([[1,"desc"]])}function GetRowData(n){return $("#IsEmployeeVaccine").val().toLowerCase()=="true"?[n.VaccineType.VaccineTypeName,IsFieldEmpty(n.VaccineDate)?"Prior to Admission":GetDateString(n.VaccineDate),n.OfferedRefusedFlg?"Yes":"No","",'<a class="edit" href="">Edit<\/a>','<a class="delete" href="">Delete<\/a>',IsFieldEmpty(n.VaccineDate)?"0":GetSortableDateString(n.VaccineDate)]:[n.VaccineType.VaccineTypeName,IsFieldEmpty(n.VaccineDate)?"Prior to Admission":GetDateString(n.VaccineDate),n.OfferedRefusedFlg?"Yes":"No",n.ConsentSignedFlg?"Yes":"No",'<a class="edit" href="">Edit<\/a>','<a class="delete" href="">Delete<\/a>',IsFieldEmpty(n.VaccineDate)?"0":GetSortableDateString(n.VaccineDate)]}function IsFieldEmpty(n){return n===""||n===null||n===undefined}function IsDateValid(n){return!IsFieldEmpty(n)&&ValidateDate(n)}function GetDateString(n){if(!IsFieldEmpty(n)){var t=new Date(n),i=t.getUTCMonth()+1,r=t.getUTCDate(),u=t.getUTCFullYear();return i+"/"+r+"/"+u}return""}function GetSortableDateString(n){if(!IsFieldEmpty(n)){var t=new Date(n),i=(t.getUTCMonth()+1).toString().padLeft(2,"0"),r=t.getUTCDate().toString().padLeft(2,"0"),u=t.getUTCFullYear().toString();return u+"-"+i+"-"+r}return""}function GetDateDiff(n,t){return moment(t).diff(moment(n),"days")}String.prototype.padLeft=function(n,t){return Array(n-String(this).length+1).join(t||"0")+this};