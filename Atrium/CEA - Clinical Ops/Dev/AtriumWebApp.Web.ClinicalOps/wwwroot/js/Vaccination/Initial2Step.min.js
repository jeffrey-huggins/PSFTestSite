function hideField(n,t){$(n).hide();$(n).rules("remove","required");$(n).removeClass("input-validation-error");$(n+"-error").remove();t&&$(n).closest(".row").hide()}function showField(n,t){$(n).show();$(n).rules("add","required");t&&$(n).closest(".row").show()}function toggleField(n,t,i){$(n).is(":checked")?showField(t,i):hideField(t,i)}function checkDayDifference(n,t,i,r){var f=getMomentDate(n),e=getMomentDate(t),u;return checkDateTime(f)!="ok"&&checkDateTime(e)!="ok"?!1:(u=f.diff(e,"days"),u<i||u>r)?!1:!0}$(document).ready(function(){$.validator.addMethod("items_required",function(){return inProgress("PPDSection")||inProgress("questionaireSection")||inProgress("BMATSection")||inProgress("xRaySection")?!0:!1},"PPD Step 1, Chest X-Ray, Questionnaire or BMAT must be completed.");$.validator.addMethod("PPD1_ReadDateValidation",function(n,t){var i=$("#VaccineDate").val();return this.optional(t)||checkDayDifference(n,i,2,4)},"Read Date must be 2-4 days after the given date");$.validator.addMethod("PPD2_ReadDateValidation",function(n,t){var i=$("#PPDStep2GivenDate").val();return this.optional(t)||checkDayDifference(n,i,2,4)},"Read Date must be 2-4 days after the given date");$.validator.setDefaults({ignore:[]});$("#saveTB2StepVaccine").removeData("validator");$("#saveTB2StepVaccine").removeData("unobtrusiveValidation");$.validator.unobtrusive.parse($("#saveTB2StepVaccine"));$("#saveTB2StepVaccine").validate();toggleField("#PPDStep1ReactionFlg","#PPDStep1ReactionMeasurementId",!0);toggleField("#PPDStep2ReactionFlg","#PPDStep2ReactionMeasurementId",!0);toggleField("#BMATFlg","#BMATDate");toggleField("#QuestionnaireCompleteFlg","#QuestionnaireCompleteDate");$("#PPDStep1ReactionFlg").on("change",function(){toggleField("#PPDStep1ReactionFlg","#PPDStep1ReactionMeasurementId",!0)});$("#PPDStep2ReactionFlg").on("change",function(){toggleField("#PPDStep2ReactionFlg","#PPDStep2ReactionMeasurementId",!0)});$("#QuestionnaireCompleteFlg").on("change",function(){toggleField("#QuestionnaireCompleteFlg","#QuestionnaireCompleteDate")});$("#BMATFlg").on("change",function(){toggleField("#BMATFlg","#BMATDate")});var n=$("input[id='ChestXRayFlg']:checked").val();n=="true"?(showField("#ChestXRayDate",!0),hideField("#QuestionnaireCompleteFlg",!0),$("#QuestionnaireCompleteFlg").change()):n=="false"?(hideField("#ChestXRayDate",!0),showField("#QuestionnaireCompleteFlg",!0),$("#ChestXRayDate").change()):(hideField("#ChestXRayDate",!0),hideField("#QuestionnaireCompleteFlg",!0),$("#QuestionnaireCompleteFlg").change(),$("#ChestXRayDate").change());$("input[id='ChestXRayFlg']").on("change",function(){var n=$(this).val();n=="true"?(showField("#ChestXRayDate",!0),hideField("#QuestionnaireCompleteFlg",!0),$("#QuestionnaireCompleteFlg").change()):n=="false"?(hideField("#ChestXRayDate",!0),showField("#QuestionnaireCompleteFlg",!0),$("#ChestXRayDate").change()):(hideField("#ChestXRayDate",!0),hideField("#QuestionnaireCompleteFlg",!0),$("#QuestionnaireCompleteFlg").change(),$("#ChestXRayDate").change())});$(".isDate").datepicker({onSelect:function(){$(this).valid();$("#saveVaccine").focus()}})});$("#saveVaccine").on("click",function(n){n.preventDefault();inProgress("PPDSection")?($("#VaccineDate").rules("add","required"),$("#PPDStep1SiteId").rules("add","required")):($("#VaccineDate").rules("remove","required"),$("#VaccineDate").removeClass("input-validation-error"),$("#VaccineDate-error").remove(),$("#PPDStep1SiteId").rules("remove","required"),$("#PPDStep1SiteId").removeClass("input-validation-error"),$("#PPDStep1SiteId-error").remove());inProgress("PPD2Section")?($("#PPDStep2GivenDate").rules("add","required"),$("#PPDStep2SiteId").rules("add","required")):($("#PPDStep2GivenDate").rules("remove","required"),$("#PPDStep2GivenDate").removeClass("input-validation-error"),$("#PPDStep2GivenDate-error").remove(),$("#PPDStep2SiteId").rules("remove","required"),$("#PPDStep2SiteId").removeClass("input-validation-error"),$("#PPDStep2SiteId-error").remove());var t=$("#saveTB2StepVaccine");t.valid()&&t.ajaxSubmit({success:function(n){n.success?($("#modal").dialog("close"),updateTable()):alert("Error: Vaccine not found in database")},error:function(){alert("Server is not responding. Please reload page and try again")}})});