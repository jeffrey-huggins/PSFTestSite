function ArchiveFlg(){var n=$("input#ArchiveFlg").prop("checked");n==!0&&($("input#ArchiveFlg").prop("checked",!0),$("input#AllArchiveFlg").prop("checked",!0),$("input[id^=ContractCommunities_][id$=__ArchiveFlg]").prop("checked",!0),$("input[id^=Documents_][id$=__ArchiveFlg]").prop("checked",!0))}function PreparePage(){function e(){var n={target:"#contractEditForm",success:function(n){try{var t=n;t.Success&&(window.location.replace(path+"ContractManagement/Contracts"),$("#contractEditForm").hide())}catch(i){}},error:function(){alert("Failure communicating with the server.")}};$("#contractEditForm").submit(function(){return $(this).ajaxSubmit(n),!1})}function l(){var n=!0;return $("#contractCommunities tbody tr").each(function(t,i){var r=$("[data-field='ContractRenewalId']",i).val(),u=$("[data-field='ContractTerminationNoticeId']",i).val(),f=$("[data-field='ContractPaymentTermId']",i).val(),e=r>0&&u>0&&f>0;n=n&&e}),n}function o(n,t){$.ajax({url:path+"/ContractManagement/IsProvider",type:"POST",data:{selectedCategoryId:n},datatype:"json",success:t})}function a(){var n=$("#contractCommunities");$("td:nth-child(7),th:nth-child(7)",n).hide()}function v(){var n=$("#contractCommunities");$("td:nth-child(7),th:nth-child(7)",n).fadeIn(1e3)}function y(){var n=$("#contractCommunities");$("td:nth-child(8),th:nth-child(8)",n).hide()}function p(){var n=$("#contractCommunities");$("td:nth-child(8),th:nth-child(8)",n).fadeIn(1e3)}function s(){a();y()}function h(){v();p()}function u(){$(".chosen-contract-select").chosen({placeholder_text_multiple:"Select Communities"});$("#CommunitySearchArea").hide(0);$("#ContractsGrid").hide(0)}function f(){b();var n=$(".SelectedCommunity");n.each(function(n,t){w(t)})}function w(n){var t=$(".SelectedCommunity :selected");t.each(function(t,i){var r=$(i).val(),u=$(i).parent();if(u.is(n))return!0;$("option[value='"+r+"']",n).attr("disabled","disabled")})}function b(){$(".SelectedCommunity option[disabled='disabled']").removeAttr("disabled")}function c(){var n=$("#ContractCategoryId").val();o(n,function(n){n?h():s()})}var i=0,n=$("#formContent"),r=!1,t;$("body").on("change","input#ArchiveFlg",function(){ArchiveFlg()});$("body").on("change","input#AllArchiveFlg",function(){$(this).prop("checked")==!0&&$("input[id^=ContractCommunities_][id$=__ArchiveFlg]").prop("checked",!0)});$("body").on("change","input[type=checkbox][id^=ContractCommunities_][id$=__ArchiveFlg]",function(n){n.preventDefault();$(this).prop("checked")==!1&&($("input#ArchiveFlg").prop("checked",!1),$("input#AllArchiveFlg").prop("checked",!1),$(this).prop("checked",!1))});$("body").on("change","input[id^=Documents_][id$=__ArchiveFlg]",function(){$(this).prop("checked")==!1&&$("input#ArchiveFlg").prop("checked",!1)});t=$("#contractsTable").dataTable({bAutoWidth:!1,sScrollY:"600px",sDom:"rt",iDisplayLength:-1,aaSorting:[[0,"desc"]],aoColumns:[{sWidth:"180px"},{sWidth:"20px"},{sWidth:"120px",aDataSort:[2,3]},{sWidth:"150px",aDataSort:[3,2]},{sWidth:"0px",bSortable:!1},{sWidth:"0px",bSortable:!1},{sWidth:"30px",bSortable:!1},{sWidth:"30px"},{sWidth:"10px",bSortable:!1},{sWidth:"10px",bSortable:!1}],oLanguage:{sEmptyTable:"No records within this range."}});$("#createContract").click(function(t){var i=$(this);t.preventDefault();$.ajax({url:i.attr("href"),success:function(t){n.html(t);InitializeDates();n.show();e();u(t);HideTableIfNoRows($("#contractDocuments"));HideTableIfNoRows($("#contractCommunities"))},error:function(){alert("Could not communicate with the server.")}})});$("#CommunitySelections").on("chosen:showing_dropdown",function(){r=!0});$("#CommunitySelections").on("chosen:hiding_dropdown",function(){r=!1;$("#CommunitySelections").trigger("change")});$("#CommunitySelections").on("change",function(n){if(!r){n.preventDefault();var t="";$("select option:selected").each(function(){t+=$(this).val()+" "});t!=""&&$("#CommunitySelectionForm").submit()}});n.on("change","#ContractCategoryId",function(n){n.preventDefault();$.ajax({url:path+"/ContractManagement/GetSubCategories",type:"POST",data:{selectedCategoryId:$(this).val()},datatype:"json",success:function(n){var t="";$.each(n,function(){t=t+'<option value="'+this.Id+'">'+this.Name+"<\/option>"});$("#ContractSubCategoryId").empty().append(t)}});var t=$(this).val();o(t,function(n){n?h():s()})});n.on("click","#contractDocuments .delete-item",function(n){n.preventDefault();$(this).closest("tr").remove()});n.on("click","#contractCommunities .delete-item",function(n){n.preventDefault();$(this).closest("tr").remove()});n.on("click","#addContractDocument",function(n){n.preventDefault();$.ajax({url:path+"/ContractManagement/CreateContractDocument",success:function(n){var t=$(n),r;ApplyUniqueItemIndex(t,i,"Documents");i++;r=$("#contractDocuments");$("#contractDocuments").append(t);InitializeDates();ShowTable($("#contractDocuments"))},error:function(){alert("Failure communicating with the server.")}})});n.on("click","#addContractCommunity",function(n){n.preventDefault();$.ajax({url:path+"/ContractManagement/CreateContractCommunity",cache:!1,success:function(n){var t=$(n),u=[],h,e,o,r,s;$(".SelectedCommunity :selected").each(function(n,t){u[n]=$(t).val()});h=$("#contractCommunities");$("#contractCommunities").append(t);e="ContractCommunity";ApplyUniqueItemIndex(t,i,e);i++;InitializeDates();ShowTable($("#contractCommunities"));o=$(".SelectedCommunity",t);r=[];$(".SelectedCommunity option",t).each(function(n,t){r[n]=$(t).val()});s=$(r).not(u);o.val(s.first());c();f()},error:function(){alert("Failure communicating with the server.")}})});n.on("change",".SelectedCommunity",function(){f()});n.on("change","#contractCommunities .columnValue",function(){var n=$(this),t=n.val(),i=n.data("field"),u=n.closest("table"),r=$('#contractCommunities tbody [data-field="'+i+'"]');r.each(function(n,i){var r=$(i);r.val()&&r.val()!=-1||r.val(t)})});n.on("click","#submitContract",function(n){var i,f,r;n.preventDefault();var u=$(this),t=u.closest("form"),e=t.attr("action");if($("#ErrorResult").empty(),i="Documents",$("#contractDocuments tbody tr").each(function(n){ApplyUniqueItemIndex($(this),n,i)}),i="ContractCommunities",f=!0,$("#contractCommunities tbody tr").each(function(n){ApplyUniqueItemIndex($(this),n,i)}),!l())return $("#ErrorResult").append("<li>Payment Term, Termination Notice, and Renewal must have a value selected for each community.<\/li>"),!1;r={target:"#contractEditForm",success:function(n){try{n.indexOf("<pre>")==0&&(n=n.substring(5,n.length-6));var i=$.parseJSON(n);i.Success?window.location.replace(path+"ContractManagement/Contracts"):t.html(i)}catch(r){t.html(n)}},error:function(){alert("Failure communicating with the server.")}};$(t).ajaxSubmit(r)});n.on("click","#clearContract",function(){window.location.replace(path+"ContractManagement/Contracts")});t.on("click",".deleteContract",function(n){var i=$(this);n.preventDefault();confirm("Are you sure you would like to delete this Contract?")&&$.ajax({url:i.attr("href"),type:"post",success:function(n){if(n.Success){var r=i.closest("tr"),u=r.get(0),f=t.fnGetPosition(u);t.fnDeleteRow(f)}SetCountDownTime(1800)},error:function(){alert("Could not communicate with the server.")}})});t.on("click",".editContract",function(t){var i=$(this);t.preventDefault();$.ajax({url:i.attr("href"),success:function(t){n.html(t);InitializeDates();n.show();e();u(t);f();HideTableIfNoRows($("#contractDocuments"));c()},error:function(){alert("Could not communicate with the server.")}})});t.on("click",".viewContract",function(t){var i=$(this);t.preventDefault();$.ajax({url:i.attr("href"),success:function(t){n.html(t);n.show();u(t);HideTableIfNoRows($("#contractDocuments"))},error:function(){alert("Could not communicate with the server.")}})})}