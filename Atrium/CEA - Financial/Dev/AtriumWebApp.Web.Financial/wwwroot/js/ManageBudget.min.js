function RefreshBudgetItemData(){var n={BudgetYear:$("#budgetYear").val(),CommunityId:$("#CurrentCommunity").val()},t=window.location.pathname+"/GetBudgetItemData/";$.ajax({url:t,type:"POST",data:n,success:function(n){var i=n,t=$("#budgetTable").dataTable();t.fnClearTable();t.fnAddData(i.BudgetItems);t.fnGetData()?($("#budget-total-cell").prop("textContent",Number(i.BudgetedAmount).formatMoney(2)),$("#budget-table-foot").removeClass("hidden")):$("#budget-table-foot").addClass("hidden")},error:function(){alert("Could not communicate with the server.")}})}function RefreshBudgetData(){var n={BudgetYear:$("#budgetYear").val(),CommunityId:$("#CurrentCommunity").val()},t=window.location.pathname+"/GetBudgetData/";$.ajax({url:t,type:"POST",data:n,success:function(n){var t=n;$("#BedCount").val(t.BedCount);$("#AmtPerBed").val(Number(t.AmtPerBed).toFixed(2));$("#EmergencyBudgetAmt").val(Number(t.EmergencyBudgetAmt).toFixed(2))},error:function(){alert("Could not communicate with the server.")}})}function ValidateBudgetItemFields(){return $("#budgetItemDescription").val()==""?(alert("Description cannot be blank."),!1):isNaN($("#budgetItemAmt").val())?(alert("Budget Amount must be a number."),!1):!0}function ClearBudgetItemFields(){$("#budgetItemId").val(0);$("#budgetItemCommunityId").val("");$("#budgetItemDescription").val("");$("#budgetItemComments").val("");$("#budgetItemAmt").val(Number(0).toFixed(2));$("#budgetItemIsSpecialProject").val(!1);$("#budgetItemIsSpecialProject").prop("checked",!1)}function SetupModal(){$("#btnModalSave").click(function(){var n=window.location.pathname+"/SaveEmergencyBudget/",t={BudgetYear:$("#budgetYear").val(),BudgetAmt:$("#EmergencyBudgetAmt").val()};$.ajax({url:n,dataType:"json",cache:!1,traditional:!0,type:"POST",data:t,success:function(){alert("Emergency Budget has been successfully saved.");$("#btnModalClose").click()},error:function(){alert("Emergency Budget save failure occurred!")}})});$("#btnModalClear").click(function(){$(".modal, #popupModal").hide()});$("#btnModalClose").click(function(){$(".modal, #popupModal").hide()})}function LaunchModal(){var t=$("<div />"),n,i,r;t.addClass("modal");$("body").append(t);n=$("#popupModal");n.show();i=Math.max($(window).height()/3-n[0].offsetHeight/3,0);r=Math.max($(window).width()/2-n[0].offsetWidth/2,0);n.css({top:i,left:r})}function PrepareBudgetTable(){var i=$("#formContent"),t=$("#budgetTable").dataTable({bAutoWidth:!1,sDom:"rt",iDisplayLength:-1,aoColumns:[{mData:"BudgetQtr",mRender:function(n){return"Q"+n},sWidth:"100px"},{mData:"Description",sWidth:"400px",aDataSort:[0,1]},{mData:"BudgetAmt",mRender:function(n){return Number(n).formatMoney(2)},sClass:"right",sWidth:"50px"},{mData:"Id",mRender:function(n){return'<a href="#"  class="edit-budget-item" data-budget-item-id="'+n+'">Edit<\/a>'},sWidth:"20px",bSortable:!1},{mData:"Id",mRender:function(n){return'<a href="#" class="delete-budget-item" data-budget-item-id="'+n+'" >Delete<\/a>'},sWidth:"30px",bSortable:!1}],oLanguage:{sEmptyTable:"No records"}}),n;$("#budgetYear").change(function(){$("#budgetYearTxt").val($("#budgetYear").val());$("#modalBudgetYearTxt").prop("textContent",$("#budgetYear").val());ClearBudgetItemFields();RefreshBudgetData();RefreshBudgetItemData()});t.on("click",".edit-budget-item",function(){var n=$(this),t=n.data("budget-item-id"),i=window.location.pathname+"/GetBudgetItem/"+t;$.ajax({url:i,success:function(n){var t=n;$("#budgetYear").val(t.BudgetYear);$("#budgetQuarter").val(t.BudgetQtr);$("#budgetItemId").val(t.Id);$("#budgetItemCommunityId").val(t.CommunityId);$("#budgetItemDescription").val(t.Description);$("#budgetItemComments").val(t.Comments);$("#budgetItemAmt").val(Number(t.BudgetAmt).toFixed(2));$("#budgetItemIsSpecialProject").val(t.IsSpecialProject);$("#budgetItemIsSpecialProject").prop("checked",t.IsSpecialProject);$("#commit-budget-item").removeClass();$("#commit-budget-item").addClass("update-budget-item");$("#commit-budget-item").text("Save Changes");$("#budgetItemView").removeClass("hidden")},error:function(){alert("Could not communicate with the server.")}})});t.on("click",".delete-budget-item",function(){var i=$(this),n,t;confirm("Are you sure you would like to delete this budget item?")&&(n=i.data("budget-item-id"),t=window.location.pathname+"/DeleteBudgetItem/"+n,$.ajax({url:t,success:function(){RefreshBudgetItemData()},error:function(){alert("Could not communicate with the server.")}}))});$("#saveBudgetData").click(function(){var n={BudgetYear:$("#budgetYear").val(),CommunityId:$("#CurrentCommunity").val(),BedCount:$("#BedCount").val(),AmtPerBed:$("#AmtPerBed").val()},t=window.location.pathname+"/SaveBudgetData/";$.ajax({url:t,type:"POST",data:n,success:function(){alert("Budget information saved.")},error:function(){alert("Could not communicate with the server.")}})});$(".add-budget-item").click(function(){var n=$(this);ClearBudgetItemFields();$("#budgetItemView").removeClass("hidden");$("#commit-budget-item").removeClass();$("#commit-budget-item").addClass("save-budget-item");$("#commit-budget-item").text("Save Budget Item")});$(".update-emergency-budget").click(function(){LaunchModal()});n=$("#budgetItemView");n.on("click",".save-budget-item",function(){var i=$(this),n,t;ValidateBudgetItemFields()&&(n={Id:$("#budgetItemId").val(),BudgetYear:$("#budgetYear").val(),BudgetQtr:$("#budgetQuarter").val(),CommunityId:$("#CurrentCommunity").val(),Description:$("#budgetItemDescription").val(),Comments:$("#budgetItemComments").val(),BudgetAmt:$("#budgetItemAmt").val(),IsSpecialProject:$("#budgetItemIsSpecialProject").prop("checked")},t=window.location.pathname+"/AddBudgetItem/",$.ajax({url:t,type:"POST",data:n,success:function(){ClearBudgetItemFields();$("#budgetItemView").addClass("hidden");alert("Budget item was successfully added.");RefreshBudgetItemData()},error:function(){alert("Could not communicate with the server.");$("#budgetItemView").removeClass("hidden")}}))});n.on("click",".update-budget-item",function(){var i=$(this),n,t;ValidateBudgetItemFields()&&(n={Id:$("#budgetItemId").val(),BudgetYear:$("#budgetYear").val(),BudgetQtr:$("#budgetQuarter").val(),CommunityId:$("#CurrentCommunity").val(),Description:$("#budgetItemDescription").val(),Comments:$("#budgetItemComments").val(),BudgetAmt:$("#budgetItemAmt").val(),IsSpecialProject:$("#budgetItemIsSpecialProject").prop("checked")},t=window.location.pathname+"/UpdateBudgetItem/",$.ajax({url:t,type:"POST",data:n,success:function(){ClearBudgetItemFields();$("#budgetItemView").addClass("hidden");alert("Budget item was successfully updated.");RefreshBudgetItemData()},error:function(){alert("Could not communicate with the server.");$("#budgetItemView").removeClass("hidden")}}))});$("#cancel-budget-item-changes").click(function(){ClearBudgetItemFields();$("#budgetItemView").addClass("hidden")});SetupModal();RefreshBudgetItemData()}Number.prototype.formatMoney=function(n,t,i){var u=this,n=isNaN(n=Math.abs(n))?2:n,t=t==undefined?".":t,i=i==undefined?",":i,e=u<0?"-":"",f=parseInt(u=Math.abs(+u||0).toFixed(n))+"",r=(r=f.length)>3?r%3:0;return e+(r?f.substr(0,r)+i:"")+f.substr(r).replace(/(\d{3})(?=\d)/g,"$1"+i)+(n?t+Math.abs(u-f).toFixed(n).slice(2):"")};