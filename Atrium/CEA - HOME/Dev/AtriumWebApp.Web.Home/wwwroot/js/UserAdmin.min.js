function initGeneralAccess(){$("#applicationAccess").DataTable({filter:!1,autoWidth:!0,scrollY:"400px",dom:"frtS",displayLength:-1,sorting:[[2,"asc"]],columns:[null,null,null,null],language:{sEmptyTable:"No Records"}});$("#currentCommunitiesContainer").find("table").DataTable({filter:!1,autoWidth:!0,scrollY:"400px",dom:"frtS",displayLength:-1,columns:[null,{searchable:!1,sortable:!1},{searchable:!1,sortable:!1},{searchable:!1,sortable:!1},{searchable:!1,sortable:!1}],language:{emptyTable:"No Records"}});$("#AllDelete").change(function(){$("#AllDelete").prop("checked")&&$(".deleteFlag").change();$("#AllDelete").prop("checked",!1)});$("#AllApps").change(function(){var n,t;$("#AllApps").prop("checked")&&(n=$(".appFlag:not(:checked)"),n.prop("checked",!0),n.change());$("#AllApps").prop("checked")||(t=$(".appFlag:checked"),t.prop("checked",!1),t.change())});$("#AllReport").change(function(){var n,t;$("#AllReport").prop("checked")&&(n=$(".reptFlag:not(:checked)"),n.prop("checked",!0),n.change());$("#AllReport").prop("checked")||(t=$(".reptFlag:checked"),t.prop("checked",!1),t.change())});$(".reptFlag").change(function(n){var t=$(n.currentTarget).closest("tr");updateGeneralAccess(t);$("#AllDelete").prop("checked",!1);$(n.currentTarget).prop("checked")||$("#AllReport").prop("checked",!1)});$(".appFlag").change(function(n){var t=$(n.currentTarget).closest("tr");updateGeneralAccess(t);$("#AllDelete").prop("checked",!1);$(n.currentTarget).prop("checked")||$("#AllApps").prop("checked",!1)});$(".deleteFlag").change(function(n){$("#AllApps").prop("checked",!1);$("#AllReport").prop("checked",!1);var t=$(n.currentTarget).closest("tr");t.find(".deleteFlag").prop("checked")&&(t.find(".reptFlag").prop("checked",!1),t.find(".appFlag").prop("checked",!1));deleteGeneralAccess(t)});$("#currentCommunitiesContainer").find("input").change(function(){var n=$("#applicationAccessContainer").find("table");$("#currentCommunitiesContainer").find(".reptFlag:checked").length>0||$("#currentCommunitiesContainer").find(".appFlag:checked").length?n.find(".highlight").find("input").prop("checked",!0):n.find(".highlight").find("input").prop("checked",!1)});$("#applicationAccess").find("tr").click(function(){$("#applicationAccess").find("tr").removeClass("highlight");$("#applicationAccess").find("tr").addClass("borderRow");$(this).addClass("highlight");$(this).removeClass("borderRow");$("#AllApps").prop("checked",!1);$("#AllDelete").prop("checked",!1);$("#AllReport").prop("checked",!1);getCommunities($(this).attr("appId"))})}function updateGeneralAccess(n){if(n.is(":visible")){var t=$("#UserList").val(),i=n.find(".reptFlag").prop("checked"),r=n.find(".appFlag").prop("checked"),u=n.attr("commid");$.ajax({url:path+"UserAdmin/UpdateUserAppAccess",type:"POST",data:{userId:t,appId:currentAppId,communityId:u,reportFlag:i,appFlag:r}}).done(function(t){t.Success&&(n.find(".notExists").hide(),n.find(".exists").show(),$("#applicationAccess .highlight").find(".exists").show(),$("#applicationAccess .highlight").find(".notExists").hide())}).fail(function(){alert("Unable to update row, try again")})}}function deleteGeneralAccess(n){var t=$("#UserList").val(),i=n.attr("commid");$.ajax({url:path+"UserAdmin/DeleteUserAppAccess",type:"POST",data:{userId:t,appId:currentAppId,communityId:i}}).done(function(t){t.Success&&(n.find(".exists").hide(),n.find(".notExists").show(),n.find(".appFlag").prop("checked",!1),n.find(".deleteFlag").prop("checked",!1),n.find(".reptFlag").prop("checked",!1),$("#communityTable .exists:visible").length==0&&($("#applicationAccess .highlight").find(".exists").hide(),$("#applicationAccess .highlight").find(".notExists").show()))}).fail(function(){alert("Unable to delete row, try again")})}function initObjectAccess(){$("#objectAccess").DataTable({filter:!1,autoWidth:!0,scrollY:"400px",dom:"frtS",displayLength:-1,sorting:[[2,"asc"],[1,"asc"]],columns:[null,null,null,null],language:{sEmptyTable:"No Records"}});$("#objectAccess").find("tr").click(function(){$("#objectAccess").find("tr").removeClass("highlight");$("#objectAccess").find("tr").addClass("borderRow");$(this).addClass("highlight");$(this).removeClass("borderRow");$("#AllObjDelete").prop("checked",!1);$("#AllObjAccess").prop("checked",!1);getObjectCommunities($(this).attr("objectid"))});$("#currentObjectCommunitiesContainer").find("table").DataTable({filter:!1,autoWidth:!0,scrollY:"400px",dom:"frtS",displayLength:-1,columns:[null,{searchable:!1,sortable:!1},{searchable:!1,sortable:!1},{searchable:!1,sortable:!1}],language:{emptyTable:"No Records"}});$("#AllObjDelete").change(function(){$("#AllObjDelete").prop("checked")&&$(".deleteObjFlag").change();$("#AllObjDelete").prop("checked",!1)});$("#AllObjAccess").change(function(){var n,t;$("#AllObjAccess").prop("checked")&&(n=$("#communityObjTable tr:visible .accessFlag:not(:checked)"),n.prop("checked",!0),n.change());$("#AllObjAccess").prop("checked")||(t=$("#communityObjTable tr:visible .accessFlag:checked"),t.prop("checked",!1),t.change())});$(".accessFlag").change(function(n){var t=$(n.currentTarget).closest("tr");updateObjectAccess(t);$("#AllObjDelete").prop("checked",!1);$(n.currentTarget).prop("checked")||$("#AllObjAccess").prop("checked",!1)});$(".deleteObjFlag").change(function(n){$("#AllObjAccess").prop("checked",!1);var t=$(n.currentTarget).closest("tr");deleteObjectAccess(t)});$("#currentObjectCommunitiesContainer").find("input").change(function(){var n=$("#objectAccessContainer").find("table");$("#currentObjectCommunitiesContainer").find(".accessFlag:checked").length>0?n.find(".highlight").find("input").prop("checked",!0):n.find(".highlight").find("input").prop("checked",!1)})}function updateObjectAccess(n){if(n.is(":visible")){var t=$("#UserList").val(),i=$("#objectAccessContainer").find(".highlight").attr("objectid"),r=n.find(".accessFlag").prop("checked"),u=n.attr("objcommid");$.ajax({url:path+"UserAdmin/UpdateUserObjectAccess",type:"POST",data:{userId:t,objectId:i,communityId:u,accessFlag:r}}).done(function(t){t.Success&&(n.find(".notExists").hide(),n.find(".exists").show(),$("#objectAccess .highlight").find(".exists").show(),$("#objectAccess .highlight").find(".notExists").hide())}).fail(function(){alert("Unable to update row, try again")})}}function deleteObjectAccess(n){var t=$("#UserList").val(),i=n.attr("objcommid"),r=$("#objectAccessContainer").find(".highlight").attr("objectid");$.ajax({url:path+"UserAdmin/DeleteUserObjectAccess",type:"POST",data:{userId:t,objectId:r,communityId:i}}).done(function(t){t.Success&&(n.find(".exists").hide(),n.find(".notExists").show(),n.find(".accessFlag").prop("checked",!1),n.find(".deleteObjFlag").prop("checked",!1),$("#communityObjTable .exists:visible").length==0&&($("#objectAccessContainer .highlight").find(".exists").hide(),$("#objectAccessContainer .highlight").find(".notExists").show()))}).fail(function(){alert("Unable to delete row, try again")})}function initAdminAccess(){$("#adminAccess").DataTable({filter:!1,autoWidth:!0,scrollY:"400px",dom:"frtS",displayLength:-1,sorting:[[2,"asc"]],columns:[null,null,null,null,null],language:{sEmptyTable:"No Records"}});$("#adminAccess").find(".deleteAdmin").click(function(){var n=$(this).closest("tr");deleteAdminAccess(n)});$("#adminAccess").find(".isAdmin").click(function(){var n=$(this).closest("tr");updateAdminAccess(n)})}function updateAdminAccess(n){if(n.is(":visible")){var t=$("#UserList").val(),i=n.find(".isAdmin").prop("checked"),r=n.attr("adminappid");$.ajax({url:path+"UserAdmin/UpdateUserAdminAccess",type:"POST",data:{userId:t,appId:r,isAdmin:i}}).done(function(t){t.Success&&(n.find(".notExists").hide(),n.find(".exists").show())}).fail(function(){alert("Unable to update row, try again")})}}function deleteAdminAccess(n){var t=$("#UserList").val(),i=n.attr("adminappid");$.ajax({url:path+"UserAdmin/DeleteUserAdminAccess",type:"POST",data:{userId:t,appId:i}}).done(function(t){t.Success&&(n.find(".exists").hide(),n.find(".notExists").show(),n.find(".isAdmin").prop("checked",!1),n.find(".deleteAdmin").prop("checked",!1))}).fail(function(){alert("Unable to delete row, try again")})}function resetPage(){window.ShowProgress();objectAccessChanged={};accessChanged={};createObjectcommunitySelector();getAdminAccess();$.when(getApplicationAccess(),getObjectAccess()).then(function(){var n=$("#applicationAccessContainer"),t=$("#objectAccessContainer"),i,r;n.find(".highlight").length>0?(i=n.find(".highlight").attr("appid"),getCommunities(i)):$("#communitySection").hide();t.find(".highlight").length>0?(r=t.find(".highlight").attr("objectid"),getObjectCommunities(r)):$("#objectCommunitySection").hide();window.HideProgress()})}function initPage(){initGeneralAccess();initObjectAccess();initAdminAccess();$("#userAutoList").focus(function(){previousUser=$("#userAutoList").val();$("#userAutoList").val("")});$("#userAutoList").blur(function(){$("#userAutoList").val()==""&&$("#userAutoList").val(previousUser)});$("#tabs").tabs({activate:function(n,t){var r=t.newPanel.find(".dataTable").filter(function(){return this.id!=""}),u;for(i=0;i<r.length;i++)u=$("#"+r[i].id).dataTable(),u.fnAdjustColumnSizing();t.newTab.find("a").attr("href")=="#Object"&&resetPage()}});$(".ui-tabs-nav").css("display","inline-block");$("#userAutoList").autocomplete({source:userList,select:function(n,t){n.preventDefault();objectAccessChanged=null;accessChanged=null;$("#UserList").val(t.item.value);$("#userAutoList").val(t.item.label);resetPage()}});getAdminAccess();getApplicationAccess();getObjectAccess()}function getAdminAccess(){window.ShowProgress();$("#adminAccess").find("input").prop("checked",!1);var n=$("#UserList").val();$.ajax({url:path+"UserAdmin/GetAdminAccess",type:"POST",data:{userId:n}}).done(function(n){for(var i,t=0;t<n.length;t++)i=n[t],$("#adminapplication"+i).find(".isAdmin").prop("checked",!0)}).always(function(){window.HideProgress()})}function getApplicationAccess(){window.ShowProgress();accessChanged={};$("#objectAccess tbody tr").hide();$("#applicationAccess").find(".exists").hide();$("#applicationAccess").find(".notExists").show();$("#applicationAccess").find("input").prop("checked",!1);var n=$("#UserList").val();return $.ajax({url:path+"UserAdmin/GetUserAppAccess",type:"POST",data:{id:n}}).done(function(n){for(var t,i=0;i<n.length;i++)t=n[i],$("#objectAccess [appid='"+t+"']").show(),$("#application"+t).find("input").prop("checked",!0),$("#application"+t).find(".notExists").hide(),$("#application"+t).find(".exists").show()}).always(function(){window.HideProgress()})}function getObjectAccess(){window.ShowProgress();objectAccessChanged={};$("#objectAccess").find("input").prop("checked",!1);$("#objectAccess").find(".notExists").show();$("#objectAccess").find(".exists").hide();var n=$("#UserList").val();return $.ajax({url:path+"UserAdmin/GetUserObjectAccess",type:"POST",data:{userId:n}}).done(function(n){for(var i,t=0;t<n.length;t++)i=n[t],$("#object"+i).find("input").prop("checked",!0),$("#object"+i).find(".notExists").hide(),$("#object"+i).find(".exists").show()}).always(function(){window.HideProgress()})}function getObjectCommunities(n){var u=objectAccessChanged["'"+n+"'"],o=$("#object"+n).attr("appid"),i,e;if(showObjectCommunities(o),$("#currentObjectCommunitiesContainer").find(".notExists").show(),$("#currentObjectCommunitiesContainer").find(".exists").hide(),u)for(createObjectcommunitySelector(),i=0;i<u.length;i++){var r=u[i],s=r.CommunityId,h=r.EnabledFlag,c=r.DeleteFlag,f=r.RowExists,t=$("[objcommid='"+s+"'");t.find(".accessFlag").prop("checked",h);t.find(".deleteObjFlag").prop("checked",c);f?(t.find(".notExists").hide(),t.find(".exists").show()):(t.find(".notExists").show(),t.find(".exists").hide());t.find(".rowExists").prop("checked",f)}else e=$("#UserList").val(),window.ShowProgress(),$.ajax({url:path+"UserAdmin/GetUserObjectCommunityAccess",type:"POST",data:{userId:e,objectId:n}}).done(function(n){var t;for(createObjectcommunitySelector(),t=0;t<n.length;t++){var u=n[t],r=n[t].CommunityId,i=$("[objcommid='"+r+"'");i.find(".accessFlag").prop("checked",n[t].EnabledFlag);i.find(".deleteObjFlag").prop("checked",n[t].DeleteFlag);i.find(".rowExists").prop("checked",n[t].RowExists);n[t].RowExists?(i.find(".notExists").hide(),i.find(".exists").show()):(i.find(".notExists").show(),i.find(".exists").hide())}}).always(function(){window.HideProgress()});$("#objectCommunitySection").show();$("#communityObjTable").DataTable().columns.adjust();currentObjId=n}function showObjectCommunities(n){var t=$("#UserList").val();$.ajax({url:path+"UserAdmin/GetUserCommunityAccess",type:"POST",data:{userId:t,appId:n}}).done(function(n){var t,i,r;for($("#communityObjTable tbody tr").hide(),t=0;t<n.length;t++)i=n[t].CommunityId,r=n[t].AppFlg,r&&$("#communityObjTable [objcommid='"+i+"']").show()})}function createObjectcommunitySelector(){$("#communityObjTable").find("input").prop("checked",!1)}function getCommunities(n){var u=accessChanged["'"+n+"'"],r,e;if($.ajax({url:path+"UserAdmin/GetCommunitiesForApp",type:"POST",data:{appId:n}}).done(function(n){var t,i;for($("#communityTable tr").hide(),$("#communityTable tr").removeClass("highlight"),t=0;t<n.CommunityIdList.length;t++)i=n.CommunityIdList[t],$("[commId='"+i+"']").show();$("#communityTable").DataTable().columns.adjust()}),$("#currentCommunitiesContainer").find(".notExists").show(),$("#currentCommunitiesContainer").find(".exists").hide(),u)for(createCommunitySelector(),r=0;r<u.length;r++){var i=u[r],o=i.CommunityId,s=i.AppFlg,h=i.ReportFlg,c=i.DeleteFlg,f=i.RowExists,t=$("[commId='"+o+"'");t.find(".appFlag").prop("checked",s);t.find(".reptFlag").prop("checked",h);t.find(".deleteFlag").prop("checked",c);t.find(".rowExists").prop("checked",f);f?(t.find(".notExists").hide(),t.find(".exists").show()):(t.find(".notExists").show(),t.find(".exists").hide())}else e=$("#UserList").val(),window.ShowProgress(),$.ajax({url:path+"UserAdmin/GetUserCommunityAccess",type:"POST",data:{userId:e,appId:n}}).done(function(n){var i;for(createCommunitySelector(),i=0;i<n.length;i++){var u=n[i],r=n[i].CommunityId,t=$("[commId='"+r+"']");t.is(":visible")||(t.addClass("highlight"),t.show());t.find(".appFlag").prop("checked",n[i].AppFlg);t.find(".reptFlag").prop("checked",n[i].ReportFlg);t.find(".deleteFlag").prop("checked",n[i].DeleteFlg);t.find(".rowExists").prop("checked",n[i].RowExists);n[i].RowExists?(t.find(".notExists").hide(),t.find(".exists").show()):(t.find(".notExists").show(),t.find(".exists").hide())}}).fail(function(){alert("Error retrieving user's community access")}).always(function(){window.HideProgress()});$("#communitySection").show();$("#communityTable").DataTable().columns.adjust();currentAppId=n}function createCommunitySelector(){$("#communityTable").find("input").prop("checked",!1)}var previousUser,objectAccessChanged,currentObjId,accessChanged,currentAppId;$(document).ajaxSend(function(){ShowProgress()});$(document).ajaxStop(function(){HideProgress()});initPage();