function initCommunities(){var n=$("#CommunityTable").dataTable({bFilter:!1,bAutoWidth:!1,fixedColumns:!1,sScrollY:"600px",sDom:"frtS",iDisplayLength:-1,oLanguage:{sEmptyTable:"No Communities"}});$(".checkboxReport").click(function(){var t=$(this),n=$(this).is(":checked"),i=$(this).attr("id"),r=$(this).parents("tr").children(":first-child").text();$.ajax({url:path+"Base/ChangeReportFlgCom",dataType:"json",cache:!1,type:"POST",data:{community:i,dFlag:n,appCode:"STNA"},success:function(i){i.Success||(t.prop("checked",!n),alert("Community report flag has failed to be enabled/disabled. Please try again and if you see this message repeatedly the server may be down."))}})});$(".checkboxPayer").click(function(){var t=$(this),n=$(this).is(":checked"),i=$(this).attr("id"),u=$(this).parents("tr").children(":first-child").text(),r=$(this).closest("tr").attr("id");$.ajax({url:path+"Base/ChangePayerIncludeFlg",dataType:"json",cache:!1,type:"POST",data:{community:r,dFlag:n,appCode:"STNA",payer:i},success:function(i){i.Success||(t.prop("checked",!n),alert("Community report flag has failed to be enabled/disabled. Please try again and if you see this message repeatedly the server may be down."))}})})}function initFacilities(){$("#training-facility-table").dataTable({bPaginate:!1,bLengthChange:!1,bFilter:!1,bSort:!1,bInfo:!1,bAutoWidth:!1});$("#training-facility-table").on("click",".edit",function(n){n.preventDefault();var t=this.href;$.ajax({url:t}).done(function(n){$("#facilityEditModal").html(n);$("#facilityEditModal form").validate();$("#facilityEditModal #ContactPhone").rules("add","phoneUS");initFacilityModal($("#facilityEditModal"))})})}function initTrainingAction(){var t=$("#training-action-item-table").dataTable({bPaginate:!1,bLengthChange:!1,bFilter:!1,bSort:!1,bInfo:!1,bAutoWidth:!1}),n=null;$("#training-action-item-table").on("click","a.delete",function(n){n.preventDefault();var i=$(this).parents("tr")[0],r=$(this).closest("tr").attr("id"),f=t.fnGetData(i),u=confirm("Are you sure you want to delete?");u&&$.ajax({url:path+"JSON/DeleteRowAdmin",dataType:"json",cache:!1,type:"POST",data:{rowId:r,appCode:"STNA",socCode:measureContextId},success:function(n){n.Success?t.fnDeleteRow(i):alert("Item has failed to be deleted. Please try again and if you see this message repeatedly the server may be down.")}})});$("#training-action-item-table").on("click","a.edit",function(i){var r,u,f;i.preventDefault();r=$(this).parents("tr")[0];n!==null&&n!=r?(restoreRow(t,n),editRow(t,r),n=r):n==r&&this.innerHTML=="Save"?(u=$(this).closest("tr").attr("id"),f=saveRowMeasure(t,n,u),f&&(n=null)):(editRow(t,r),n=r)});$("#training-action-item-table").on("click","a.cancel",function(n){n.preventDefault();var i=$(this).parents("tr")[0];restoreRow(t,i)})}function initTrainingDialog(){$("#facilityEditModal").on("click","input[type='submit']",function(n){n.preventDefault();var t=$("#facilityEditModal form"),r=$("#TrainingFacilityName").val(),i=$("#training-facility-table").dataTable();if(!t.valid())return!1;$.ajax({url:t.attr("action"),dataType:"json",type:"POST",data:t.serialize(),success:function(n){if(n.Success){var u=n.data.TrainingFacilityName,r=n.data.STNATrainingFacilityId,f=n.data.Address1,e=n.data.Address2,o=n.data.City,s=n.data.StateCd,h=n.data.ZipCode,c=n.data.ContactName,l=n.data.ContactPhone,a=n.data.ContactEmail,v=$("#training-facility-table").find("#"+r)[0],y=i.fnUpdate([u,f,e,o,s,h,c,l,a,'<a href= "'+path+"STNAAdmin/Edit/"+r+'" class="edit" > Edit<\/a > | <a class="select-communities" href="'+path+"STNAAdmin/GetCommunityAssociations/"+r+'">Associate Communities<\/a>'],v);t[0].reset();$("#facilityEditModal").dialog("close")}else console.log(n),alert(n.message)},error:function(){alert("Server is not responding. Please reload page and try again")}})});$("#facilityEditModal").on("click","input[type='button']",function(){$("#facilityEditModal form")[0].reset();$("#facilityEditModal").dialog("close")});$("#facilityCreateModal input[type='submit']").on("click",function(n){n.preventDefault();var t=$("#facilityCreateModal form"),r=$("#TrainingFacilityName").val(),i=$("#training-facility-table").dataTable();if(alreadyExist(r,i))return alert("Training Facility with that name already exists."),!1;if(!t.valid())return!1;$.ajax({url:t.attr("action"),dataType:"json",type:"POST",data:t.serialize(),success:function(n){if(n.Success){var u=n.data.TrainingFacilityName,r=n.data.STNATrainingFacilityId,f=n.data.Address1,e=n.data.Address2,o=n.data.City,s=n.data.StateCd,h=n.data.ZipCode,c=n.data.ContactName,l=n.data.ContactPhone,a=n.data.ContactEmail,v=i.fnAddData([u,f,e,o,s,h,c,l,a,'<a href= "'+path+"STNAAdmin/Edit/"+r+'" class="edit" > Edit<\/a > | <a class="select-communities" href="'+path+"STNAAdmin/GetCommunityAssociations/"+r+'">Associate Communities<\/a>']),y=i.fnSettings().aoData[v[0]].nTr;y.setAttribute("id",r);t[0].reset();$("#facilityCreateModal").dialog("close")}else console.log(n),alert(n.message)},error:function(){alert("Server is not responding. Please reload page and try again")}})});$("#facilityCreateModal input[type='button']").on("click",function(){$("#facilityCreateModal form")[0].reset();$("#facilityCreateModal").dialog("close")})}function initFacilityModal(n){var t=n.width(),i=n.height(),r,u;n.dialog({dialogClass:"",closeOnEscape:!0,modal:!0,open:function(n,t){$("div.loading").hide();$(".ui-dialog").css("width","0px");$(".ui-dialog").css("height","0px");$(".ui-dialog").css("top","-10px");$(".ui-dialog").css("left","-10px");$(".ui-dialog-titlebar-close",t.dialog|t).hide()}});n.find(".ui-resizable-handle").hide();n.dialog("open");r=Math.max($(window).height())/2-i/2;u=Math.max($(window).width())/2-t/2;n.css({top:r,left:u,width:t+"px",height:i+"px"})}function restoreRow(n,t){for(var r=n.fnGetData(t),u=$(">td",t),i=0,f=u.length;i<f;i++)n.fnUpdate(r[i],t,i,!1)}function editRow(n,t){var r=n.fnGetData(t),i=$(">td",t);i[0].innerHTML='<input type="text" size="60" value="'+r[0]+'"/>';i[1].innerHTML='<a class="edit" href="">Save<\/a> <a class="cancel" href="">Cancel<\/a>'}function saveRowMeasure(n,t,i){var r=$("input",t);$.ajax({url:path+"JSON/EditRowNameOrder",dataType:"json",cache:!1,type:"POST",data:{rowId:i,description:r[0].value,order:0,appCode:"STNA",socCode:measureContextId},success:function(i){i.Success&&(n.fnUpdate(r[0].value,t,0,!1),n.fnUpdate('<a class="edit" href="">Edit<\/a>',t,1,!1))},error:function(){alert("Server is not responding. Please reload page and try again")}})}function alreadyExist(n,t,i){var u,r,f;for(i||(i=0),u=t.dataTable().fnGetData(),r=0;r<u.length;r++)if(f=u[r][i],f.toLowerCase()===n.toLowerCase())return!0;return!1}function createCheckboxString(n,t,i,r){var u,f;return r&&(u="checked"),f='<input class="'+t+'" id="'+n+'" name="'+i+'" type="checkbox" value="'+r+'" '+u+">",f+('<input name="'+i+'" type="hidden" value="'+r+'">')}var measureContextId=10;$(document).ready(function(){$("#tabs").tabs();initCommunities();initFacilities();initTrainingAction();initTrainingDialog();$("#facilityCreateModal form").validate();$("#ContactPhone").rules("add","phoneUS");$("#newFacility").click(function(n){n.preventDefault();initFacilityModal($("#facilityCreateModal"))});$(".checkbox").click(function(){var t=$(this),n=$(this).is(":checked"),i=$(this).attr("id"),r=$(this).parents("tr").children(":first-child").text();$.ajax({url:path+"Base/ChangeDataFlgCom",dataType:"json",cache:!1,type:"POST",data:{community:i,dFlag:n,appCode:"STNA"},success:function(i){i.Success||(t.prop("checked",!n),alert("Community has failed to be enabled/disabled. Please try again and if you see this message repeatedly the server may be down."))}})});$("#SaveLookback").validate({rules:{LookbackDays:{required:!0,number:!0}}});var n=$("#communityAssocationModal"),t;$("#training-facility-table").on("click",".select-communities",function(i){i.preventDefault();$.ajax({url:this.href,success:function(i){var r=$("<div />"),u,f;r.addClass("modal");$("body").append(r);n.html(i);n.show();u=Math.max($(window).height()/2-n[0].offsetHeight/2,0);f=Math.max($(window).width()/2-n[0].offsetWidth/2,0);n.css({top:u,left:f});t=$("#selectedCommunities",n).dataTable({bFilter:!1,bAutoWidth:!1,sScrollY:"370px",sDom:"frtS",iDisplayLength:-1,aoColumns:[{sWidth:"500px"},{sWidth:"100px",bSortable:!1}],oLanguage:{sEmptyTable:"No Communities"}})},error:function(){alert("Could not communicate with the server.")}})});n.on("click","#close",function(){$(".modal").hide();n.hide()});n.on("change",".selectCommunity",function(){var i=$(this),n=$(this).is(":checked"),r=$(this).parents("tr")[0],u=$(this).closest("tr").attr("id"),e=t.fnGetData(r),f=$("#STNATrainingFacilityId").val();$.ajax({url:path+"STNAAdmin/ChangeCommunityAssociation",dataType:"json",cache:!1,type:"POST",data:{contractorId:f,communityId:u,isAssociated:n},success:function(t){t.Success||(i.prop("checked",!n),alert("Community has failed to be associated. Please try again and if you see this message repeatedly the server may be down."))},error:function(){alert("Error communicating with server.")}})});$("#tabs").tabs({activate:function(n,t){var r=t.newPanel.find(".dataTable").filter(function(){return this.id!=""}),u;for(i=0;i<r.length;i++)u=$("#"+r[i].id).dataTable(),u.fnAdjustColumnSizing()}})});$(document).ajaxSend(function(){ShowProgress()});$(document).ajaxComplete(function(){HideProgress()});