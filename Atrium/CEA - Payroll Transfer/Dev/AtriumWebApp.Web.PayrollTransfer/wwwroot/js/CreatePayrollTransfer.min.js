function validateEntry(n){isItemValid(n)==!1?n.addClass("invalid-item"):n.removeClass("invalid-item")}function resetNewItem(){$(".new-item #SourceCommunityId").val($("#Communities").val());$(".new-item #DestinationCommunityId").val($("#Communities").val());$(".new-item #EmployeeId").val("")}function updateGLAfterDateChange(n){var t=n.find("#EmployeeId").val(),i=n.find(".isDate").val();$.ajax({url:path+"PayrollTransfer/GetEmployeeLedgersForDate?employeeId="+t+"&transferDate="+i,success:function(t){var r=n.find("#SourceGeneralLedgerId"),e=r.val(),i,f,u;for(r.empty(),r.append($("<option><option>").attr("value","").text("Select a Job Role")[0].outerHTML),i=0;i<t.length;i++)f=t[i].AccountNbr+" - "+t[i].AccountName,u=t[i].GeneralLedgerId,e==u?r.append($("<option><option>").attr("value",u).attr("selected","selected").text(f)[0].outerHTML):r.append($("<option><option>").attr("value",u).text(f)[0].outerHTML)}})}function employeeItemChanged(){var n,t;$("#EmployeesDropdown").val()!=""&&(n=path+"PayrollTransfer/CreateOrEditPayrollTransfer?employeeId="+$("#EmployeesDropdown").val(),$(".payroll-transfer-item").length==0?$("#payroll-transfer-section").load(n,function(){$("#AddTransferItem").removeAttr("disabled");$("#savePayrollTransfer").removeAttr("disabled");$(".payroll-transfer-item").addClass("new-item");$(".payroll-transfer-item").addClass("isDirty");$(".isDate").datepicker("destroy");$(".isDate").datepicker({fixFocusIE:!1,onSelect:function(){this.fixFocusIE=!0},onClose:function(){this.fixFocusIE=!0;this.focus();var n=$(this).closest("form");updateGLAfterDateChange(n)},beforeShow:function(){var n=/*@cc_on!@*/!1||!!document.documentMode,i=!n&&!!window.StyleMedia,t;return(n||i)&&(n=!0),t=n?!this.fixFocusIE:!0,this.fixFocusIE=!1,t}})}):(t=$(".new-item"),$.get(n,function(n){t.find("#source").html($(n).find("#source").html());t.find("#DestinationGeneralLedgerId").val($(n).find("#DestinationGeneralLedgerId").val())})))}function communityItemChanged(){resetNewItem()}function deletePTI(n){var t,n;if($(".payroll-transfer-item").length<=1){alert("Cannot delete the last entry");return}n.addClass("deleteMe");t=n.find("#Id").val();t==0?(n.remove(),$(".new-item").length==0&&(n=$(".payroll-transfer-item")[0],editPTI($(n)))):$.ajax({url:path+"PayrollTransfer/Delete",type:"post",data:{id:t},success:function(){if($(".deleteMe").remove(),$(".new-item").length==0){var n=$(".payroll-transfer-item")[0];editPTI($(n))}},error:function(){alert("Error communicating with the server, try again later")}})}function editPTI(n){var t,i;$(".new-item").length>0&&(t=$(".new-item"),validateEntry(t),t.removeClass("new-item"));n.addClass("new-item");i=n.find("#SourceCommunityId").val();ptiEditedEmployee=n.find("#EmployeeId").val();$("#Communities").val(i);$("#Communities").change();ptiEdited=!0;$(document).ajaxComplete(function(){ptiEdited&&($("#EmployeesDropdown").val(ptiEditedEmployee),$("#EmployeesDropdown").change(),ptiEdited=!1)})}function saveListAndContinue(n){var i=$("fieldset").children(".isDirty"),r=[],t,u,f;for(x=0;x<i.length;x++)t=$(i[x]),isItemValid(t)==!1?t.addClass("invalid-item"):t.removeClass("invalid-item"),t.hasClass("invalid-item")||(u=t.closest("form"),f=u.ajaxSubmit(ptiSaved(t,n)),r.push(f));$(".invalid-item").length>0&&alert("Please validate entries highlighted red and try again.\nChanges to that item were not saved.");$.when.apply(null,r).done(function(){n||$(".invalid-item").length==0&&window.location.assign($("#returnUrl").attr("href"))})}function isItemValid(n){return parseInt(n.find("#EmployeeId").val())==0||n.find("#SourceCommunityId option:selected").val().trim().length==0||parseInt(n.find("#SourceCommunityId option:selected").val())==0||n.find("#SourceGeneralLedgerId option:selected").val().trim().length==0||parseInt(n.find("#SourceGeneralLedgerId option:selected").val())==0||n.find("#DestinationCommunityId option:selected").val().trim().length==0||parseInt(n.find("#DestinationCommunityId option:selected").val())==0||n.find("#DestinationGeneralLedgerId option:selected").val().trim().length==0||parseInt(n.find("#DestinationGeneralLedgerId option:selected").val())==0||n.find(".isDate").val().trim().length==0||ValidateDate(n.find(".isDate").val())==!1?!1:!0}var ptiEdited,ptiEditedEmployee,ptiSaved;$(document).ready(function(){$("#payroll-transfer-section").on("click",".edit",function(){editPTI($(this).closest(".payroll-transfer-item"))});$("#payroll-transfer-section").on("click",".delete",function(){deletePTI($(this).closest(".payroll-transfer-item"))});$("#payroll-transfer-section").on("change","input, select",function(){$(this).closest(".payroll-transfer-item").addClass("isDirty")});$(".source-community").val($("#Communities").val());$(".destination-community").val($("#Communities").val());$("#employeeProps").last().after("<p><b>General Ledger:<\/b><br /><span id='DDLGL'><\/span><\/p>");$("#Communities").change(communityItemChanged);$("#EmployeesDropdown").on("change",employeeItemChanged);$("#payroll-transfer-section").on("change","fieldset",function(n){var t;t=n.originalEvent==null?$(n.target).closest(".payroll-transfer-item"):$(n.originalEvent.target).closest(".payroll-transfer-item");validateEntry(t)});$("#payroll-transfer-section").on("blur",".payroll-transfer-item .isDate",function(n){var t=$(n.target);if(t.val().length==6){var i=t.val().substr(0,2),r=t.val().substr(2,2),u="20"+t.val().substr(4,2),f=i+"/"+r+"/"+u;t.val(f)}});$("#savePayrollTransfer").click(function(){saveListAndContinue(!1)});$("#cancel-button").click(function(n){n.preventDefault();var t=$("#returnUrl").attr("href");t.charAt(t.length-1)!="/"&&(t+="/");window.location.assign(t)});$("#AddTransferItem").click(function(){saveListAndContinue(!0)});$(function(){$(".isDate").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:-n.offsetHeight+"px",marginLeft:n.offsetWidth+"px"})}})})});ptiEdited=!1;ptiSaved=function(n,t){return function(i){if(i.success&&(n.find("#Id").val(i.data),n.removeClass("isDirty"),n.hasClass("new-item")&&t)){var r=path+"PayrollTransfer/CreateOrEditPayrollTransfer?employeeId="+n.find("#EmployeeId").val()+"&payrollTransferId="+i.data;$.get(r,function(t){$("#payroll-transfer-section").prepend(t);var r=n.find("#HourCnt").val(),u=n.find("#PayAmt").val(),i=$("#payroll-transfer-section").find(".payroll-transfer-item").first();i.find("#HourCnt").val(r);i.find("#PayAmt").val(u);i.addClass("new-item");i.addClass("isDirty");i.find("#Id").val(0);$(".isDate").datepicker({fixFocusIE:!1,onSelect:function(){this.fixFocusIE=!0},onClose:function(){this.fixFocusIE=!0;this.focus()},beforeShow:function(){var n=/*@!@*/!1||!!document.documentMode,i=!n&&!!window.StyleMedia,t;return(n||i)&&(n=!0),t=n?!this.fixFocusIE:!0,this.fixFocusIE=!1,t}});n.removeClass("new-item")})}}};