@using AtriumWebApp.Web.Base.Library
@using AtriumWebApp.Models


@{
    string RMULookbackDate;
    Context.Session.TryGetObject("RMULookbackDate", out RMULookbackDate);
    string RMUCurrentFacility;
    Context.Session.TryGetObject("RMUCurrentFacility", out RMUCurrentFacility);
    string RMUActiveShown;
    Context.Session.TryGetObject("RMUActiveShown", out RMUActiveShown);
    IList<Employee> RMUEmployeeListTerm;
    Context.Session.TryGetObject("RMUEmployeeListTerm", out RMUEmployeeListTerm);
    IList<Employee> RMUEmployeeList;
    Context.Session.TryGetObject("RMUEmployeeList", out RMUEmployeeList);
    string CensusDateInvalid;
    Context.Session.TryGetObject("CensusDateInvalid", out CensusDateInvalid);
    string CensusDateInFuture;
    Context.Session.TryGetObject("CensusDateInFuture", out CensusDateInFuture);
    IList<Community> RMUFacilityList;
    Context.Session.TryGetObject("RMUFacilityList", out RMUFacilityList);
    string RMUCurrentEmployeeIdString;
    Context.Session.TryGetObject("RMUCurrentEmployeeIdString", out RMUCurrentEmployeeIdString);
    string RMUCurrentEmployeeIdStringTerm;
    Context.Session.TryGetObject("RMUCurrentEmployeeIdStringTerm", out RMUCurrentEmployeeIdStringTerm);
    string RMUCurrentEmployeeName;
    Context.Session.TryGetObject("RMUCurrentEmployeeName", out RMUCurrentEmployeeName);
    string RMUCurrentEmployeeFacility;
    Context.Session.TryGetObject("RMUCurrentEmployeeFacility", out RMUCurrentEmployeeFacility);
    string RMUCurrentEmployeeDateHire;
    Context.Session.TryGetObject("RMUCurrentEmployeeDateHire", out RMUCurrentEmployeeDateHire);
    string RMUCurrentEmployeeDateTerm;
    Context.Session.TryGetObject("RMUCurrentEmployeeDateTerm", out RMUCurrentEmployeeDateTerm);
    string RMUCurrentEmployeeSSN;
    Context.Session.TryGetObject("RMUCurrentEmployeeSSN", out RMUCurrentEmployeeSSN);

}

<section class="left-column-picker" style="height: 800px">
    @Html.Label("Show Active Employees: ")@Html.CheckBox("Active")
    @using (Html.BeginForm("Lookback", "RMUnemployment", FormMethod.Post, new { id = "Lookback" }))
    {
        @Html.Label("Termination Date:")<br />
        @Html.TextBox("LookbackDate", RMULookbackDate, new { @class = "dateUS", size = "10" })
        @Html.Hidden("returnUrl", Context.UrlPath());
        @Html.Hidden("CurrentCommunity", RMUCurrentFacility, new { @class = "CurrentCommunity" })
        <input type="submit" value="Update" onclick="" /> 
    }
    @Html.Hidden("CensusDateInvalid", CensusDateInvalid)
    @Html.Hidden("CensusDateInFuture", CensusDateInFuture)

    @using (Html.BeginForm("SideDDL", "RMUnemployment", FormMethod.Post, new { id = "SideDDL" }))
    {
        @Html.Hidden("ActiveShown", (RMUActiveShown ?? "false"))

        @Html.Label("Community:")<br />
        @Html.DropDownList("Communities", RMUFacilityList as SelectList, new { id = "Communities" })
        <br />
        <br />
        @Html.Label("Employee:")<br />
        @Html.DropDownList("EmployeesTerm", RMUEmployeeListTerm as SelectList, "Select an Employee", new { id = "EmployeesTerm" })        
        @Html.DropDownList("Employees", RMUEmployeeList as SelectList, "Select an Employee", new { id = "Employees", style = "display:none;" })
        <br />
        @Html.Hidden("returnUrl", Context.UrlPath());
        @Html.Hidden("CurrentCommunity", RMUCurrentFacility, new { @class = "CurrentCommunity" })
    }
    @Html.Hidden("CurrentEmployeeId", RMUCurrentEmployeeIdString)
    @Html.Hidden("CurrentEmployeeIdTerm", RMUCurrentEmployeeIdStringTerm)

    @if (RMUCurrentEmployeeName == null)
    {
        <br />
        <div style="color: red; font-weight: bold;">Please choose an Employee</div>
    }
    <br />@Html.Label("","Current Employee", new { style = "font-weight: bold" })
    <p class="bold">
        Name/Community:
        <br />@RMUCurrentEmployeeName
        <br />@RMUCurrentEmployeeFacility
    </p>
    <p class="bold">Date of Hire: @RMUCurrentEmployeeDateHire</p>
    <p class="bold">Date of Termination: @RMUCurrentEmployeeDateTerm</p>
    <p class="bold">Social Security #: @RMUCurrentEmployeeSSN</p>
</section>

<script type="text/javascript">
    $(document).ready(function () {
        $("#LookbackDate").datepicker({
            beforeShow: function (textbox, instance) {
                instance.dpDiv.css({
                    marginTop: '10px',
                    marginLeft: '0px'
                });
            }
        });
        $(function () {
            if ($("#CensusDateInvalid").val() == "1") {
                alert("Error: Please enter a valid Last Census Date (mm/dd/yyyy)");
            }
            if ($("#CensusDateInFuture").val() == "1") {
                alert("Error: You can not have a Census date that is in the future");
            }
        });

        var currentCommunity = $("#CurrentCommunity").val();
        $("#Communities").val(currentCommunity);

        var currentResident = $("#CurrentEmployeeId").val();
        $("#Employees").val(currentResident);
        $("#Employees").change(function () {
            if ($(this).val() == "")
                return;
            $("#SideDDL").submit();
        });
        var currentResident = $("#CurrentEmployeeIdTerm").val();
        $("#EmployeesTerm").val(currentResident);
        $("#EmployeesTerm").change(function () {
            if ($(this).val() == "")
                return;
            $("#SideDDL").submit();
        });
        if ($("#ActiveShown").val() == 'true') {
            $("#Active").prop("checked", true);
            changeActive();
        }
        $("#Active").click(function () {
            changeActive();
        });
        $("#Communities").change(function () {
            ShowProgress();
            $.post(path + "RMUnemployment/ChangeCommunityForEmployee", { appCode: "RMU", facilityId: $("#Communities option:selected").val() }).done(function () {
                window.location.reload();
            });
        });

    });
    function changeActive() {
        if ($("#Active").is(":checked")) {
            $("#ActiveShown").val(true);
            $("#EmployeesTerm").hide();
            $("#Employees").show();
        } else {
            $("#ActiveShown").val(false);
            $("#EmployeesTerm").show();
            $("#Employees").hide();
        }

    }
</script>

