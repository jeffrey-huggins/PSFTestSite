function setupNoteSection(){var n=$("#Request_Requestid").val();$("#editNote").load(path+"RMMedicalRecords/EditOrCreateRecordNote?requestid="+n,setupNoteForm);$("#noteTableSection").load(path+"RMMedicalRecords/RMMRecordNotesList?requestid="+n,setupNoteList)}function setupNoteForm(){$("#submitNote").on("click",function(n){n.preventDefault();$.ajax({data:$("#editNote *").serialize(),url:path+"RMMedicalRecords/SaveRecordNote",success:function(n){n.success?setupNoteSection():alert(n.data)},error:function(){alert("Server is not responding. Please reload page and try again")}})})}function setupNoteList(){var n=$("#notesTable").dataTable({sDom:"rtS",bAutoWidth:!1,iDisplayLength:-1,aoColumns:[{sWidth:"40px"},{sWidth:"40px"},{sWidth:"75px"},{sWidth:"30px",bSortable:!1},{sWidth:"30px",bSortable:!1}],oLanguage:{sEmptyTable:"No notes for the claim"}});n.fnSort([[1,"desc"]]);$("#notesTable").on("click",".edit",function(n){n.preventDefault();$("#editNote").load(this.href,setupNoteForm)});$("#notesTable").on("click",".delete",function(n){n.preventDefault();$.ajax({url:this.href,success:function(n){n.success&&setupNoteSection()}})})}function refreshDocList(){var n=$("#Request_Requestid").val();$("#documentListSection").load(path+"RMMedicalRecords/DocumentList?requestid="+n,function(){$(".isDate").datepicker()})}function afterRecordLoaded(){$(".isDate").datepicker();var n=$("#Request_Requestid").val();n==""?$("#Request_OpenDate").val(""):($("#Request_LawSuitFiledFlg").is(":checked")&&$("#showLawsuit").show(),setupNoteSection());$("#saveRecord").on("click",function(n){n.preventDefault();var t=$("#formMRR");if(!t.valid())return!1;t.ajaxSubmit({method:"post",success:function(n){n.success?loadRecordsRequest():alert(n.data)},error:function(){alert("Server is not responding. Please reload page and try again")}})});$("#clearRecord").on("click",loadRecordsRequest);$("#newDocument").on("change",function(){var r,t,i,u;if($("#newDocument")[0].files.length!=0){for(r=$("#newDocument")[0].files,t=new FormData,i=0;i<r.length;i++)u=r[i],t.append("Document",u),t.append("Requestid",n);$.ajax({url:path+"RMMedicalRecords/SaveDocument",type:"POST",processData:!1,contentType:!1,dataType:"json",data:t,success:function(n){n.Success&&($("#newDocument").replaceWith($("#newDocument").val("").clone(!0)),refreshDocList())},error:function(){alert("Server is not responding. Please reload page and try again")}})}});$("#documentListSection").on("click",".deleteFile",function(n){n.preventDefault();$.ajax(this.href,{success:function(n){n.success&&refreshDocList()}})});$("#showLawsuit").on("click",function(n){n.preventDefault();showLawsuit()});$("#Request_LawSuitFiledFlg").on("change",function(){$(this).is(":checked")?(showLawsuit(),$("#showLawsuit").show()):$("#showLawsuit").hide()});$("#saveLawsuit").on("click",function(){$("#modal").dialog("close")});$("#clearLawsuit").on("click",function(){$("#modal input[type='text']").val("");$("#modal textarea").val("");$("#Request_DeathClaim").prop("checked",!1)})}function showLawsuit(){$("#modal").dialog({width:600,height:500,modal:!0,close:function(){$(this).dialog("destroy")}})}function loadRecordsRequest(){var n=$("#Residents option:selected").val(),t;n!=""&&(t=path+"RMMedicalRecords/RMMRecordList?patientId="+n,$("#recordList").load(t,function(){$("#recordTable").dataTable({sScrollY:"300px",sDom:"frtS",bFilter:!1,iDisplayLength:-1,oLanguage:{sEmptyTable:"No record requests for the patient"}});$("#recordTable").on("click",".edit",function(n){n.preventDefault();$("#editForm").load(this.href,afterRecordLoaded)});$("#recordTable").on("click",".delete",function(n){n.preventDefault();$.ajax({url:this.href,success:function(n){n.Success&&loadRecordsRequest()}})})}),$("#selectedResidentView").load(path+"RMMedicalRecords/PatientInfo?patientId="+n,function(){$("#title").text("Medical Records Request for "+$("#residentName").text())}),$("#editForm").load(path+"RMMedicalRecords/EditOrCreateRMMRecord?patientId="+n,afterRecordLoaded),$("#measuresSelection").show(),$(".instruction").hide())}function initSidebar(){$("#LookbackDate").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:"10px",marginLeft:"0px"})}});$("#Residents").val("");$("#title").text("Medical Records Request");$(".instruction").show();$("#window").html("")}$("#sideBar").on("change","#Residents",function(){loadRecordsRequest()});$("#sideBar").on("change","#Communities",function(){$("#editForm").html("");$("#recordList").html("");$(".instruction").show()});$("#sideBar").on("click","#lookbackUpdate",function(n){n.preventDefault();var t=moment($("#LookbackDate").val(),"MM/DD/YYYY",!0);t.isValid()||(t=moment($("#LookbackDate").val(),"M/DD/YYYY",!0));t.isValid()?moment().diff(t)<0?alert("Error: You can not have a Census date that is in the future"):(ShowProgress(),$("#SideDDL").ajaxSubmit({url:path+"RMMedicalRecords/UpdateSideBar",type:"POST",success:function(n){$("#sideBar").html(n);initSidebar()}})):alert("Error: Please enter a valid Last Census Date (mm/dd/yyyy)")});$("#sideBar").on("change","#Communities",function(){ShowProgress();$("#SideDDL").ajaxSubmit({url:path+"RMMedicalRecords/UpdateSideBar",type:"POST",success:function(n){$("#sideBar").html(n);initSidebar()}})});