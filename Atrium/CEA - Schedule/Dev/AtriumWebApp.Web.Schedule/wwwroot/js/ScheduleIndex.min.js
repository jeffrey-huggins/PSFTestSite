function LogErrorToServer(n,t,i){var r=n.map(function(n){return n.toString()||""}).join("\n"),u={severity:encodeURIComponent(t||2)||2,message:encodeURIComponent(i||"")||"",stackTrace:n!=null?encodeURIComponent(r):"NULL"};console.log("LogErrorToServer: msg=="+JSON.stringify(i||""));console.log("LogErrorToServer: stack=="+JSON.stringify(r||""));$.ajax({cache:!1,type:"POST",dataType:"html",contentType:"application/x-www-form-urlencoded; charset=utf-8",url:path+"Schedule/LogClientError",data:u,success:function(){SetCountDownTime(timeout)},error:function(n,t,i){alert("logErrorToServer: ERROR: RC="+n.statusCode+", RT="+n.statusText+", error="+JSON.stringify(t)+", error.text="+i+", data="+n.responseText)}}).always(function(){SetCountDownTime(timeout)})}function ConsoleLogCapture(n,t,i,r,u){var f="window.onerror: file=="+JSON.stringify(i||"")+"\nwindow.onerror: line, col=="+JSON.stringify(r||"")+", "+JSON.stringify(u||"")+"\nwindow.onerror: msg=="+JSON.stringify(t||"")+"\nwindow.onerror: stack=="+JSON.stringify(n||"");console!=null?(console.log("window.onerror: ============"),console.log(f),console.log("window.onerror: ============")):alert("window.onerror: error=="+(f||"null"))}function SetScheduleDIVMaxHeight(){var n=$(window).innerHeight(),t=n-665;$("[id=scheduleDIV]").css("maxHeight",295+t+"px");$(window).resize(function(){var n=$(window).innerHeight(),t=n-665;$("[id=scheduleDIV]").css("maxHeight",295+t+"px")})}function AddSlot(n,t,i){$.ajax({url:path+"Schedule/AddSlot",type:"post",data:{shift:t,generalLedgerId:n}}).done(function(n){var f;$("#SlotEdit").html(n);var e=$("#slotNbr").val(),u=$("#slotId").val(),r=$("#blankRow").html();r=replaceAll(r,"@slot.SlotNbr",e);r=replaceAll(r,"@type",i);r=replaceAll(r,"@shift",t);r=replaceAll(r,"@slot.Id",u);f=$("#"+t+"\\/_"+i);f.find("#slotTd").append(r);$("[slotid='"+u+"']").click(EditSlot);InitSlotEditModal();SetCountDownTime(timeout)})}function replaceAll(n,t,i){return n.replace(new RegExp(t,"g"),i)}function RemoveSlot(n){$.ajax({url:path+"Schedule/RemoveSlot",type:"post",data:{slotId:n}}).done(function(){var t=$($("[slotid='"+n+"']").closest("tr")[0]);t.remove();SetCountDownTime(timeout);$("#summaryTable").addClass("NotSaved")})}function EditSlot(n){globalEvent=n;var t=n.currentTarget.attributes.slotid.value;$.ajax({url:path+"Schedule/EditSlot",type:"post",data:{slotId:t}}).done(function(n){$("#SlotEdit").html(n);CalculateDayHours();InitSlotEditModal()})}function CloseEditSlotWindow(){$(".ui-dialog-content").dialog("close")}function GetDailyValues(n){for(var r,u,i="",t=1;t<=14;t++)r=$("#date"+t).val(),u=$("#"+n+t).val(),i+=r+";"+u+",";return i}function SaveSlotEdit(){$("#SlotEdit").hide();CloseEditSlotWindow();var n=$("#slotId").val(),o=$("#slotNbr").val(),r=GetDailyValues("startShift"),u=GetDailyValues("endShift"),f=GetDailyValues("Room"),e=GetDailyValues("hourCount"),t=$("#Employees").val(),i=$("#Employees option:selected").text();$.ajax({cache:!1,type:"POST",contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:"html",url:path+"Schedule/SaveSlotEdit",data:{slotId:n,employeeId:t,startShifts:r,endShifts:u,rooms:f,hourCount:e},success:function(){var u=$($("[slotid='"+n+"']").closest("tr")[0]),y=u.closest(".shiftSlotRow")[0].id.split("/")[0],p=u.closest(".shiftSlotRow")[0].id.split("_")[1],h=u.find(".slotEmpNm").attr("employeeid"),w=u.find(".slotEmpNm").text().trim(),b=t,c=null,l,f,r,o;for(h&&(c=parseFloat($("#EMP\\/"+h).val().trim())),l=0,u.find(".slotEmpNm").text(i),i!="Unassigned"?u.removeClass("highlight"):u.addClass("highlight"),f=u.find(".day"),r=1;r<f.length+1;r++){var a=$("#Room"+r+" option:selected").text(),s=$("#startShift"+r+" option:selected"),v=$("#endShift"+r+" option:selected").text(),e=parseFloat($("#hourCount"+r).val());isNaN(e)&&(e=0);o=s.text();s.val()<0&&(o=$("#hourMap-"+s.val()).text(),e=o);$($(f[r-1]).find("label")[0]).text(o);$($(f[r-1]).find("label")[1]).text(v);$($(f[r-1]).find("label")[2]).text(e);$($(f[r-1]).find("label")[3]).text(a)}$("#summaryTable").addClass("NotSaved");SetCountDownTime(timeout)},error:function(){document.getElementById("SlotEdit").innerHTML="";$("#SlotEdit").hide()}}).always(function(){$("#SlotEdit").hide()})}function PrepareCommunityAndPayPeriodSelectors(){$("#CurrentCommunity").off("change");$("#CurrentCommunity").on("change",function(n){$("#employeeJobInfo").load(path+"Schedule/GetEmployeeJobs?communityId="+$(this).val(),function(){});$("#PayPeriod").datepicker("setDate",null);CurrentPayPeriodDates(this);CommunityAndWeekSelected(n)});$("#PayPeriod").off("change");$("#PayPeriod").on("change",function(n){n.preventDefault();CommunityAndWeekSelected(n)});$("#PayPeriod").off("click");$("#PayPeriod").on("click",function(n){n.preventDefault();$("#PayPeriod").datepicker().css("display","");(PayPeriodDates==undefined||PayPeriodDates==null)&&(CurrentPayPeriodDates(this),$("#PayPeriod").datepicker("destroy"),$("#PayPeriod").datepicker("refresh"))})}function CurrentPayPeriodDates(){$("#PayPeriod").prop("disabled",!0);$.ajax({cache:!1,type:"GET",contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:"json",url:path+"Schedule/CurrentPayPeriodDates",data:{communityId:$("#CurrentCommunity").val()},success:function(n){$("#PayPeriodWarning").hide();$("#PayPeriod").removeAttr("disabled");var t=n;if(t.Success&&t.PayPeriodBeginDates!=undefined&&t.PayPeriodBeginDates.length>0)return PayPeriodDates=t.PayPeriodBeginDates.split(","),$("#PayPeriod").datepicker({beforeShowDay:function(n){var t=$.datepicker.formatDate("yymmdd",n);return $.inArray(t,PayPeriodDates)>-1?[!0]:[!1,""]},showOnFocus:function(){!0}}),InitializeDates(),PayPeriodDates;PayPeriodDates=null;$("#PayPeriod").datepicker({beforeShowDay:function(n){var t=$.datepicker.formatDate("yymmdd",n);return $.inArray(t,PayPeriodDates)>-1?[!0]:[!1,""]},showOnFocus:function(){!0}});$("#PayPeriod").prop("disabled",!0);$("#PayPeriodWarning").show()},error:function(n,t,i){alert("CurrentPayPeriodDates: ERROR: data="+n.responseText+", RC="+n.statusCode+", RT="+n.statusText+", error="+JSON.stringify(t)+", error.text="+i)}}).always(function(){})}function InitializeDates(){$(".isDate").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:-n.offsetHeight+"px",marginLeft:n.offsetWidth+"px"})}})}function DeleteSchedule(){if(confirm("Are you sure you want to delete this schedule?")){var n=$("#PayPeriod_Id").val();$.ajax({url:path+"Schedule/RemoveSchedule",type:"post",data:{payPeriodId:n}}).done(function(){SetCountDownTime(timeout);$("#submitScheduleViewModel").hide();$("#deleteScheduleViewModel").hide();$("#textOpenShift").attr("disabled","disabled");$("#scheduleInfo").html("")})}}function DoesScheduleForWeekExist(){$.ajax({url:path+"Schedule/DoesScheduleForWeekExist",dataType:"json",cache:!1,type:"POST",data:{communityId:$("#CurrentCommunity").val(),payPeriod:$("#PayPeriod").val()},success:function(n){n.ScheduleWeekExist?GetSchedule():CopySchedule()},error:function(n){alert(n.responseText)}})}function InitSlotEditModal(){var n=$("#SlotEdit"),r=n.width(),u=n.height(),t,i;n.dialog({dialogClass:"",closeOnEscape:!0,modal:!0,open:function(n,t){$(".ui-dialog").css("width","0px");$(".ui-dialog").css("height","0px");$(".ui-dialog").css("top","-10px");$(".ui-dialog").css("left","-10px");$(".ui-dialog-titlebar-close",t.dialog|t).hide()},close:function(){}});n.draggable({disabled:!1});n.dialog("open");t=Math.max($(window).height())/2-n.height()/2;i=Math.max($(window).width())/2-n.width()/2;n.css({top:t,left:i})}function CommunityAndWeekSelected(n){$("#CurrentCommunity").val().length>0&&$("#CurrentCommunity").val()!=-1&&$("#PayPeriod").val().length>0?($("#textOpenShift").show(),$("#submitScheduleViewModel").hide(),$("#deleteScheduleViewModel").hide(),$("#textOpenShift").hide(),$("#coreTable").hide(),n.stopImmediatePropagation(),DoesScheduleForWeekExist()):$("#CurrentCommunity").val().length>0&&$("#CurrentCommunity").val()!=-1&&$("#PayPeriod").val().length==0?($("#textOpenShift").show(),$("#submitScheduleViewModel").hide(),$("#deleteScheduleViewModel").hide(),$("#textOpenShift").hide(),$("copyPreviousPayPeriod").hide(),$("#coreTable").hide()):($("#textOpenShift").hide(),$("#submitScheduleViewModel").hide(),$("#deleteScheduleViewModel").hide(),$("#textOpenShift").hide(),$("copyPreviousPayPeriod").hide(),$("#coreTable").hide())}function UpdateSummaryHours(){SetPPD()}function AddEmployeeHours(n){var t=0;return $.each($("#Employees_"+n).find("[id^='EMP']"),function(n,i){t+=parseFloat($(i).text())}),$("#SummaryTotalHours_"+n).text(t.toFixed(1)),t}function AddSummaryHours(n){for(var i=0,t=0;t<n.length;t++)i+=parseFloat($("#PPDSummaryTotalHours_"+n[t]).text());return i}function CalculatePPD(n){var o=$("[name='payerGroup.AvgDailyCensusCnt']").val().replace(/[^0-9.]/g,""),f,t,i,e,r,u;for($("[name='payerGroup.AvgDailyCensusCnt']").val(o),f=parseFloat($("[name='payerGroup.AvgDailyCensusCnt']").val())*14,t=0,i=0;i<n.length;i++)e=$("[name='"+n[i]+"GenLedger.HourPPDCnt']").val(),$("[name='"+n[i]+"GenLedger.HourPPDCnt']").val(e),t+=parseFloat($("[name='"+n[i]+"GenLedger.HourPPDCnt']").val());n.length==1&&(r=f*t/2,(isNaN(r)||!isFinite(r))&&(r=0),$("#totalHours_"+n[0]).text(r.toFixed(1)));(isNaN(t)||!isFinite(t))&&(t=0);$("#summaryExpectedPPD_"+n.join("_")).text(t.toFixed(2));u=AddSummaryHours(n)/f;(isNaN(u)||!isFinite(u))&&(u=0);$("#summaryActualPPD_"+n.join("_")).text(u.toFixed(2))}function SetPPD(){CalculatePPD(["RN"]);CalculatePPD(["LPN"]);CalculatePPD(["CNA"]);CalculatePPD(["RN","LPN"]);CalculatePPD(["RN","LPN","CNA"])}function TimeHalfHour(n){return n[2]=="3"&&(n=n.replaceAt(2,"5")),parseFloat(n)}function CopySchedule(){var n=$("#PayPeriod").val();$(".modal").hide();$.ajax({url:path+"Schedule/CopyScheduleFromMaster",type:"post",data:{communityId:$("#CurrentCommunity").val(),dateOfWeek:n}}).done(function(n){n.success?(alert("No schedule currently exists for this pay period.  Copying from master."),GetSchedule()):(console.log(n),alert(n.responseText))}).fail(function(n){console.log(n);alert(n)})}function SaveSchedule(n,t){var r=$("#payerGroup_Id").val(),u=$("#payerGroup_AvgDailyCensusCnt").val(),i="";$("[id$='GenLedger_HourPPDCnt']").each(function(n,t){var r=t.id.replace("GenLedger_HourPPDCnt",""),u=t.value;i+=u+";"+r+","});$(".modal").hide();$.ajax({url:path+"Schedule/SaveSchedule",type:"post",data:{payerGroupId:r,dailyCensus:u,ppdInfo:i}}).done(function(){n=$("#tabs").tabs("option","active");SetCountDownTime(timeout);GetSchedule(n,t)}).fail(function(n){alert(n)})}function GetSchedule(n){$(".modal").hide();$.ajax({url:path+"Schedule/GetPayPeriodSchedule",type:"post",data:{communityId:$("#CurrentCommunity").val(),payPeriod:$("#PayPeriod").val()}}).done(function(t){$("#scheduleInfo").html(t);$("#summaryTable").removeClass("NotSaved");$("#tabs").tabs({activate:function(){$("#tabs").tabs("option","active")==0?$("#tabsNursesPPD").show():$("#tabsNursesPPD").hide();$("#tabs").tabs("option","active")==1?$("#tabsCNAPPD").show():$("#tabsCNAPPD").hide()}});n&&$("#tabs").tabs("option","active",n);$("#IsDisabled").val().toLowerCase()!="true"&&($("#submitScheduleViewModel").show(),$("#deleteScheduleViewModel").show(),$(".btnEditSlot").click(EditSlot),$("#textOpenShift").show(),$("#textOpenShift").removeAttr("disabled"));SetScheduleDIVMaxHeight();$("#coreTable").show()}).fail(function(n,t,i){console.log(t);console.log(i)})}function CalculateDayHours(){for(var t,i,r,n=1;n<=14;n++)t=TimeHalfHour($("#startShift"+n).val()),isNaN(t)||t<0?($("#endShift"+n).val("None"),$("#endShift"+n).prop("disabled",!0),$("#hourCount"+n).val(0)):($("#endShift"+n).prop("disabled",!1),i=TimeHalfHour($("#endShift"+n).val()),isNaN(i)||(r=(i-t)/100,i<=t&&(r=24-(t-i)/100),r>=4.5&&(r-=.5),$("#hourCount"+n).val(r)))}function ToggleSendTextNotification(){var n=$("#employee_Selected:checked").closest(".textOpenShiftEmployee"),t=$("#Message").val();t===""||n==null||$(n).length==0?$("#btnTextOpenShift").prop("disabled","disabled"):$("#btnTextOpenShift").prop("disabled","")}function InitSendTextNofication(n){$(document).on("click","#employee_Selected",function(){ToggleSendTextNotification(this)});$(document).on("input","#Message",function(){ToggleSendTextNotification(this)});$(document).on("click","#btnTextOpenShift",function(){var i=[],t=$("#employee_Selected:checked").closest(".textOpenShiftEmployee");$(t)!=null&&$(t).length>0&&$.each($(t),function(n,t){i.push($(t).prop("id"))});var r=$("#CommunityName").val(),u=$("#Message").val(),f=i.join("~");$.ajax({url:path+"Schedule/UpdateTextOpenShift",data:{communityName:r,employeeIds:f,message:u},success:function(t){try{var i=$.parseJSON(t);i.Success&&(alert("Notifications were sent."),$(".modal").hide(),n.hide())}catch(r){}},error:function(n,t,i){alert(i+": "+$(n.responseText).closest("title").text())}})});$(document).on("change","input#jobType_Selected",function(){var t=$("#jobType_Selected:not(:checked)").siblings("input#jobType_JobTypeName"),n;$(t)!=null&&$(t).length>0&&$.each($(t),function(n,t){$("[id$="+$(t).val()+"].textOpenShiftEmployee").find("input.selectEmployee").prop("checked",!1);$("[id$="+$(t).val()+"].textOpenShiftEmployee").hide()});n=$("#jobType_Selected:checked").siblings("input#jobType_JobTypeName");$(n)!=null&&$(n).length>0&&$.each($(n),function(n,t){$("[id$="+$(t).val()+"].textOpenShiftEmployee").show()});ToggleSendTextNotification(this)});$("#textOpenShift").on("click",function(t){t.preventDefault();var i=$("#CurrentCommunity").val(),r=$("#PayPeriod").val();$.ajax({url:path+"Schedule/EditTextOpenShift",data:{communityId:i,payPeriod:r},success:function(t){var i=$("<div />"),r,u;i.addClass("modal");$("body").append(i);n.html(t);ToggleSendTextNotification(this);n.show();r=Math.max($(window).height()/2-n[0].offsetHeight/2,0);u=Math.max($(window).width()/2-n[0].offsetWidth/2,0);n.css({top:r,left:u});textOpenShiftEmployeeTable=$("#TextOpenShiftJobTypeTable",n).dataTable({bFilter:!1,bAutoWidth:!1,sScrollY:"70px",sDom:"frtS",iDisplayLength:-1,aoColumns:[{sWidth:"100px"},{sWidth:"50px",bSortable:!1}],oLanguage:{sEmptyTable:"No Employees"}});textOpenShiftEmployeeTable=$("#TextOpenShiftEmployeeTable",n).dataTable({bFilter:!1,bAutoWidth:!1,sScrollY:"220px",sDom:"frtS",iDisplayLength:-1,aoColumns:[{sWidth:"100px"},{sWidth:"50px",bSortable:!1}],oLanguage:{sEmptyTable:"No Employees"}})},error:function(){alert("Could not communicate with the server.")}})});n.on("click","#close",function(){$(".modal").hide();n.hide()})}var errback,timeout;(function(){for(var t=["assert","cd","clear","count","countReset","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","select","table","time","timeEnd","timeStamp","timeline","timelineEnd","trace","warn"],i=t.length,r=window.console=window.console||{},n,u=function(){};i--;)n=t[i],r[n]||(r[n]=u)})();errback=function(n){console!=null?console.log(n.message):alert("Window.Error: err=="+(n||"null"))};window.onerror=function(n,t,i,r,u){try{u==null?StackTrace.get().then(function(f){ConsoleLogCapture(f,n,t,i,r,u)}).catch(errback):StackTrace.fromError(u||"null").then(function(f){ConsoleLogCapture(f,n,t,i,r,u)}).catch(errback)}catch(f){ConsoleLogCapture(null,n,t,i,r,u)}return!0};timeout=1800;String.prototype.replaceAt=function(n,t){return this.substr(0,n)+t+this.substr(n+t.length)};