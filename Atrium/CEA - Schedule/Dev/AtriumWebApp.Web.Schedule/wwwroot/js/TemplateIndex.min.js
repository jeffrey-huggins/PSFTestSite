function LogErrorToServer(n,t,i){var r=n.map(function(n){return n.toString()||""}).join("\n"),u={severity:encodeURIComponent(t||2)||2,message:encodeURIComponent(i||"")||"",stackTrace:n!=null?encodeURIComponent(r):"NULL"};console.log("LogErrorToServer: msg=="+JSON.stringify(i||""));console.log("LogErrorToServer: stack=="+JSON.stringify(r||""));$.ajax({cache:!1,type:"POST",dataType:"html",contentType:"application/x-www-form-urlencoded; charset=utf-8",url:path+"ScheduleTemplate/LogClientError",data:u,success:function(){SetCountDownTime(timeout);$("div.loading").hide()},error:function(n,t,i){alert("logErrorToServer: ERROR: RC="+n.statusCode+", RT="+n.statusText+", error="+JSON.stringify(t)+", error.text="+i+", data="+n.responseText)}}).always(function(){SetCountDownTime(timeout);$("div.loading").hide()})}function ConsoleLogCapture(n,t,i,r,u){var f="window.onerror: file=="+JSON.stringify(i||"")+"\nwindow.onerror: line, col=="+JSON.stringify(r||"")+", "+JSON.stringify(u||"")+"\nwindow.onerror: msg=="+JSON.stringify(t||"")+"\nwindow.onerror: stack=="+JSON.stringify(n||"");console!=null?(console.log("window.onerror: ============"),console.log(f),console.log("window.onerror: ============")):alert("window.onerror: error=="+(f||"null"))}function SetScheduleDIVMaxHeight(){var n=$(window).innerHeight(),t=n-665;$("[id=scheduleDIV]").css("maxHeight",295+t+"px");$(window).resize(function(){var n=$(window).innerHeight(),t=n-665;$("[id=scheduleDIV]").css("maxHeight",295+t+"px")})}function AddSlot(n,t,i){$.ajax({url:path+"ScheduleTemplate/AddSlot",type:"post",data:{shift:t,generalLedgerId:n}}).done(function(n){var f;$("#SlotEdit").html(n);var e=$("#slotNbr").val(),u=$("#slotId").val(),r=$("#blankRow").html();r=replaceAll(r,"@slot.SlotNbr",e);r=replaceAll(r,"@type",i);r=replaceAll(r,"@shift",t);r=replaceAll(r,"@slot.Id",u);f=$("#"+t+"\\/_"+i);f.find("#slotTd").append(r);$("[slotid='"+u+"']").click(EditSlot);InitSlotEditModal();SetCountDownTime(timeout)})}function replaceAll(n,t,i){return n.replace(new RegExp(t,"g"),i)}function RemoveSlot(n){$.ajax({url:path+"ScheduleTemplate/RemoveSlot",type:"post",data:{slotId:n}}).done(function(){SetCountDownTime(timeout);var t=$($("[slotid='"+n+"']").closest("tr")[0]);t.remove();$("#summaryTable").addClass("NotSaved")})}function CreateEmptySchedule(){$.ajax({url:path+"ScheduleTemplate/CreateEmpty",type:"post",data:{communityId:$("#CurrentCommunity").val()}}).done(function(){GetSchedule()})}function EditSlot(n){globalEvent=n;var t=n.currentTarget.attributes.slotid.value;$.ajax({url:path+"ScheduleTemplate/EditSlot",type:"post",data:{slotId:t}}).done(function(n){$("#SlotEdit").html(n);CalculateDayHours();InitSlotEditModal()})}function CloseEditSlotWindow(){$(".ui-dialog-content").dialog("close")}function GetDailyValues(n){for(var r,u,i="",t=1;t<=14;t++)r=$("#date"+t).val(),u=$("#"+n+t).val(),i+=r+";"+u+",";return i}function SaveSlotEdit(){$("#SlotEdit").hide();CloseEditSlotWindow();var n=$("#slotId").val(),o=$("#slotNbr").val(),r=GetDailyValues("startShift"),u=GetDailyValues("endShift"),f=GetDailyValues("Room"),e=GetDailyValues("hourCount"),t=$("#Employees").val(),i=$("#Employees option:selected").text();$.ajax({cache:!1,type:"POST",contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:"html",url:path+"ScheduleTemplate/SaveSlotEdit",data:{slotId:n,employeeId:t,startShifts:r,endShifts:u,rooms:f,hourCount:e},success:function(){var u=$($("[slotid='"+n+"']").closest("tr")[0]),y=u.closest(".shiftSlotRow")[0].id.split("/")[0],p=u.closest(".shiftSlotRow")[0].id.split("_")[1],h=u.find(".slotEmpNm").attr("employeeid"),w=u.find(".slotEmpNm").text().trim(),b=t,c=null,l,f,r,o;for(h&&(c=parseFloat($("#EMP\\/"+h).val().trim())),l=0,u.find(".slotEmpNm").text(i),i!="Unassigned"?u.removeClass("highlight"):u.addClass("highlight"),f=u.find(".day"),r=1;r<f.length+1;r++){var a=$("#Room"+r+" option:selected").text(),s=$("#startShift"+r+" option:selected"),v=$("#endShift"+r+" option:selected").text(),e=parseFloat($("#hourCount"+r).val());isNaN(e)&&(e=0);o=s.text();s.val()<0&&(o=$("#hourMap-"+s.val()).text(),e=o);$($(f[r-1]).find("label")[0]).text(o);$($(f[r-1]).find("label")[1]).text(v);$($(f[r-1]).find("label")[2]).text(e);$($(f[r-1]).find("label")[3]).text(a)}$("#summaryTable").addClass("NotSaved")},error:function(){document.getElementById("SlotEdit").innerHTML="";$("#SlotEdit").hide()}}).always(function(){$("#SlotEdit").hide();$("div.loading").hide()})}function CurrentPayPeriodDates(){$("#PayPeriod").prop("disabled",!0);$.ajax({cache:!1,type:"GET",contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:"json",url:path+"ScheduleTemplate/CurrentPayPeriodDates",data:{communityId:$("#CurrentCommunity").val()},success:function(n){var t=n;if(t.Success&&t.PayPeriodBeginDates!=undefined&&t.PayPeriodBeginDates.length>0)return PayPeriodDates=t.PayPeriodBeginDates.split(","),$("#PayPeriod").datepicker({beforeShowDay:function(n){var t=$.datepicker.formatDate("yymmdd",n);return $.inArray(t,PayPeriodDates)>-1?[!0]:[!1,""]},showOnFocus:function(){!0}}),InitializeDates(),PayPeriodDates},error:function(n,t,i){alert("CurrentPayPeriodDates: ERROR: data="+n.responseText+", RC="+n.statusCode+", RT="+n.statusText+", error="+JSON.stringify(t)+", error.text="+i)}}).always(function(){$("#PayPeriod").prop("disabled",!0);$("#PayPeriod").removeAttr("disabled")})}function InitializeDates(){$(".isDate").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:-n.offsetHeight+"px",marginLeft:n.offsetWidth+"px"})}})}function DeleteSchedule(){if(confirm("Are you sure you want to delete this schedule?")){var n=$("#PayPeriod_Id").val();$.ajax({url:path+"ScheduleTemplate/DeleteMasterTemplate",type:"post",data:{payPeriodId:n}}).done(function(){SetCountDownTime(timeout);$("#submitScheduleViewModel").hide();$("#deleteScheduleViewModel").hide();$("#scheduleInfo").html("")})}}function ExistingPayPeriodDates(){$.ajax({cache:!1,type:"GET",contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:"json",url:path+"ScheduleTemplate/ExistingPayPeriodDates",data:{communityId:$("#CurrentCommunity").val()},success:function(n){var i=n,f,e,t,r,u;if(i.Success&&i.ExistingPayPeriodBeginDates!=undefined&&i.ExistingPayPeriodBeginDates.length>0){if(existingPayPeriodDates=i.ExistingPayPeriodBeginDates.split(","),existingPayPeriodDates!=null&&existingPayPeriodDates!=undefined&&existingPayPeriodDates.length>0)if(f=moment($("#PayPeriod").val(),"MM/DD/YYYY").format("YYYYMMDD"),$.inArray(f,existingPayPeriodDates)>-1)$(".modal").hide(),$("#copyPreviousPayPeriodModal").hide();else{$("#ExistingPayPeriod").datepicker({beforeShowDay:function(n){var t=$.datepicker.formatDate("yymmdd",n);return $.inArray(t,existingPayPeriodDates)>-1?[!0]:[!1,""]},showOnFocus:function(){!0}});InitializeDates();e=$("#tableCopyPreviousPayPeriodModal");t=$("#copyPreviousPayPeriodModal");$("#payPeriodComm").text($("#CurrentCommunity option:selected").text());t.show();r=Math.max($(window).height())/2-t.height()/2;u=Math.max($(window).width())/2-t.width()/2;e.css({top:r-50,left:u+5});t.css({top:r-50,left:u});$("#ExistingPayPeriod").on("change",function(){$("#ExistingPayPeriod").val()!=""&&CopySchedule();$("#ExistingPayPeriod").val("")});$("#btnContinueDefaultSchedule").on("click",function(){$("#copyPreviousPayPeriodModal").hide();CreateEmptySchedule()});$("#closeCopyPreviousPayPeriodModal").on("click",function(){$("#copyPreviousPayPeriodModal").hide()})}return existingPayPeriodDates}alert("No recent schedules found, loading blank.");CreateEmptySchedule()},error:function(n,t,i){alert("ExistingPayPeriodDates: ERROR: data="+n.responseText+", RC="+n.statusCode+", RT="+n.statusText+", error="+JSON.stringify(t)+", error.text="+i)}})}function CopySchedule(){$("#copyPreviousPayPeriodModal").hide();var n=$("#ExistingPayPeriod").val();$(".modal").hide();$.ajax({url:path+"ScheduleTemplate/CopyExistingSchedule",type:"post",data:{communityId:$("#CurrentCommunity").val(),payPeriodDate:n}}).done(function(){$(".modal").hide();GetSchedule()})}function DoesScheduleExist(){$("#copyPreviousPayPeriodModal").hide();$("#submitScheduleViewModel").hide();$("#deleteScheduleViewModel").hide();$("#coreTable").hide();$("#employeeJobInfo").load(path+"Schedule/GetEmployeeJobs?communityId="+$("#CurrentCommunity").val(),function(){});$.ajax({url:path+"ScheduleTemplate/DoesScheduleForCommunityExist",dataType:"json",cache:!1,type:"POST",data:{communityId:$("#CurrentCommunity").val()},success:function(n){var t=n;t.Success&&t.ScheduleWeekExist<1?ExistingPayPeriodDates():($(".modal").hide(),GetSchedule())},error:function(n){alert(n.responseText)}})}function InitSlotEditModal(){var n=$("#SlotEdit"),r=n.width(),u=n.height(),t,i;n.dialog({dialogClass:"",closeOnEscape:!0,modal:!0,open:function(n,t){$("div.loading").hide();$(".ui-dialog").css("width","0px");$(".ui-dialog").css("height","0px");$(".ui-dialog").css("top","-10px");$(".ui-dialog").css("left","-10px");$(".ui-dialog-titlebar-close",t.dialog|t).hide()},close:function(){$("div.loading").hide()}});n.draggable({disabled:!1});n.dialog("open");t=Math.max($(window).height())/2-n.height()/2;i=Math.max($(window).width())/2-n.width()/2;n.css({top:t,left:i})}function UpdateSummaryHours(){SetPPD()}function AddEmployeeHours(n){var t=0;return $.each($("#Employees_"+n).find("[id^='EMP']"),function(n,i){t+=parseFloat($(i).text())}),$("#SummaryTotalHours_"+n).text(t.toFixed(1)),t}function AddSummaryHours(n){for(var i=0,t=0;t<n.length;t++)i+=parseFloat($("#PPDSummaryTotalHours_"+n[t]).text());return i}function CalculatePPD(n){var o=$("[name='payerGroup.AvgDailyCensusCnt']").val().replace(/[^0-9.]/g,""),r,i,t,u,f,e;for($("[name='payerGroup.AvgDailyCensusCnt']").val(o),r=parseFloat($("[name='payerGroup.AvgDailyCensusCnt']").val())*14,i=0,t=0;t<n.length;t++)u=$("[name='"+n[t]+"GenLedger.HourPPDCnt']").val(),$("[name='"+n[t]+"GenLedger.HourPPDCnt']").val(u),i+=parseFloat($("[name='"+n[t]+"GenLedger.HourPPDCnt']").val());n.length==1&&(f=r*i/2,$("#totalHours_"+n[0]).text(f.toFixed(1)));$("#summaryExpectedPPD_"+n.join("_")).text(i.toFixed(2));e=AddSummaryHours(n)/r;$("#summaryActualPPD_"+n.join("_")).text(e.toFixed(2))}function SetPPD(){CalculatePPD(["RN"]);CalculatePPD(["LPN"]);CalculatePPD(["CNA"]);CalculatePPD(["RN","LPN"]);CalculatePPD(["RN","LPN","CNA"])}function TimeHalfHour(n){return n[2]=="3"&&(n=n.replaceAt(2,"5")),parseFloat(n)}function CalculateDayHours(){for(var t,i,r,n=1;n<=14;n++)t=TimeHalfHour($("#startShift"+n).val()),isNaN(t)||t<0?($("#endShift"+n).val("None"),$("#endShift"+n).prop("disabled",!0),$("#hourCount"+n).val(0)):($("#endShift"+n).prop("disabled",!1),i=TimeHalfHour($("#endShift"+n).val()),isNaN(i)||(r=(i-t)/100,i<=t&&(r=24-(t-i)/100),r>=4.5&&(r-=.5),$("#hourCount"+n).val(r)))}function SaveSchedule(){var t=$("#payerGroup_Id").val(),i=$("#payerGroup_AvgDailyCensusCnt").val(),n="";$("[id$='GenLedger_HourPPDCnt']").each(function(t,i){var r=i.id.replace("GenLedger_HourPPDCnt",""),u=i.value;n+=u+";"+r+","});$(".modal").hide();$.ajax({url:path+"ScheduleTemplate/SaveTemplateSchedule",type:"post",data:{payerGroupId:t,dailyCensus:i,ppdInfo:n}}).done(function(){SetCountDownTime(timeout);selectedTab=$("#tabs").tabs("option","active");GetSchedule(selectedTab)}).fail(function(n,t){alert(t)})}function GetSchedule(n){$.ajax({url:path+"ScheduleTemplate/GetPayPeriodScheduleTemplate",type:"post",data:{communityId:$("#CurrentCommunity").val()}}).done(function(t){$("#scheduleInfo").html(t);$("#tabs").tabs({activate:function(){$("#tabs").tabs("option","active")==0?$("#tabsNursesPPD").show():$("#tabsNursesPPD").hide();$("#tabs").tabs("option","active")==1?$("#tabsCNAPPD").show():$("#tabsCNAPPD").hide()}});n&&$("#tabs").tabs("option","active",n);SetCountDownTime(timeout);$(".modal").hide();$(".btnEditSlot").click(EditSlot);$("#coreTable").show();SetScheduleDIVMaxHeight();$("#submitScheduleViewModel").show();$("#deleteScheduleViewModel").show()})}(function(){for(var t=["assert","cd","clear","count","countReset","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","select","table","time","timeEnd","timeStamp","timeline","timelineEnd","trace","warn"],i=t.length,r=window.console=window.console||{},n,u=function(){};i--;)n=t[i],r[n]||(r[n]=u)})();var errback=function(n){console!=null?console.log(n.message):alert("Window.Error: err=="+(n||"null"))},timeout=1800;window.onerror=function(n,t,i,r,u){try{u==null?StackTrace.get().then(function(f){ConsoleLogCapture(f,n,t,i,r,u)}).catch(errback):StackTrace.fromError(u||"null").then(function(f){ConsoleLogCapture(f,n,t,i,r,u)}).catch(errback)}catch(f){ConsoleLogCapture(null,n,t,i,r,u)}return!0};String.prototype.replaceAt=function(n,t){return this.substr(0,n)+t+this.substr(n+t.length)};