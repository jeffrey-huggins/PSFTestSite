function swapCells(n,t,i,r){var u=t[0],e=n.fnGetPosition(u),f=n.fnGetData(u);f.swap(i,r);n.fnUpdate(f,e)}function UpdateDeficiencyGroup(n,t,i){var r=$(n),u=r.closest("tr").attr("id"),f=r.parents("tr")[0],e=t.fnGetData(f),o=i+u,s=r.val();$.ajax({url:o,dataType:"json",type:"POST",data:{groupId:s},success:function(n){var t=e[0];n.Success||(t+=" could not be moved to ",alert(t))},error:function(){r.val(null);alert("Error communicating with the server.\r\nPlease try again and if you see this message repeatedly the server may be down.")}})}function restoreRow(n,t){for(var r=n.fnGetData(t),u=$(">td",t),i=0,f=u.length;i<f;i++)n.fnUpdate(r[i],t,i,!1)}function editRow(n,t){var r=n.fnGetData(t),i=$(">td",t);i[1].innerHTML='<input type="text" value="'+r[1]+'"/>';i[2].innerHTML='<input type="text" size="6" value="'+r[2]+'"/>';i[3].innerHTML='<a class="edit" href="">Save<\/a> <a class="cancel" href="">Cancel<\/a>'}function PreparePage(){function o(i,r,u){var f=$("input",r),e=path+"MockSurveyAdmin/EditDeficiencyGroup/"+u,o=i.fnGetData(r);$.ajax({url:e,dataType:"json",cache:!1,type:"POST",data:{rowId:u,description:f[0].value,sortOrder:f[1].value},success:function(e){e.Success&&($('.Group option[value="'+u+'"]',o[0]=="Federal"?n:t).text(f[0].value),i.fnUpdate(f[0].value,r,1,!1),i.fnUpdate(f[1].value,r,2,!1),i.fnUpdate('<a class="edit" href="">Edit<\/a>',r,3,!1))},error:function(){alert("Server is not responding. Please reload page and try again")}})}var f=null,r=$("#deficiencyGroups").dataTable({bAutoWidth:!1,sScrollY:"130px",bScrollCollapse:!0,sDom:"frtS",iDisplayLength:-1,aoColumns:[null,null,null,{bSortable:!1},{bSortable:!1}],oLanguage:{sEmptyTable:"No Federal Deficiencies"}}),n,t,s,u,e;r.on("click",".edit",function(n){var t,i,u;n.preventDefault();t=$(this).parents("tr")[0];f!==null&&f!=t?(restoreRow(r,f),editRow(r,t),f=t):f==t&&this.innerHTML=="Save"?(i=$(this).closest("tr").attr("id"),u=o(r,f,i),u&&(f=null)):(editRow(r,t),f=t)});r.on("click","a.cancel",function(n){n.preventDefault();var t=$(this).parents("tr")[0];restoreRow(r,t)});r.on("click",".delete",function(i){if(i.preventDefault(),confirm("Are you sure you want to delete?")){var u=$(this),f=u.parents("tr")[0],e=u.closest("tr").attr("id"),o=r.fnGetData(f),s=path+"MockSurveyAdmin/DeleteDeficiencyGroup/"+e;$.ajax({url:s,dataType:"json",type:"POST",success:function(i){i.Success?($('.Group option[value="'+e+'"]',o[0]=="Federal"?n:t).remove(),r.fnDeleteRow(f)):alert("Server is not responding. Please reload page and try again.")},error:function(){alert("Server is not responding. Please reload page and try again")}})}});$("#NewDeficiencyGroup").on("click",".add-button",function(i){for(var o,s,h=$(this),u=h.parents("form"),c=u.get(0),l=u.serialize(),a=u.find("#Description").val(),v=u.find("#GroupType option:selected").text(),e=r.dataTable().fnGetData(),f=0;f<e.length;f++)if(o=e[f][1],o.toLowerCase()===a.toLowerCase()&&(s=e[f][0],s==v))return alert("Group already exists for this type."),!1;if(!u.valid())return!1;i.preventDefault();$.ajax({url:c.action,type:"POST",data:l,success:function(i){if(i.Success){var u=$("#Description"),f=u.val(),e=$("#GroupType").val(),o='<option value="'+i.Id+'">'+f+"<\/option>",s=r.fnAddData([e,f,0,'<a class="edit" href="">Edit<\/a>','<a class="delete" href="">Delete<\/a>']),h=r.fnSettings().aoData[s[0]].nTr;h.setAttribute("id",i.Id);$(".input-validation-error","#NewDeficiencyGroup").removeClass("input-validation-error");u.val("");$(".Group",e=="Federal"?n:t).append(o)}else $("#NewDeficiencyGroup").html(i)},error:function(){alert("There was an error communicating with the server.\r\nPlease try again and if you see this message repeatedly the server may be down.")}})});n=$("#federalDeficiencies").dataTable({bAutoWidth:!1,sScrollY:"235px",sDom:"frtS",iDisplayLength:-1,aoColumns:[null,{bVisible:!1},{sWidth:"50%"},{bVisible:!1},{sWidth:"50%"},{bSortable:!1}],oLanguage:{sEmptyTable:"No Federal Deficiencies"}});n.fnSort([[0,"asc"]]);n.on("click","a.moreDesc, a.lessDesc",function(t){t.preventDefault();swapCells(n,$(this).parents("tr"),1,2)});n.on("click","a.moreInst, a.lessInst",function(t){t.preventDefault();swapCells(n,$(this).parents("tr"),3,4)});n.on("click",".editInst",function(t){var u,i,f,e;t.preventDefault();var r=$(this).closest("tr"),o=r[0],h=n.fnGetData(o),s=r.attr("id");$("#Id").val(s);$("#Instructions").val(r.data("full-instructions"));$("#RecordType").val("Federal");u=$("<div />");u.addClass("modal");$("body").append(u);i=$("#InstructionsWindow");i.show();f=Math.max($(window).height()/2-i[0].offsetHeight/2,0);e=Math.max($(window).width()/2-i[0].offsetWidth/2,0);i.css({top:f,left:e})});$(".Group",n).change(function(){UpdateDeficiencyGroup(this,n,path+"MockSurveyAdmin/ChangeFederalDeficiencyGroup/")});t=$("#safetyDeficiencies").dataTable({bAutoWidth:!1,sScrollY:"235px",sDom:"frtS",iDisplayLength:-1,aoColumns:[null,{bVisible:!1},{sWidth:"50%"},{bVisible:!1},{sWidth:"50%"},{bSortable:!1}],oLanguage:{sEmptyTable:"No Safety Deficiencies"}});t.fnSort([[0,"asc"]]);t.on("click","a.moreDesc, a.lessDesc",function(n){n.preventDefault();swapCells(t,$(this).parents("tr"),1,2)});t.on("click","a.moreInst, a.lessInst",function(n){n.preventDefault();swapCells(t,$(this).parents("tr"),3,4)});t.on("click",".editInst",function(n){var u,i,f,e;n.preventDefault();var r=$(this).closest("tr"),o=r[0],h=t.fnGetData(o),s=r.attr("id");$("#Id").val(s);$("#Instructions").val(r.data("full-instructions"));$("#RecordType").val("Safety");u=$("<div />");u.addClass("modal");$("body").append(u);i=$("#InstructionsWindow");i.show();f=Math.max($(window).height()/2-i[0].offsetHeight/2,0);e=Math.max($(window).width()/2-i[0].offsetWidth/2,0);i.css({top:f,left:e})});$(".Group",t).change(function(){UpdateDeficiencyGroup(this,t,path+"MockSurveyAdmin/ChangeSafetyDeficiencyGroup/")});$("#InstructionsWindow").on("click","#close",function(){$(".modal").hide();$("#InstructionsWindow").hide();$("#Id").val("");$("#Instructions").val("");$("#RecordType").val("")});$("#InstructionsWindow").on("click","#saveInstructions",function(i){i.preventDefault();var r=$("#InstructionsWindow form"),u=r.serialize();$.ajax({type:r.attr("method"),url:r.attr("action"),data:u,success:function(i){var r,u;if(i.Success){var o=$("#Id").val(),s=$("#RecordType").val(),e=$("#Instructions").val(),f=e+'<a class="editInst float-right" href="">Edit<\/a>';switch(s){case"Federal":r=$("tr#"+o,n);u=r[0];n.fnUpdate(f,u,3,!1);n.fnUpdate(f,u,4,!1);r.data("full-instructions",e);break;case"Safety":r=$("tr#"+o,t);u=r[0];t.fnUpdate(f,u,3,!1);t.fnUpdate(f,u,4,!1);r.data("full-instructions",e)}$("#close").click()}else $("#InstructionsWindow").html(i)},error:function(){alert("Error communicating with the server.  Please try again and if you see this message repeatedly the server may be down.")}})});s=$("#CommunityTable").dataTable({bFilter:!1,bAutoWidth:!1,sScrollY:"400px",sDom:"frtS",iDisplayLength:-1,aoColumns:[null,null,null,{bSearchable:!1,bSortable:!1,sWidth:"20px"},{bSearchable:!1,bSortable:!1,sWidth:"20px"},null],oLanguage:{sEmptyTable:"No Communities"}});$(".checkbox").change(function(){var t=$(this),n=$(this).is(":checked"),i=$(this).attr("id"),r=$(this).parents("tr").children(":first-child").text();$.ajax({url:path+"MockSurveyAdmin/ChangeDataFlgCom",dataType:"json",type:"POST",data:{community:i,dFlag:n,appCode:"MSU"},success:function(i){i.Success||(t.prop("checked",!n),alert("Community has failed to be enabled/disabled. Please try again and if you see this message repeatedly the server may be down."))}})});$(".checkboxReport").change(function(){var t=$(this),n=$(this).is(":checked"),i=$(this).attr("id"),r=$(this).parents("tr").children(":first-child").text();$.ajax({url:path+"MockSurveyAdmin/ChangeReportFlgCom",dataType:"json",type:"POST",data:{community:i,dFlag:n,appCode:"MSU"},success:function(i){i.Success||(t.prop("checked",!n),alert("Community report flag has failed to be enabled/disabled. Please try again and if you see this message repeatedly the server may be down."))}})});u=$("#recipientsModal");$(".manage-recipients").on("click",function(n){n.preventDefault();$.ajax({url:this.href,success:function(n){var t=$("<div />"),i,r;t.addClass("modal");$("body").append(t);u.html(n);u.show();i=Math.max($(window).height()/2-u[0].offsetHeight/2,0);r=Math.max($(window).width()/2-u[0].offsetWidth/2,0);u.css({top:i,left:r});e=$("#recipients",u).dataTable({bFilter:!1,bAutoWidth:!1,sScrollY:"330px",sDom:"frtS",iDisplayLength:-1,aoColumns:[{sWidth:"500px"},{sWidth:"100px",bSortable:!1}],oLanguage:{sEmptyTable:"No Notification Recipients"}})},error:function(){alert("Could not communicate with the server.")}})});u.on("click","#close",function(){$(".modal").hide();u.hide()});u.on("click","#add-notification-recipient",function(n){n.preventDefault();var i=$(this),t=i.closest("form");$.ajax({url:t.attr("action"),type:t.attr("method"),data:t.serialize(),success:function(n){n.Success?(e.fnAddData([$("#EmailAddress").val(),'<a class="delete-recipient" href="'+path+"MockSurveyAdmin/DeleteNotificationRecipient/"+n.Id+'">Delete<\/a>'],!0),alert("Successfully added notification recipient.")):alert("Please ensure the New Notification Recipient is a valid email address.")},error:function(){alert("Could not communicate with the server or duplicate email address entered.")}})});u.on("click",".delete-recipient",function(n){n.preventDefault();var t=$(this);$.ajax({url:this.href,type:"post",success:function(n){if(n.Success){var i=t.closest("tr"),r=i.get(0),u=e.fnGetPosition(r);e.fnDeleteRow(u)}else alert("Unexpected error prevented the record from being deleted.")},error:function(){alert("Could not communicate with the server.")}})});$("#tabs").tabs({activate:function(n,t){var r=t.newPanel.find(".dataTable").filter(function(){return this.id!=""}),u;for(i=0;i<r.length;i++)u=$("#"+r[i].id).dataTable(),u.fnAdjustColumnSizing()}})}function codeExist(n,t,i){var u,r,f;for(i||(i=0),u=t.dataTable().fnGetData(),r=0;r<u.length;r++)if(f=u[r][i],f.toLowerCase()===n.toLowerCase())return!0;return!1}$("#tabs").tabs();$(document).ajaxSend(function(){ShowProgress()});$(document).ajaxComplete(function(){HideProgress()});