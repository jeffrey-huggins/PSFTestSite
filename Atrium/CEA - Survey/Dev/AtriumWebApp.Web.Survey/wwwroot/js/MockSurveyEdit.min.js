function swapCells(n,t,i,r){var u=t[0],e=n.fnGetPosition(u),f=n.fnGetData(u);f.swap(i,r);n.fnUpdate(f,e)}function PreparePage(){var n=$("#deficiencies").dataTable({bAutoWidth:!1,sScrollY:"560px",bScrollCollapse:!0,sDom:"frtS",iDisplayLength:-1,aoColumns:[null,{bVisible:!1},{sWidth:"30%"},{bVisible:!1},{sWidth:"30%"},{bVisible:!1},null,{bVisible:!1},{sWidth:"30%"},{bSortable:!1}],oLanguage:{sEmptyTable:"No Federal Deficiencies"}});n.fnSort([[0,"asc"]]);n.on("click",".create",function(t){var u,i,f,e;t.preventDefault();var r=$(this).closest("tr"),o=r[0],s=r.attr("id"),h=n.fnGetData(o);$("#CitationId").val("");$("#DeficiencyId").val(s);$("#Tag").val(h[0]);$("#Description").val(r.data("full-description"));$("#MockSeverity").val("Finding");$("#FindingDetails").val("");u=$("<div />");u.addClass("modal");$("body").append(u);i=$("#citationWindow");i.show();f=Math.max($(window).height()/2-i[0].offsetHeight/2,0);e=Math.max($(window).width()/2-i[0].offsetWidth/2,0);i.css({top:f,left:e});n.fnAdjustColumnSizing()});n.on("click",".edit",function(t){var f,i,e,o;t.preventDefault();var r=$(this).closest("tr"),s=r[0],h=r.attr("id"),u=n.fnGetData(s);$("#CitationId").val(u[5]);$("#DeficiencyId").val(h);$("#Tag").val(u[0]);$("#Description").val(r.data("full-description"));$("#MockSeverity").val(u[6]);$("#FindingDetails").val(r.data("full-details"));f=$("<div />");f.addClass("modal");$("body").append(f);i=$("#citationWindow");i.show();e=Math.max($(window).height()/2-i[0].offsetHeight/2,0);o=Math.max($(window).width()/2-i[0].offsetWidth/2,0);i.css({top:e,left:o});n.fnAdjustColumnSizing()});n.on("click",".delete",function(t){if(t.preventDefault(),confirm("Are you sure you want to delete this citation?")===!0){var r=$(this).parents("tr"),u=r[0],e=r.attr("id"),i=n.fnGetData(u),f={CitationId:i[5],GroupType:$("#GroupType").val()};$.ajax({url:"../DeleteCitation",dataType:"json",cache:!1,type:"POST",data:f,success:function(t){if(t.Success){var r=n.fnGetPosition(u);i[5]="";i[6]="";i[7]="";i[8]="";i[9]='<button class="create">Create<\/button>';n.fnUpdate(i,r)}else alert("Error: Event not found in database");SetCountDownTime(1800)},error:function(){alert("Server is not responding. Please reload page and try again")}})}});n.on("click","a.moreDesc, a.lessDesc",function(t){t.preventDefault();swapCells(n,$(this).parents("tr"),1,2)});n.on("click","a.moreInst, a.lessInst",function(t){t.preventDefault();swapCells(n,$(this).parents("tr"),3,4)});n.on("click","a.moreDetail, a.lessDetail",function(t){t.preventDefault();swapCells(n,$(this).parents("tr"),7,8)});$("#close").click(function(){$(".modal").hide();$("#citationWindow").hide()});$("#saveCitation").click(function(){var t=$("#SaveCitation"),i=t.serialize(),r=$("#CitationId").val()?"../EditCitation":"../CreateCitation";$.ajax({url:r,dataType:"json",cache:!1,type:"POST",data:i,success:function(t){if(t.Success){var e=$("#DeficiencyId").val(),u=$("#"+e),f=u.get(0),o=n.fnGetPosition(f),i=n.fnGetData(f),r=$("#FindingDetails").val();i[5]=t.Id;i[6]=$("#MockSeverity").val();i[7]=r;i[8]=r;i[9]='<button class="edit">Edit<\/button> <button class="delete">Delete<\/button>';n.fnUpdate(i,o);u.data("full-details",r);alert("Citation has been successfully saved.");$("#close").click()}else alert("Could not successfully save citation. Please reload the page and try again");SetCountDownTime(1800)},error:function(){alert("Server is not responding. Please reload the page and try again")}})});$("#clearCitation").click(function(){$("#MockSeverity").val("Finding");$("#FindingDetails").val("")})}