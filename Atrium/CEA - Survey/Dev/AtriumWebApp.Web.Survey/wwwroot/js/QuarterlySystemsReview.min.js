function PreparePage(n){function r(n){var t=$(n),i=t.data("button-url");ShowProgress();window.location.href=i}function u(){$("#CloseNursingSignature").prop("disabled")||$("#CloseNursingSignature").prop("disabled",!$("#CloseNursing").prop("checked"));$("#CloseDietarySignature").prop("disabled")||$("#CloseDietarySignature").prop("disabled",!$("#CloseDietary").prop("checked"));$(".isDate").datepicker()}function f(n){n=n||new Date;return[1,2,3,4][Math.floor(n.getMonth()/3)]}var t=$("#formContent"),i;$("#ReviewId").length!==1&&t.hide();i=$("#reviewsTable").dataTable({bAutoWidth:!1,sScrollY:"600px",sDom:"rt",iDisplayLength:-1,aaSorting:[[0,"desc"]],aoColumns:[null,{sWidth:"150px"},{sWidth:"150px"},{sWidth:"60px"},{sWidth:"100px"},{sWidth:"100px"},{sWidth:"30px",bSortable:!1},{sWidth:"40px",bSortable:!1}],oLanguage:{sEmptyTable:"No records within this range."}});i.on("click",".delete-link",function(n){var r=$(this);n.preventDefault();confirm("Are you sure you would like to delete this quarterly systems review?")&&(ShowProgress(),$.ajax({url:r.attr("href"),type:"post",success:function(){var n=r.closest("tr"),u=n.get(0),f=i.fnGetPosition(u);i.fnDeleteRow(f);n.attr("id")==$("#ReviewId").val()&&t.hide()},error:function(){alert("Could not communicate with the server.")},complete:function(){HideProgress()}}))});i.on("click",".edit-link",function(n){var i=$(this);n.preventDefault();ShowProgress();$.ajax({url:i.attr("href"),success:function(n){t.html(n);t.show();u()},error:function(){alert("Could not communicate with the server.")},complete:function(){HideProgress()}})});$("#create").click(function(r){var f=$(this),e=f.attr("href")+"/"+$("#CurrentCommunity option:selected").text();r.preventDefault();ShowProgress();$.ajax({type:"post",url:e,success:function(r){t.html(r);t.show();u();var f=$("#ReviewId").val(),e=new Date,o=[e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear(),$("#BeginSampleDate").val(),$("#EndSampleDate").val(),"False","","",'<a class="edit-link" href="'+n+"/Edit/"+f+'">Edit<\/a>','<a class="delete-link" href="'+n+"/Delete/"+f+'">Delete<\/a>'],s=i.fnAddData(o,!0),h=i.fnSettings().aoData[s[0]].nTr;h.setAttribute("id",f)},error:function(){alert("Could not communicate with the server.")},complete:function(){HideProgress()}})});t.on("click",".SectionReviewCriteria",function(n){n.preventDefault();r(this)});t.on("click",".SectionSelectSamples",function(n){n.preventDefault();r(this)});t.on("click","#AdditionalQuestionsReviewCriteria",function(n){n.preventDefault();r(this)});t.on("click","#Save",function(r){r.preventDefault();var f=$("#Review",t),e=f.serialize();ShowProgress();$.ajax({type:f.attr("method"),url:f.attr("action"),data:e,success:function(r){var e,o,s;r.Success?(e=$("#ReviewId",f).val(),o=$("#"+e),o.length>0&&(s=[r.ReviewDate,$("#BeginSampleDate").val(),$("#EndSampleDate").val(),r.IsClosed?"True":"False",r.FormattedNursingClosedDate,r.FormattedDietaryClosedDate,r.IsClosed&&!r.IsAdministrator?"":'<a class="edit-link" href="'+n+"/Edit/"+e+'">Edit<\/a>',r.IsClosed&&!r.IsAdministrator?"":'<a class="delete-link" href="'+n+"/Delete/"+e+'">Delete<\/a>'],i.fnUpdate(s,o[0])),t.hide()):(t.html(r),u())},error:function(){alert("Error communicating with the server.  Please reload and try again.")},complete:function(){HideProgress()}})});t.on("change","#CloseNursing",function(){$("#CloseNursingSignature").prop("disabled",!this.checked)});t.on("change","#CloseDietary",function(){$("#CloseDietarySignature").prop("disabled",!this.checked)});t.on("change","#ReviewDateEntry",function(){var n=new Date($("#ReviewDateEntry").val());$("#ReviewDate").val($("#ReviewDateEntry").val());$("#Quarter").text("Q"+f(n))});$("#CurrentCommunity").change(function(){var n=$("#CurrentCommunity").val();n!=""&&$("#CommunitySelectionForm").submit()});$(".isDate").datepicker();$("#ToDateRangeInvalid").val()=="1"&&alert('Error: Please enter a valid date in the Date Range "To" Field (mm/dd/yyyy)');$("#FromDateRangeInvalid").val()=="1"&&alert('Error: Please enter a valid date in the Date Range "From" Field (mm/dd/yyyy)');$("#ToDateRangeInFuture").val()=="1"&&alert('Error: Please enter a valid date that is not in the future in the Date Range "To" Field');$("#FromDateRangeInFuture").val()=="1"&&alert('Error: Please enter a valid date that is not in the future in the Date Range "From" Field');$("#FromAfterTo").val()=="1"&&alert('Error: You can not have the "From" Date after the "To" Date in the Date Range Fields')}