function InitializeDates(){$(".isDate").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:-n.offsetHeight+"px",marginLeft:n.offsetWidth+"px"})}})}function ApplyUniqueItemIndex(n,t,i){$("td input",n).add("td textarea",n).each(function(){var n=$(this).data("field");this.id=i+"_"+t+"__"+n;this.setAttribute("name",i+"["+t+"]."+n)});$("td select",n).each(function(){var n=$(this).data("field"),u=i+"_"+t+"__",r;n=="SelectedCommunity"&&(r=$(this).val(),this.setAttribute("name",i+"["+t+"]."+n),$("#"+u+"CommunityId").val(r))})}function HideTableIfNoRows(n){var t=$("> tbody > tr",n).length;t==0&&n.hide()}function ShowTable(n){n.fadeIn(1e3)}function isInvalidDate(n){return n!=""&&!ValidateDate(n)}function isInvalidCurrency(n){return n!=""&&!ValidateCurrency(n)}function showDOP(){$(".dopShow").css("visibility","visible");$("#DateDOPStart").removeAttr("disabled");$("#DateDOPEnd").removeAttr("disabled");$("#CurrentSurvey_DOPDailyAmount").removeAttr("disabled")}function hideDOP(){$(".dopShow").css("visibility","hidden");$("#DateDOPStart").attr("disabled","disabled");$("#DateDOPEnd").attr("disabled","disabled");$("#CurrentSurvey_DOPDailyAmount").attr("disabled","disabled")}function showState(){$(".stateShow").css("visibility","visible");$("#CurrentSurvey_StateFineAmount").removeAttr("disabled")}function hideState(){$(".stateShow").css("visibility","hidden");$("#CurrentSurvey_StateFineAmount").attr("disabled","disabled")}function DailyShow(){$(".dailyShow").show();$(".dailyShow input").removeClass("hidden");$(".instanceShow").hide();$(".instanceShow input").addClass("hidden")}function InstanceShow(){$(".instanceShow").show();$(".instanceShow input").removeClass("hidden");$(".dailyShow").hide();$(".dailyShow input").addClass("hidden")}Number.prototype.formatMoney=function(n,t,i){var u=this,n=isNaN(n=Math.abs(n))?2:n,t=t==undefined?".":t,i=i==undefined?",":i,e=u<0?"-":"",f=parseInt(u=Math.abs(+u||0).toFixed(n))+"",r=(r=f.length)>3?r%3:0;return e+(r?f.substr(0,r)+i:"")+f.substr(r).replace(/(\d{3})(?=\d)/g,"$1"+i)+(n?t+Math.abs(u-f).toFixed(n).slice(2):"")};$(document).ready(function(){function h(){var i=$("tr td:first-child",n),t=!1;i.each(function(n,i){t=t||i.innerHTML=="Federal"});t?($(".payer-group").hide(),$(".payer-group-readonly").show()):($(".payer-group").show(),$(".payer-group-readonly").hide())}var s=0,e=$("#survey"),n=$("#CitationsTable").dataTable({bFilter:!1,bAutoWidth:!1,sScrollY:"257px",sDom:"rtS",iDisplayLength:-1,aoColumns:[null,null,{bVisible:!1},null,{bVisible:!1},null,{bVisible:!1},{bSearchable:!1,bSortable:!1,sWidth:"40px"},{bSearchable:!1,bSortable:!1,sWidth:"40px"}],oLanguage:{sEmptyTable:"No citations for the survey"}}),t,c,o,l,r,u,i,f;$("#CitationsTable").on("click","a.edit",function(t){t.preventDefault();var r=$(this).closest("tr").attr("id"),u=$(this).parents("tr")[0],i=n.fnGetData(u);$("#EditingId").val(r);i[0]=="Federal"?($("#NewFederal").click(),$("#FedDef").val(i[2]),$("#SAS").val(i[4]),$("#Comments").val(i[6])):i[0]=="State"?($("#NewState").click(),$("#StateDef").val(i[2]),$("#SASNotRequired").val(i[4]),$("#Comments").val(i[6])):i[0]=="Safety"&&($("#NewSafety").click(),$("#SafetyDef").val(i[2]),$("#SASNotRequired").val(i[4]),$("#Waiver").prop("checked",i[5]=="Yes"),$("#Comments").val(i[6]))});$("#CitationsTable a.delete").on("click",function(t){if(t.preventDefault(),confirm("Are you sure you want to delete?")){var i=$(this).parents("tr")[0],r=$(this).closest("tr").attr("id"),u=n.fnGetData(i);$.post(path+"Survey/DeleteCitation",{citationId:r,citationType:u[0]}).done(function(){n.fnDeleteRow(i);h()})}});$("#CurrentSurvey_AtriumPayerGroupCode").change(function(){var n=$(this),t=n.val(),i=$("#FedDefData"+t).html();$("#FedDef").html(i);$("#ReadonlyPayerGroup").text($("option:selected",n).text())});t=$("#CMPTable").dataTable({bFilter:!1,bAutoWidth:!1,sScrollY:"100px",sDom:"rtS",iDisplayLength:-1,aoColumns:[null,null,null,null,null,{bVisible:!1},{bSearchable:!1,bSortable:!1,sWidth:"40px"},{bSearchable:!1,bSortable:!1,sWidth:"40px"},{bVisible:!1}],oLanguage:{sEmptyTable:"No CMPs for the survey"}});c=null;t.fnSort([[0,"desc"]]);$("#CMPTable").on("click","a.edit",function(n){n.preventDefault();var r=$(this).parents("tr")[0],u=$(this).closest("tr").attr("id"),i=t.fnGetData(r);$("#CMPEditingId").val(u);i[0]=="Yes"&&($("#DateCMPFrom").val(i[2]),$("#DateCMPTo").val(i[3]),DailyShow());i[1]=="Yes"&&($("#DateInstance").val(i[2]),InstanceShow());$("#CMPAmount").val(i[5]);$("#Daily").prop("checked",i[0]=="Yes");$("#Instance").prop("checked",i[1]=="Yes");$("#Discount").prop("checked",i[8]=="Yes")});$("#CMPTable a.delete").on("click",function(n){if(n.preventDefault(),confirm("Are you sure you want to delete?")){var r=$(this).parents("tr")[0],i=$(this).closest("tr").attr("id");$.post(path+"Survey/DeleteCMP",{cmpId:i}).done(function(){t.fnDeleteRow(r);$("#CMPAmountYTD").val("Refresh page to update");$("#CMPEditingId").val()==i&&$("#clearCMP").click()})}});o=$("#SurveyTable").dataTable({bFilter:!1,bAutoWidth:!1,sScrollY:"200px",sDom:"rtS",iDisplayLength:-1,aoColumns:[null,null,null,null,null,null,null,null,null,{bSearchable:!1,bSortable:!1},{bSearchable:!1,bSortable:!1},{bSearchable:!1,bSortable:!1}],oLanguage:{sEmptyTable:"No Surveys for this time period"}});l=null;o.fnSort([[1,"asc"]]);$("#SurveyTable").on("click","a.edit",function(n){n.preventDefault();var i=$(this).closest("tr").attr("id"),t=i.split(" ");ShowProgress();$.post(path+"Survey/ChangeSurveyId",{cycleId:t[0],surveyId:t[1]}).done(function(){window.location.reload()})});$("#SurveyTable a.delete").on("click",function(n){if(n.preventDefault(),confirm("Are you sure you want to delete?")){var i=$(this).parents("tr")[0],r=$(this).closest("tr").attr("id"),t=r.split(" ");$.post(path+"Survey/DeleteSurvey",{cycleId:t[0],surveyId:t[1]}).done(function(){o.fnDeleteRow(i);$("#CurrentSurvey_SurveyCycleId").val()==t[0]&&$("#CurrentSurvey_SurveyId").val()==t[1]&&$.post(path+"Survey/ClearSurvey").done(function(){window.location.reload()})})}});$(function(){$("#DateEntry").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:-n.offsetHeight+"px",marginLeft:n.offsetWidth+"px"})}});$("#Date2567").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:-n.offsetHeight+"px",marginLeft:n.offsetWidth+"px"})}});$("#DateDOP").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:-n.offsetHeight+"px",marginLeft:n.offsetWidth+"px"})}});$("#DateExit").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:-n.offsetHeight+"px",marginLeft:n.offsetWidth+"px"})}});$("#DateCertain").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:-n.offsetHeight+"px",marginLeft:n.offsetWidth+"px"})}});$("#DateTerm").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:-n.offsetHeight+"px",marginLeft:n.offsetWidth+"px"})}});$("#DateFollowUp").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:-n.offsetHeight+"px",marginLeft:n.offsetWidth+"px"})}});$("#DateDOPStart").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:-n.offsetHeight+"px",marginLeft:-n.offsetWidth-178+"px"})}});$("#DateDOPEnd").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:-n.offsetHeight+"px",marginLeft:-n.offsetWidth-178+"px"})}});$("#DateCMPFrom").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:-n.offsetHeight+"px",marginLeft:n.offsetWidth+"px"})}});$("#DateInstance").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:-n.offsetHeight+"px",marginLeft:n.offsetWidth+"px"})}});$("#DateCMPTo").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:-n.offsetHeight+"px",marginLeft:n.offsetWidth+"px"})}});$("#occurredRangeTo").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:"5px",marginLeft:"0px"})}});$("#occurredRangeFrom").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:"5px",marginLeft:"0px"})}})});$(function(){$("#ToDateRangeInvalid").val()=="1"&&alert('Error: Please enter a valid date in the Incident Date Range "To" Field (mm/dd/yyyy)');$("#FromDateRangeInvalid").val()=="1"&&alert('Error: Please enter a valid date in the Incident Date Range "From" Field (mm/dd/yyyy)');$("#ToDateRangeInFuture").val()=="1"&&alert('Error: Please enter a valid date that is not in the future in the Incident Date Range "To" Field');$("#FromDateRangeInFuture").val()=="1"&&alert('Error: Please enter a valid date that is not in the future in the Incident Date Range "From" Field');$("#FromAfterTo").val()=="1"&&alert('Error: You can not have the "From" Date after the "To" Date in the Incident Date Range Fields')});$("#clearSurvey").click(function(){$.post(path+"Survey/ClearSurvey").done(function(){window.location.reload()})});$(".followup").on("click",function(n){n.preventDefault();var i=$(this).closest("tr").attr("id"),t=i.split(" ");$.post(path+"Survey/CreateFollowUp",{cycleId:t[0],surveyId:t[1]}).done(function(){window.location.reload()})});$("#CurrentSurvey_DidNotClearFollowUpFlg").click(function(){$(this).is(":checked")&&confirm("Would you like to save your current form and create a follow up?")&&($("#CreateFollowUp").val("true"),$("#submitSurvey").click())});r=[["DateEntry","Entry Date",!0],["DateExit","Exit Date",!0],["Date2567","2567 Received",!1],["DateCertain","Date Certain",!1],["DateFollowUp","Follow Up Date",!1],["DateDOP","Potential DOP Date",!1],["DateTerm","Potential Term Date",!1],["DateDOPStart","DOP Start Date",!1],["DateDOPEnd","DOP End Date",!1]];u=[["CurrentSurvey_DOPDailyAmount","DOP Daily Amount",!1],["CurrentSurvey_StateFineAmount","State Fine Amount",!1]];$("#submitSurvey").click(function(){for(var f,e,s,i,o=" is a required field.",t=!0,n=0;n<r.length;n++)f=$("#"+r[n][0]).val(),r[n][2]&&f==""&&(alert(r[n][1]+o),t=!1),isInvalidDate(f)&&(alert(r[n][1]+" must be in the format mm/dd/yyyy."),t=!1);for(n=0;n<u.length;n++)e=$("#"+u[n][0]).val(),u[n][2]&&e==""&&(alert(u[n][1]+o),t=!1),isInvalidCurrency(e)&&(alert(u[n][1]+" must be in the format X.XX"),t=!1);s="Documents";$("#surveyDocuments tbody tr").each(function(n){ApplyUniqueItemIndex($(this),n,s)});t&&(i=$("form#SaveMainSurvey"),$.ajax({url:$(i).attr("action"),type:$(i).attr("method"),data:$(i).serialize()}).done(function(){$("form#SaveDocumentsSurvey").submit()}))});i=[["DateCMPFrom","From Date",!0],["DateCMPTo","To Date",!1],["DateInstance","Instance Date",!0]];f=[["CMPAmount","Amount",!0]];$("#submitCMP").click(function(){var c=$("#CurrentSurvey_SurveyCycleId").val(),h,u,n,e;if(c==""){alert("Cannot save a CMP until a survey has been opened or saved.");return}var s=" is a required field.",r=!0;for(n=0;n<i.length;n++)h=$("#"+i[n][0]),u=$("#"+i[n][0]).val(),i[n][2]&&u==""&&!h.hasClass("hidden")&&(alert(i[n][1]+s),r=!1),isInvalidDate(u)&&(alert(i[n][1]+" must be in the format mm/dd/yyyy."),r=!1);for(n=0;n<f.length;n++)e=$("#"+f[n][0]).val(),f[n][2]&&e==""&&(alert(f[n][1]+s),r=!1),isInvalidCurrency(e)&&(alert(f[n][1]+" must be in the format X.XX"),r=!1);if(r){var o=$("#SaveCMP"),l=o.serialize(),a=o.attr("method"),v=o.attr("action");$.ajax({url:v,data:l,type:a,success:function(n){var i,r,u;n.Success?(i=[$("#Daily").prop("checked")?"Yes":"No",$("#Instance").prop("checked")?"Yes":"No",$("#Instance").prop("checked")?$("#DateInstance").val():$("#DateCMPFrom").val(),$("#Instance").prop("checked")?"":$("#DateCMPTo").val(),Number($("#CMPAmount").val()).formatMoney(2),$("#CMPAmount").val(),'<a href="" class="edit">Edit<\/a>','<a href="" class="delete">Delete<\/a>',$("#Discount").prop("checked")?"Yes":"No"],$("#CMPEditingId").val()?t.fnUpdate(i,$("#"+n.Id).get(0)):(r=t.fnAddData(i),u=t.fnGetNodes(r),$(u).attr("id",n.Id)),$("#clearCMP").click()):alert("There was an unexpected error saving the record.  If the happens repeatedly, contact support.")},error:function(){alert("Error communicating with the server.  If this happens repeatedly, contact support.")}})}});$("#clearCMP").click(function(){$("#CMPEditingId").val("");$("#DateCMPFrom").val("");$("#DateCMPTo").val("");$("#DateInstance").val("");$("#CMPAmount").val("");$("#Daily").prop("checked",!0);$("#Instance").prop("checked",!1);DailyShow()});$("#CurrentSurvey_DOPFlg").click(function(){var n=$(this).is(":checked");n?showDOP():hideDOP()});$("#CurrentSurvey_StateFineFlg").click(function(){var n=$(this).is(":checked");n?showState():hideState()});$("#CurrentSurvey_DOPFlg").is(":checked")&&showDOP();$("#CurrentSurvey_StateFineFlg").is(":checked")&&showState();$("#Daily").click(function(){var n=$(this).is(":checked");$("#Instance").prop("checked",!n);n?DailyShow():InstanceShow()});$("#Instance").click(function(){var n=$(this).is(":checked");$("#Daily").prop("checked",!n);n?InstanceShow():DailyShow()});$("#submitCitation").click(function(t){var r;if(t.preventDefault(),r=$("#CurrentSurvey_SurveyCycleId").val(),r=="")alert("Cannot save a Citation until a survey has been opened or saved.");else{var i=$("#SaveCitation"),u=i.serialize(),f=i.attr("method"),e=i.attr("action");$.ajax({url:e,data:u,type:f,success:function(t){var u,f,i,r,e,o;if(t.Success){f=$("#CitationType").val();switch(f){case"Fed":i=$("#FedDef");r=$("#SAS");u=["Federal",$("option:selected",i).text(),i.val(),$("option:selected",r).text(),r.val(),"",$("#Comments").val(),'<a href="" class="edit">Edit<\/a>','<a href="" class="delete">Delete<\/a>'];break;case"Safety":i=$("#SafetyDef");r=$("#SASNotRequired");u=["Safety",$("option:selected",i).text(),i.val(),$("option:selected",r).text(),r.val(),$("#Waiver").prop("checked")?"Yes":"No",$("#Comments").val(),'<a href="" class="edit">Edit<\/a>','<a href="" class="delete">Delete<\/a>'];break;case"State":i=$("#StateDef");r=$("#SASNotRequired");u=["State",$("option:selected",i).text(),i.val(),$("option:selected",r).text(),r.val(),"",$("#Comments").val(),'<a href="" class="edit">Edit<\/a>','<a href="" class="delete">Delete<\/a>']}$("#EditingId").val()?n.fnUpdate(u,$("#"+t.Id).get(0)):(e=n.fnAddData(u),o=n.fnGetNodes(e),$(o).attr("id",t.Id));h();$("#close").click()}else alert("There was an unexpected error saving the record.  If the happens repeatedly, contact support.")},error:function(){alert("Error communicating with the server.  If this happens repeatedly, contact support.")}})}});$("a#NewFederal").on("click",function(n){var i,t,r,u;n.preventDefault();i=$("<div />");i.addClass("modal");$("body").append(i);$("#CitationTitle").html("Federal Citation Form");$("#CitationType").val("Fed");$("#FedDef").show().val($("#FedDef option:first").val());$("#SAS").show().val($("#SAS option:first").val());$(".waiverShow").css("visibility","hidden");$("#Comments").val("");t=$(".Citation");t.show();r=Math.max($(window).height()/2-t[0].offsetHeight/2,0);u=Math.max($(window).width()/2-t[0].offsetWidth/2,0);t.css({top:r,left:u})});$("a#NewState").on("click",function(n){var i,t,r,u;n.preventDefault();i=$("<div />");i.addClass("modal");$("body").append(i);$("#CitationTitle").html("State Citation Form");$("#CitationType").val("State");$("#StateDef").show().val($("#StateDef option:first").val());$("#SASNotRequired").show().val($("#SASNotRequired option:first").val());$(".waiverShow").css("visibility","hidden");$("#Comments").val("");t=$(".Citation");t.show();r=Math.max($(window).height()/2-t[0].offsetHeight/2,0);u=Math.max($(window).width()/2-t[0].offsetWidth/2,0);t.css({top:r,left:u})});$("a#NewSafety").on("click",function(n){var i,t,r,u;n.preventDefault();i=$("<div />");i.addClass("modal");$("body").append(i);$("#CitationTitle").html("Safety Citation Form");$("#CitationType").val("Safety");$("#SafetyDef").show().val($("#SafetyDef option:first").val());$("#SASNotRequired").show().val($("#SASNotRequired option:first").val());$(".waiverShow").css("visibility","visible");$("#Waiver").removeAttr("checked");$("#Comments").val("");t=$(".Citation");t.show();r=Math.max($(window).height()/2-t[0].offsetHeight/2,0);u=Math.max($(window).width()/2-t[0].offsetWidth/2,0);t.css({top:r,left:u})});$(".Citation #close").click(function(){$(".modal").hide();$(".Citation").hide();$("#FedDef").hide();$("#SafetyDef").hide();$("#StateDef").hide();$("#SASNotRequired").hide();$("#SAS").hide();$("#EditingId").val("")});$("#SelectedSurveyType").change(function(){var n=$("option:selected",$(this)).text();n=="Complaint"?$(".IsUnsubstantianted").removeAttr("disabled"):($("input.IsUnsubstantianted").prop("checked",!1),$(".IsUnsubstantianted").attr("disabled",!0))});e.on("click","#addSurveyDocument",function(n){n.preventDefault();$.ajax({url:path+"/Survey/CreateSurveyDocument",success:function(n){var t=$(n),i;ApplyUniqueItemIndex(t,s,"Documents");s++;i=$("#surveyDocuments");$("#surveyDocuments").append(t);InitializeDates();e.off("change","input:file");e.on("change","input:file",function(){var n=$(this),i=$(n).attr("id"),t=$(n).val();$("#surveyDocuments a").each(function(){$(this).text()==t.substring(t.lastIndexOf("\\")+1)&&(alert("Another file with the same name has already been uploaded"),n.replaceWith(n=n.clone(!0)))});$("#surveyDocuments input:file").each(function(){$(this).attr("id")!=i&&$(this).val()==t&&(alert("Another file with the same name has already been selected"),n.replaceWith(n=n.clone(!0)))})});$("button.delete-item",t).attr("class","delete-item");ShowTable($("#surveyDocuments"))},error:function(){alert("Failure communicating with the server.")}})});e.on("click","#surveyDocuments .delete-item",function(n){n.preventDefault();$(this).closest("tr").remove()})});