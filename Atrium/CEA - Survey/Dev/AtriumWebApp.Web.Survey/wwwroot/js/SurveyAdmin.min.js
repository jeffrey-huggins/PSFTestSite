function codeExist(n,t,i){var u,r,f;for(i||(i=0),u=t.dataTable().fnGetData(),r=0;r<u.length;r++)if(f=u[r][i],f.toLowerCase()===n.toLowerCase())return!0;return!1}function restoreRow(n,t){for(var r=n.fnGetData(t),u=$(">td",t),i=0,f=u.length;i<f;i++)n.fnUpdate(r[i],t,i,!1)}function editRow(n,t){var r=n.fnGetData(t),i=$(">td",t);i[0].innerHTML='<input type="text" size="10" value="'+r[0]+'"/>';i[2].innerHTML='<a class="edit" href="">Save<\/a> <a class="cancel" href="">Cancel<\/a>'}function InitSurveyTypes(){var t=$("#SurveyTypes").dataTable({bFilter:!1,bAutoWidth:!1,sScrollY:"400px",sDom:"frtS",iDisplayLength:-1,oLanguage:{sEmptyTable:"No Survey Types"}}),n=null;$("#SurveyTypes").on("click","a.delete",function(n){var i,r,u;(n.preventDefault(),i=confirm("Are you sure you want to delete?"),i)&&(r=$(this).parents("tr")[0],u=$(this).closest("tr").attr("id"),$.ajax({url:path+"SurveyAdmin/DeleteRowSurveyType",dataType:"json",cache:!1,type:"POST",data:{rowId:u},success:function(n){n.Success?t.fnDeleteRow(r):alert("Error: "+n.Message)},error:function(){alert("Server is not responding. Please reload page and try again")}}))});$("#SurveyTypes").on("click","a.edit",function(i){var r,u,f;i.preventDefault();r=$(this).parents("tr")[0];n!==null&&n!=r?(restoreRow(t,n),editRow(t,r),n=r):n==r&&this.innerHTML=="Save"?(u=$(this).closest("tr").attr("id"),f=saveRowSurveyType(t,n,u),f&&(n=null)):(editRow(t,r),n=r)});$("#SurveyTypes").on("click","a.cancel",function(n){n.preventDefault();var i=$(this).parents("tr")[0];restoreRow(t,i)});$("#survey").find("[type='submit']").click(function(n){var i,t;if(n.preventDefault(),i=$("#SurveyType_SurveyTypeDesc").val(),codeExist(i,$("#SurveyTypes").dataTable()))return alert("Survey Type already exists"),!1;if(!$("#survey form").valid())return!1;t=$("#survey form");$.ajax({url:t.attr("action"),dataType:"json",type:"POST",data:t.serialize(),success:function(n){var f,e;if(n.success){var i=n.data.SurveyTypeId,o=n.data.SurveyTypeDesc,r=n.data.ComplaintFlg,u="checked";r||(u="");f=$("#SurveyTypes").dataTable().fnAddData([o,'<input class="checkboxComplaint" id="'+i+'" name="ComplaintFlg" type="checkbox" value="'+r+'" '+u+">",'<a class="edit" href="">Edit<\/a>','<a class="delete" href="">Delete<\/a>']);e=$("#SurveyTypes").dataTable().fnSettings().aoData[f[0]].nTr;e.setAttribute("id",i);t[0].reset()}else alert(n.message)},error:function(){alert("Server is not responding. Please reload page and try again")}})})}function saveRowSurveyType(n,t,i){var r=$("input",t);$.ajax({url:path+"SurveyAdmin/EditRowSurveyType",dataType:"json",cache:!1,type:"POST",data:{rowId:i,description:r[0].value,complaintFlag:r[1].checked},success:function(i){i.Success&&(n.fnUpdate(r[0].value,t,0,!1),n.fnUpdate('<a class="edit" href="">Edit<\/a>',t,2,!1))},error:function(){alert("Server is not responding. Please reload page and try again")}})}function InitSAS(){var t=$("#SAS").dataTable({bFilter:!1,bAutoWidth:!1,sScrollY:"400px",sDom:"frtS",iDisplayLength:-1,oLanguage:{sEmptyTable:"No Scope and Severity"}}),n=null;$("#SAS").on("click","a.delete",function(n){var i,r,u;(n.preventDefault(),i=confirm("Are you sure you want to delete?"),i)&&(r=$(this).parents("tr")[0],u=$(this).closest("tr").attr("id"),$.ajax({url:path+"SurveyAdmin/DeleteRowSAS",dataType:"json",cache:!1,type:"POST",data:{rowId:u},success:function(n){n.Success?t.fnDeleteRow(r):alert("Error: "+n.Message)},error:function(){alert("Server is not responding. Please reload page and try again")}}))});$("#SAS").on("click","a.edit",function(i){var r,u,f;i.preventDefault();r=$(this).parents("tr")[0];n!==null&&n!=r?(restoreRow(t,n),editRow(t,r),n=r):n==r&&this.innerHTML=="Save"?(u=$(this).closest("tr").attr("id"),f=saveRowSAS(t,n,u),f&&(n=null)):(editRow(t,r),n=r)});$("#SAS").on("click","a.cancel",function(n){n.preventDefault();var i=$(this).parents("tr")[0];restoreRow(t,i)});$("#sasCode").find("[type='submit']").click(function(n){n.preventDefault();var t=$("#sasCode form"),i=$("#SASModel_SASCode").val();if(codeExist(i,$("#SAS").dataTable()))return alert("SAS Code already exists"),!1;if(!$("#sasCode form").valid())return!1;$.ajax({url:t.attr("action"),dataType:"json",type:"POST",data:t.serialize(),success:function(n){if(n.success){var i=n.data.SASId,r=n.data.SASCode,u=n.data.Scope,f=n.data.SeverityLevel,e=$("#SAS").dataTable().fnAddData([r,u,f,'<a class="edit" href="">Edit<\/a>','<a class="delete" href="">Delete<\/a>']),o=$("#SAS").dataTable().fnSettings().aoData[e[0]].nTr;o.setAttribute("id",i);t[0].reset()}else alert(n.message)},error:function(){alert("Server is not responding. Please reload page and try again")}})})}function saveRowSAS(n,t,i){var r=$("input",t);$.ajax({url:path+"SurveyAdmin/EditRowSAS",dataType:"json",cache:!1,type:"POST",data:{rowId:i,description:r[0].value},success:function(i){i.Success&&(n.fnUpdate(r[0].value,t,0,!1),n.fnUpdate('<a class="edit" href="">Edit<\/a>',t,1,!1))},error:function(){alert("Server is not responding. Please reload page and try again")}})}function editRowFedDef(n,t){var r=n.fnGetData(t),i=$(">td",t),u=$(i[1]),e=$("#FedDef_Deficiency_AtriumPayerGroupCode").html(),f=$("<select>").attr("id","FedDefPayerGroup").html(e);f.val(u.data("select-value"));i[0].innerHTML='<input type="text" size="10" value="'+r[0]+'"/>';u.empty().append(f);i[2].innerHTML="<textarea>"+r[2]+"<\/textarea>";i[3].innerHTML='<a class="edit" href="">Save<\/a> <a class="cancel" href="">Cancel<\/a>'}function saveRowFedDef(n,t,i){var r=$("#FedDefPayerGroup"),f=$("input",t),e=$("textarea",t),u=n.fnGetData(t);$.ajax({url:path+"SurveyAdmin/EditRowFedDef",dataType:"json",cache:!1,type:"POST",data:{rowId:i,def:f[0].value,payerGroup:r.val(),description:e.val()},success:function(i){if(i.Success){var o=r.parent("td");o.data("select-value",r.val());u=[f[0].value,$("option:selected",r).text(),e.val(),'<a class="edit" href="">Edit<\/a>',u[4]];n.fnUpdate(u,t)}},error:function(){alert("Server is not responding. Please reload page and try again")}})}function InitFedDefs(){var t=$("#FedDefs").dataTable({bFilter:!1,bAutoWidth:!1,sScrollY:"400px",sDom:"frtS",iDisplayLength:-1,aoColumns:[null,null,null,null,null],oLanguage:{sEmptyTable:"No Federal Deficiencies"}}),n=null;$("#FedDefs").on("click","a.delete",function(n){var i,r,u;(n.preventDefault(),i=confirm("Are you sure you want to delete?"),i)&&(r=$(this).parents("tr")[0],u=$(this).closest("tr").attr("id"),$.ajax({url:path+"SurveyAdmin/DeleteRowFedDef",dataType:"json",cache:!1,type:"POST",data:{rowId:u},success:function(n){n.Success?t.fnDeleteRow(r):alert("Error: "+n.Message)},error:function(){alert("Server is not responding. Please reload page and try again")}}))});$("#FedDefs").on("click","a.edit",function(i){var r,u,f;i.preventDefault();r=$(this).parents("tr")[0];n!==null&&n!=r?(restoreRow(t,n),editRowFedDef(t,r),n=r):n==r&&this.innerHTML=="Save"?(u=$(this).closest("tr").attr("id"),f=saveRowFedDef(t,n,u),f&&(n=null)):(editRowFedDef(t,r),n=r)});$("#FedDefs").on("click","a.cancel",function(n){n.preventDefault();var i=$(this).parents("tr")[0];restoreRow(t,i)});$("#fedTags").find("[type='submit']").click(function(n){var i,t;if(n.preventDefault(),i=$("#FedDef_Deficiency_TagCode").val(),codeExist(i,$("#FedDefs").dataTable()))return alert("Federal Tag Code already exists"),!1;if(!$("#fedTags form").valid())return!1;t=$("#fedTags form");$.ajax({url:t.attr("action"),dataType:"json",type:"POST",data:t.serialize(),success:function(n){if(n.success){var u=n.data.Id,f=n.data.TagCode,i=n.data.AtriumPayerGroupCode,e=$("#FedDef_Deficiency_AtriumPayerGroupCode option[value='"+i+"'").text(),o=n.data.Description,s=$("#FedDefs").dataTable().fnAddData([f,e,o,'<a class="edit" href="">Edit<\/a>','<a class="delete" href="">Delete<\/a>']),r=$("#FedDefs").dataTable().fnSettings().aoData[s[0]].nTr;r.setAttribute("id",u);$(r).find("td")[1].setAttribute("data-select-value",i);t[0].reset()}else alert(n.message)},error:function(){alert("Server is not responding. Please reload page and try again")}})})}function InitStateDefs(){var t=$("#StateDefs").dataTable({bFilter:!1,bAutoWidth:!1,sScrollY:"400px",sDom:"frtS",iDisplayLength:-1,aoColumns:[null,null,null,null,null,],oLanguage:{sEmptyTable:"No State Deficiencies"}}),n;t.fnSort([[1,"asc"]]);n=null;$("#StateDefs").on("click","a.delete",function(n){var i,r,u;(n.preventDefault(),i=confirm("Are you sure you want to delete?"),i)&&(r=$(this).parents("tr")[0],u=$(this).closest("tr").attr("id"),$.ajax({url:path+"SurveyAdmin/DeleteRowStateDef",dataType:"json",cache:!1,type:"POST",data:{rowId:u},success:function(n){n.Success?t.fnDeleteRow(r):alert("Error: "+n.Message)},error:function(){alert("Server is not responding. Please reload page and try again")}}))});$("#StateDefs").on("click","a.edit",function(i){var r,u,f;i.preventDefault();r=$(this).parents("tr")[0];n!==null&&n!=r?(restoreRow(t,n),editRowStateDef(t,r),n=r):n==r&&this.innerHTML=="Save"?(u=$(this).closest("tr").attr("id"),f=saveRowStateDef(t,n,u),f&&(n=null)):(editRowStateDef(t,r),n=r)});$("#StateDefs").on("click","a.cancel",function(n){n.preventDefault();var i=$(this).parents("tr")[0];restoreRow(t,i)});$("#stateCode").find("[type='submit']").click(function(n){var i,t;if(n.preventDefault(),i=$("#StateDef_Deficiency_TagCode").val(),codeExist(i,$("#StateDefs").dataTable(),1))return alert("State Code already exists"),!1;if(!$("#stateCode form").valid())return!1;t=$("#stateCode form");$.ajax({url:t.attr("action"),dataType:"json",type:"POST",data:t.serialize(),success:function(n){if(n.success){var t=n.data.Id,i=n.data.StateCode,r=n.data.TagCode,u=n.data.Description,f=$("#StateDefs").dataTable().fnAddData([i,r,u,'<a class="edit" href="">Edit<\/a>','<a class="delete" href="">Delete<\/a>']),e=$("#StateDefs").dataTable().fnSettings().aoData[f[0]].nTr;e.setAttribute("id",t)}else alert(n.message)},error:function(){alert("Server is not responding. Please reload page and try again")}})})}function editRowStateDef(n,t){var u=n.fnGetData(t),r=$(">td",t),i='<select id="StateDefStateCd">';i=i+$("#StateDef_Deficiency_StateCode").html().toString();i=i+"<\/select>";r[0].innerHTML=i;$("#StateDefStateCd").val(u[0]);r[1].innerHTML='<input type="text" size="4" value="'+u[1]+'"/>';r[2].innerHTML="<textarea>"+u[2]+"<\/textarea>";r[3].innerHTML='<a class="edit" href="">Save<\/a> <a class="cancel" href="">Cancel<\/a>'}function saveRowStateDef(n,t,i){var r=$("input",t),u=$("textarea",t),f=$("select",t),e=n.fnGetData(t);$.ajax({url:path+"SurveyAdmin/EditRowStateDef",dataType:"json",cache:!1,type:"POST",data:{rowId:i,stateCd:f[0].value,def:r[0].value,description:u.val()},success:function(i){i.Success&&(n.fnUpdate(f[0].value,t,0,!1),n.fnUpdate(r[0].value,t,1,!1),n.fnUpdate(u.val(),t,2,!1),n.fnUpdate('<a class="edit" href="">Edit<\/a>',t,3,!1))},error:function(){alert("Server is not responding. Please reload page and try again")}})}function InitSafetyDefs(){var t=$("#SafetyDefs").dataTable({bFilter:!1,bAutoWidth:!1,sScrollY:"400px",sDom:"frtS",iDisplayLength:-1,aoColumns:[null,null,null,null,],oLanguage:{sEmptyTable:"No Safety Deficiencies"}}),n=null;$("#SafetyDefs").on("click","a.delete",function(n){var i,r,u;(n.preventDefault(),i=confirm("Are you sure you want to delete?"),i)&&(r=$(this).parents("tr")[0],u=$(this).closest("tr").attr("id"),$.ajax({url:path+"SurveyAdmin/DeleteRowSafetyDef",dataType:"json",cache:!1,type:"POST",data:{rowId:u},success:function(n){n.Success?t.fnDeleteRow(r):alert("Error: "+n.Message)},error:function(){alert("Server is not responding. Please reload page and try again")}}))});$("#SafetyDefs").on("click","a.edit",function(i){var r,u,f;i.preventDefault();r=$(this).parents("tr")[0];n!==null&&n!=r?(restoreRow(t,n),editRowSafetyDef(t,r),n=r):n==r&&this.innerHTML=="Save"?(u=$(this).closest("tr").attr("id"),f=saveRowSafetyDef(t,n,u),f&&(n=null)):(editRowSafetyDef(t,r),n=r)});$("#SafetyDefs").on("click","a.cancel",function(n){n.preventDefault();var i=$(this).parents("tr")[0];restoreRow(t,i)});$("#safetyCodes").find("[type='submit']").click(function(n){var i,t;if(n.preventDefault(),i=$("#SafetyDef_TagCode").val(),codeExist(i,$("#SafetyDefs").dataTable(),1))return alert("Safety Tag Code already exists"),!1;if(!$("#safetyCodes form").valid())return!1;t=$("#safetyCodes form");$.ajax({url:t.attr("action"),dataType:"json",type:"POST",data:t.serialize(),success:function(n){if(n.success){var t=n.data.Id,i=n.data.TagCode,r=n.data.Description,u=$("#SafetyDefs").dataTable().fnAddData([i,r,'<a class="edit" href="">Edit<\/a>','<a class="delete" href="">Delete<\/a>']),f=$("#SafetyDefs").dataTable().fnSettings().aoData[u[0]].nTr;f.setAttribute("id",t)}else alert(n.message)},error:function(){alert("Server is not responding. Please reload page and try again")}})})}function editRowSafetyDef(n,t){var r=n.fnGetData(t),i=$(">td",t);i[0].innerHTML='<input type="text" size="10" value="'+r[0]+'"/>';i[1].innerHTML="<textarea>"+r[1]+"<\/textarea>";i[2].innerHTML='<a class="edit" href="">Save<\/a> <a class="cancel" href="">Cancel<\/a>'}function saveRowSafetyDef(n,t,i){var r=$("input",t),f=n.fnGetData(t),u=$("textarea",t);$.ajax({url:path+"SurveyAdmin/EditRowSafetyDef",dataType:"json",cache:!1,type:"POST",data:{rowId:i,def:r[0].value,description:u.val()},success:function(i){i.Success&&(n.fnUpdate(r[0].value,t,0,!1),n.fnUpdate(u.val(),t,1,!1),n.fnUpdate('<a class="edit" href="">Edit<\/a>',t,2,!1))},error:function(){alert("Server is not responding. Please reload page and try again")}})}function InitCommunity(){var n=$("#CommunityTable").dataTable({bFilter:!1,bAutoWidth:!1,sScrollY:"400px",sDom:"frtS",iDisplayLength:-1,aoColumns:[null,null,null,{bSearchable:!1,bSortable:!1,sWidth:"20px"},{bSearchable:!1,bSortable:!1,sWidth:"20px"}],oLanguage:{sEmptyTable:"No Communities"}});$(".checkbox").click(function(){var t=$(this),n=$(this).is(":checked"),i=$(this).attr("id"),r=$(this).parents("tr").children(":first-child").text();ShowProgress();$.ajax({url:path+"SurveyAdmin/ChangeDataFlgCom",dataType:"json",cache:!1,type:"POST",data:{community:i,dFlag:n,appCode:"CSU"},success:function(i){i.Success||(t.prop("checked",!n),alert("Community has failed to be enabled/disabled. Please try again and if you see this message repeatedly the server may be down."))},complete:function(){HideProgress()}})});$(".checkboxReport").click(function(){var t=$(this),n=$(this).is(":checked"),i=$(this).attr("id"),r=$(this).parents("tr").children(":first-child").text();ShowProgress();$.ajax({url:path+"SurveyAdmin/ChangeReportFlgCom",dataType:"json",cache:!1,type:"POST",data:{community:i,dFlag:n,appCode:"CSU"},success:function(i){i.Success||(t.prop("checked",!n),alert("Community report flag has failed to be enabled/disabled. Please try again and if you see this message repeatedly the server may be down."))},complete:function(){HideProgress()}})});$(".checkboxComplaint").click(function(){var t=$(this),n=$(this).is(":checked"),i=$(this).attr("id"),r=$(this).parents("tr").children(":first-child").text();ShowProgress();$.ajax({url:path+"SurveyAdmin/ChangeComplaintFlgSurvey",dataType:"json",cache:!1,type:"POST",data:{surveyTypeId:i,complaintFlag:n},success:function(i){i.Success||(t.prop("checked",!n),alert("Complaint flag has failed to be enabled/disabled. Please try again and if you see this message repeatedly the server may be down."))},complete:function(){HideProgress()}})})}$(document).ready(function(){$("#tabs").tabs();InitSurveyTypes();InitSAS();InitFedDefs();InitStateDefs();InitSafetyDefs();InitCommunity();$("#tabs").tabs({activate:function(n,t){var r=t.newPanel.find(".dataTable").filter(function(){return this.id!=""}),u;for(i=0;i<r.length;i++)u=$("#"+r[i].id).dataTable(),u.fnAdjustColumnSizing()}});$(".Description #close").click(function(){$(".modal").hide();$(".Description").hide();$("#EditingId").val("");$("#Description").val("");$("#TableName").val("")});$(".Description #saveDescription").click(function(){var i=$("#EditingId").val(),t=$("#TableName").val(),n=$("#"+t+" tr#"+i)[0];switch(t){case"FedDefs":oTableFedDef.fnUpdate($("#Description").val(),n,6,!1);break;case"StateDefs":oTableStateDef.fnUpdate($("#Description").val(),n,6,!1);break;case"SafetyDefs":oTableSafetyDef.fnUpdate($("#Description").val(),n,5,!1)}$(".Description #close").click()})});$("#SaveLookback").validate({rules:{LookbackDays:{required:!0,number:!0}}});$(document).ajaxSend(function(){ShowProgress()});$(document).ajaxComplete(function(){HideProgress()});