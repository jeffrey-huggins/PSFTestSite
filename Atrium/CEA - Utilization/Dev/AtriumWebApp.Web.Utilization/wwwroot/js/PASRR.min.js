function PreparePage(){var n=$("#PatientPASRRTable").dataTable({bFilter:!1,bAutoWidth:!1,sScrollY:"400px",sDom:"rt",iDisplayLength:-1,aoColumns:[null,{aDataSort:[11],sWidth:"50px"},{sWidth:"50px"},{sWidth:"50px"},{sWidth:"75px"},{sWidth:"50px",bVisible:!1},{sWidth:"50px"},{sWidth:"50px"},{sWidth:"50px"},{sWidth:"25px",bSortable:!1},{sWidth:"35px",bSortable:!1},{bVisible:!1}],oLanguage:{sEmptyTable:"No entries during the selected date range."}});n.fnSort([[1,"desc"]]);$("#PatientPASRRTable").on("click","a.edit",function(n){n.preventDefault();var i=$(this).parents("tr")[0],t=$(this).closest("tr").attr("id");$.ajax({url:path+"PASRR/GetPASRRLog",dataType:"json",cache:!1,type:"GET",data:{PASRRLogId:t},success:function(n){LaunchModal(n)},error:function(){alert("Server is not responding. Please reload page and try again")}})});$("#PatientPASRRTable").on("click","a.delete",function(t){var i,r,u;t.preventDefault();i=confirm("Are you sure you want to delete?");i==!0&&(r=$(this).parents("tr")[0],u=$(this).closest("tr").attr("id"),$.ajax({url:path+"PASRR/DeletePASRRLog",cache:!1,type:"POST",data:{pasrrLogId:u},success:function(){n.fnDeleteRow(r)},error:function(){alert("Server is not responding. Please reload page and try again")}}))});$(".isDate").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:-n.offsetHeight+"px",marginLeft:n.offsetWidth+"px"})}});$("#occurredRangeTo, #occurredRangeFrom").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:"5px",marginLeft:"0px"})}});$("#btnCreate").click(function(){LaunchModal()});$("#PASRRType").change(function(){$("#PASRRType").val()==""?$("#btnCreate").prop("disabled",!0):$("#btnCreate").prop("disabled",!1)});$("#CurrentCommunityStateCode").val()=="MI"&&(n.fnSetColumnVis(5,!0),$(".dementiaExemptShow").show());SetupModal()}function SetupModal(){$("#btnSave").click(function(){var n=$("#SavePASRRLog");ValidateForm(n)&&$.ajax({url:path+"PASRR/SavePASRRLog",dataType:"json",cache:!1,traditional:!0,type:"POST",data:n.serialize(),success:function(t){alert("PASRR Record has been successfully saved.");UpdatePatientPASRRTable(n,t);$("#PASRRType").val("");$("#btnClose").click()},error:function(){alert("PASRR Record save failure occurred!")}})});$("#btnClear").click(function(){var n=$("#SavePASRRLog");$("input:text",n).val("");$("input:checkbox",n).prop("checked",!1);$("select",n).val("");$(".hospitalExemptFieldShow",n).hide();$(".levelIIFieldShow",n).hide()});$("#btnClose").click(function(){$(".modal, #popupModal").hide();$("#btnClear").click();$("#modalTitle").text("");$("#PASRRLogId").val("");$("#PASRRTypeId").val("");$(".sigChangeTypeShow").hide();$(".hospitalExemptShow").show()});$("#HospitalExemption").click(function(){var t=$(this).is(":checked"),n;t?($(".hospitalExemptFieldShow").show(),n=$("#CompleteDate").val(),!IsFieldEmpty(n)&&IsDateValid(n)&&$("#HospitalExemptionExpirationDate").val(moment(n).add(30,"days").format("L"))):($(".hospitalExemptFieldShow").hide(),$("#HospitalExemptionExpirationDate").val(""),$("#StayGreaterThan30Days").prop("checked",!1))});$("#LevelIINeeded").click(function(){var n=$(this).is(":checked");n?$(".levelIIFieldShow").show():($(".levelIIFieldShow").hide(),$("#LevelIIRequestedDate").val(""),$("#LevelIICompletedDate").val(""))})}function LaunchModal(n){var i=$("<div />"),t,r,u;i.addClass("modal");$("body").append(i);t=$("#popupModal");t.show();r=Math.max($(window).height()/3-t[0].offsetHeight/3,0);u=Math.max($(window).width()/2-t[0].offsetWidth/2,0);t.css({top:r,left:u});n?($("#modalTitle").text(n.PASRRType.PASRRTypeName),$("#PASRRTypeId").val(n.PASRRTypeId),$("#PASRRLogId").val(n.PASRRLogId),$("#CompleteDate").val(GetDateString(n.CompleteDate)),n.PASRRTypeId==2&&($(".sigChangeTypeShow").show(),$("#SigChangeType").val(n.SigChangeTypeId)),n.PASRRTypeId==3?$(".hospitalExemptShow").hide():($("#HospitalExemption").prop("checked",n.HospitalExemption),n.HospitalExemption&&($(".hospitalExemptFieldShow").show(),$("#HospitalExemptionExpirationDate").val(GetDateString(n.HospitalExemptionExpirationDate)),$("#StayGreaterThan30Days").prop("checked",n.StayGreaterThan30Days))),$("#DementiaExemption").prop("checked",n.DementiaExemption),$("#LevelIINeeded").prop("checked",n.LevelIINeeded),n.LevelIINeeded&&($(".levelIIFieldShow").show(),$("#LevelIIRequestedDate").val(GetDateString(n.LevelIIRequestedDate)),$("#LevelIICompletedDate").val(GetDateString(n.LevelIICompletedDate)))):($("#modalTitle").text($("#PASRRType option:selected").text()),$("#PASRRTypeId").val($("#PASRRType").val()),$("#PASRRTypeId").val()=="2"&&$(".sigChangeTypeShow").show(),$("#PASRRTypeId").val()=="3"&&$(".hospitalExemptShow").hide())}function ValidateForm(n){var t=$("#CompleteDate",n).val(),e,o,f,s,i,h,r,u;if(IsFieldEmpty(t))return alert("Completed Date is a required field."),!1;if(!IsDateValid(t))return alert("Completed Date must be in the format mm/dd/yyyy."),!1;if(IsDateFuture(t))return alert("Completed Date cannot be in the future."),!1;if(e=$("#PASRRTypeId",n).val(),e=="2"&&(o=$("#SigChangeType",n).val(),IsFieldEmpty(o)))return alert("Sig Change Type is a required field."),!1;if(f=$("#HospitalExemption",n).is(":checked"),s=$("#StayGreaterThan30Days",n).is(":checked"),f){if(i=$("#HospitalExemptionExpirationDate",n).val(),IsFieldEmpty(i))return alert("Hospital Exemption Expiration Date is a required field."),!1;if(!IsDateValid(i))return alert("Hospital Exemption Expiration Date must be in the format mm/dd/yyyy."),!1;if(GetDateDiff(t,i)>30)return alert("Hospital Exemption Expiration Date must be no more than 30 after the Completed Date."),!1}if(h=$("#LevelIINeeded",n).is(":checked"),h){if(f&&!s)return alert("Level II is not needed with a Hospital Exemption unless the stay will be greater than 30 days."),!1;if(r=$("#LevelIIRequestedDate",n).val(),!IsFieldEmpty(r)){if(!IsDateValid(r))return alert("Level II Requested Date must be in the format mm/dd/yyyy."),!1;if(IsDateFuture(r))return alert("Level II Requested Date cannot be in the future."),!1}if(u=$("#LevelIICompletedDate",n).val(),!IsFieldEmpty(u)){if(!IsDateValid(u))return alert("Level II Completed Date must be in the format mm/dd/yyyy."),!1;if(IsDateFuture(u))return alert("Level II Completed Date cannot be in the future."),!1}}return!0}function UpdatePatientPASRRTable(n,t){var i=$("#PatientPASRRTable").dataTable(),u=[t.SigChangeTypeId!=-1?t.PASRRType.PASRRTypeName+" - "+t.SigChangeType.SigChangeTypeName:t.PASRRType.PASRRTypeName,GetDateString(t.CompleteDate),t.PASRRTypeId==3?"N/A":t.HospitalExemption?"Yes":"No",IsFieldEmpty(t.HospitalExemptionExpirationDate)?"N/A":GetDateString(t.HospitalExemptionExpirationDate),t.HospitalExemption?t.StayGreaterThan30Days?"Yes":"No":"N/A",t.DementiaExemption?"Yes":"No",t.LevelIINeeded?"Yes":"No",t.LevelIINeeded?IsFieldEmpty(t.LevelIIRequestedDate)?"":GetDateString(t.LevelIIRequestedDate):"N/A",t.LevelIINeeded?IsFieldEmpty(t.LevelIICompletedDate)?"":GetDateString(t.LevelIICompletedDate):"N/A",'<a class="edit" href="">Edit<\/a>','<a class="delete" href="">Delete<\/a>',GetSortableDateString(t.CompleteDate)],s=$("#PASRRLogId",n).val(),r,f,e,o;s!=""?(r=document.getElementById(t.PASRRLogId),r!=null&&(f=i.fnGetPosition(r),i.fnUpdate(u,f),r.setAttribute("id",t.PASRRLogId))):(e=i.fnAddData(u),o=i.fnSettings().aoData[e[0]].nTr,o.setAttribute("id",t.PASRRLogId));i.fnSort([[1,"desc"]])}function IsFieldEmpty(n){return n===""||n===null||n===undefined}function IsDateValid(n){return!IsFieldEmpty(n)&&ValidateDate(n)}function GetDateString(n){if(!IsFieldEmpty(n)){var t=new Date(n),i=t.getUTCMonth()+1,r=t.getUTCDate(),u=t.getFullYear();return i+"/"+r+"/"+u}return""}function GetSortableDateString(n){if(!IsFieldEmpty(n)){var t=new Date(n),i=(t.getMonth()+1).toString().padLeft(2,"0"),r=t.getUTCDate().toString().padLeft(2,"0"),u=t.getFullYear().toString();return u+"-"+i+"-"+r}return""}function GetDateDiff(n,t){return moment(t).diff(moment(n),"days")}var test;String.prototype.padLeft=function(n,t){return Array(n-String(this).length+1).join(t||"0")+this};