function PreparePage(){var n=$("#PatientPELITable").dataTable({bFilter:!1,bAutoWidth:!1,sScrollY:"400px",sDom:"rt",iDisplayLength:-1,aoColumns:[{bVisible:!1},{bVisible:!1},{aDataSort:[2],sWidth:"50px"},{sWidth:"50px"},{sWidth:"75px"},{sWidth:"25px",bSortable:!1}],oLanguage:{sEmptyTable:"No entries during the selected date range."}});n.fnSort([[1,"desc"]]);$("#PatientPELITable").on("click","a.edit",function(n){n.preventDefault();var i=$(this).parents("tr")[0],t=$(this).closest("tr").attr("id");$.ajax({url:path+"PELI/GetPELILog",dataType:"json",cache:!1,type:"GET",data:{PELILogId:t},success:function(n){LaunchModal(n)},error:function(){alert("Server is not responding. Please reload page and try again")}})});$(".isDate").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:-n.offsetHeight+"px",marginLeft:n.offsetWidth+"px"})}});$("#occurredRangeTo, #occurredRangeFrom").datepicker({beforeShow:function(n,t){t.dpDiv.css({marginTop:"5px",marginLeft:"0px"})}});$("#btnCreate").click(function(){LaunchModal()});$("#PELIType").change(function(){$("#PELIType").val()==""?$("#btnCreate").prop("disabled",!0):$("#btnCreate").prop("disabled",!1)});SetupModal()}function SetupModal(){$("#btnSave").click(function(){var n=$("#SavePELILog");ValidateForm(n)&&$.ajax({url:path+"PELI/SavePELILog",dataType:"json",cache:!1,traditional:!0,type:"POST",data:n.serialize(),success:function(t){alert("PELI Record has been successfully saved.");UpdatePatientPELITable(n,t);$("#btnClose").click()},error:function(){alert("PELI Record save failure occurred!")}})});$("#btnClear").click(function(){var n=$("#SavePELILog");$("input:text",n).val("");$("input:checkbox",n).prop("checked",!1);$("select",n).val("")});$("#btnClose").click(function(){$(".modal, #popupModal").hide();$("#btnClear").click();$("#modalTitle").text("");$("#PELILogId").val("");$("#PELITypeId").val("")})}function LaunchModal(n){var i=$("<div />"),t,r,u;i.addClass("modal");$("body").append(i);t=$("#popupModal");t.show();r=Math.max($(window).height()/3-t[0].offsetHeight/3,0);u=Math.max($(window).width()/2-t[0].offsetWidth/2,0);t.css({top:r,left:u});n?($("#modalTitle").text("Add PELI Log for "+$("#PELICurrentResidentName").val()),$("#PELILogId").val(n.PELILogId),$("#PatientId").val(n.PatientId),$("#AdmitDate").val(GetDateString(n.AdmitDate)),$("#CompletedDate").val(GetDateString(n.CompletedDate)),$("#PELITypeModal").find("option").removeAttr("selected").filter("[value="+n.PELITypeId+"]").attr("selected",!0)):($("#modalTitle").text($("#PELIType option:selected").text()),$("#PELILogId").val(""),$("#PatientId").val(n.PatientId),$("#AdmitDate").val(GetDateString(new Date)),$("#CompletedDate").val(GetDateString(new Date)),$("#PELITypeId").val(n.PELITypeId).change())}function ValidateForm(n){var i=$("#AdmitDate",n).val(),t;return IsFieldEmpty(i)?(alert("Admitted Date is a required field."),!1):IsDateValid(i)?IsDateFuture(i)?(alert("Admitted Date cannot be in the future."),!1):(t=$("#CompletedDate",n).val(),t!=""&&!IsDateValid(t))?(alert("Completed Date must be in the format mm/dd/yyyy."),!1):t!=""&&IsDateFuture(t)?(alert("Completed Date cannot be in the future."),!1):!0:(alert("Admitted Date must be in the format mm/dd/yyyy."),!1)}function UpdatePatientPELITable(n,t){var i=$("#PatientPELITable").DataTable(),c=$("#PatientPELITable").find("tr#"+t.PELILogId),s=$("#PELITypeModal option:selected").text(),u=[t.PELILogId,""+t.PatientId,GetDateString(t.AdmitDate),t.CompletedDate!=undefined&&t.CompletedDate.length>0?GetDateString(t.CompletedDate):"",s,'<a class="edit" href="">Edit<\/a>'],h=$("#PELILogId",n).val(),r,f,e,o;h!=""?(r=document.getElementById(t.PELILogId),r!=null&&(f=i.fnGetPosition(r),i.fnUpdate(u,f),r.setAttribute("id",t.PELILogId))):(e=i.fnAddData(u),o=i.fnSettings().aoData[e[0]].nTr,o.setAttribute("id",t.PELILogId));i.fnSort([[1,"desc"]])}function IsFieldEmpty(n){return n===""||n===null||n===undefined}function IsDateValid(n){return!IsFieldEmpty(n)&&ValidateDate(n)}function GetDateString(n){if(!IsFieldEmpty(n)){var t=new Date(n),i=t.getUTCMonth()+1,r=t.getUTCDate(),u=t.getFullYear();return i+"/"+r+"/"+u}return""}function GetSortableDateString(n){if(!IsFieldEmpty(n)){var t=new Date(n),i=(t.getMonth()+1).toString().padLeft(2,"0"),r=t.getUTCDate().toString().padLeft(2,"0"),u=t.getFullYear().toString();return u+"-"+i+"-"+r}return""}function GetDateDiff(n,t){return moment(t).diff(moment(n),"days")}String.prototype.padLeft=function(n,t){return Array(n-String(this).length+1).join(t||"0")+this};