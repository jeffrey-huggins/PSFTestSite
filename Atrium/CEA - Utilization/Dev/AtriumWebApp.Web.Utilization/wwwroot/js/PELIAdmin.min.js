function LookupAdminTable(n){this.editing=null;this.dataTable=$(n).dataTable({bFilter:!1,bAutoWidth:!1,sScrollY:"150px",sDom:"frtS",iDisplayLength:-1,aoColumns:[{sWidth:"200px"},null,{mRender:function(n){var t='<input type="checkbox" name="EnableDisable" class="EnableDisable" value="'+n;return n===!0||n==="True"||n==="true"?t+'" checked="checked" />':t+'" />'}},{bSearchable:!1,bSortable:!1,sWidth:"20px"},{bSearchable:!1,bSortable:!1,sWidth:"20px",bVisible:!1}],oLanguage:{sEmptyTable:"No Records"}});this.restoreRow=function(n){for(var i=this.dataTable.fnGetData(n),r=$(">td",n),t=0,u=r.length;t<u;t++)this.dataTable.fnUpdate(i[t],n,t,!1)};this.editRow=function(n){var i=this.dataTable.fnGetData(n),t=$(">td",n);t[0].innerHTML='<input type="text" size="30" maxlength="30" value="'+i[0]+'"/>';t[1].innerHTML='<input type="text" size="3" value="'+i[1]+'"/>';t[3].innerHTML='<a class="edit" href="">Save<\/a> <a class="cancel" href="">Cancel<\/a>'};this.enableDisable=function(n,t,i){var e=this,u=this.dataTable.fnGetData(n),f=$(".EnableDisable",n),r=f.is(":checked");$.ajax({url:i,dataType:"json",cache:!1,type:"POST",data:{id:t,desc:u[0],order:u[1],allowDataEntry:r},success:function(t){t.Success?e.dataTable.fnUpdate(r,n,2,!1):(f.prop("checked",!r),alert("Record has failed to be enabled/disabled. Please try again and if you see this message repeatedly the server may be down."))}})};this.saveRow=function(n,t,i){var r=this,u=$("input",n),f=$(".EnableDisable",n).is(":checked");$.ajax({url:i,dataType:"json",cache:!1,type:"POST",data:{id:t,desc:u[0].value,order:u[1].value,allowDataEntry:f},success:function(t){t.Success&&(r.dataTable.fnUpdate(u[0].value,n,0,!1),r.dataTable.fnUpdate(u[1].value,n,1,!1),r.dataTable.fnUpdate(f,n,2,!1),r.dataTable.fnUpdate('<a class="edit" href="">Edit<\/a>',n,3,!1))},error:function(){alert("Server is not responding. Please reload page and try again")}})};this.deleteRow=function(n,t,i){var r=this;$.ajax({url:i,dataType:"json",cache:!1,type:"POST",data:{id:t},success:function(t){t.Success?r.dataTable.fnDeleteRow(n):alert("Error: Event not found in database")},error:function(){alert("Server is not responding. Please reload page and try again")}})}}function alreadyExist(n,t,i){var u,r,f;for(i||(i=0),u=t.dataTable().fnGetData(),r=0;r<u.length;r++)if(f=u[r][i],f.toLowerCase()===n.toLowerCase())return!0;return!1}var PELIAdmin=function(){function n(n,t){$(n.dataTable).on("click","a.edit",function(i){var r,u;i.preventDefault();r=$(this).parents("tr")[0];n.editing!==null&&n.editing!=r?(n.restoreRow(nEditing),n.editRow(r),n.editing=r):n.editing==r&&this.innerHTML=="Save"?(u=$(this).closest("tr").attr("id"),n.saveRow(n.editing,u,t),n.editing=null):(n.editRow(r),n.editing=r)})}function t(n,t){$(n.dataTable).on("click","a.delete",function(i){var r,u,f;i.preventDefault();r=confirm("Are you sure you want to delete?");r==!0&&(u=$(this).parents("tr")[0],f=$(this).closest("tr").attr("id"),n.deleteRow(u,f,t))})}function i(n){$(n.dataTable).on("click","a.cancel",function(t){t.preventDefault();var i=$(this).parents("tr")[0];n.restoreRow(i);n.editing=null})}return{setupLookupAdminTable:function(r,u,f){var e=new LookupAdminTable(r);n(e,u);t(e,f);i(e);$(e.dataTable).on("click",".EnableDisable",function(){if(!e.editing){var n=$(this).parents("tr")[0],t=$(this).closest("tr").attr("id");e.enableDisable(n,t,u)}});return e},setupCommunityTable:function(n,t,i){var r=new CommunityAdminTable(n);return r.wireupDisplayUpdateHandler(t),r.wireupReportUpdateHandler(i),r}}}();$(document).ready(function(){$("#tabs").tabs();$("#tabs").tabs({activate:function(n,t){var r=t.newPanel.find(".dataTable").filter(function(){return this.id!=""}),u;for(i=0;i<r.length;i++)u=$("#"+r[i].id).dataTable(),u.fnAdjustColumnSizing()}});$("#newPELIType").click(function(n){n.preventDefault();var t=$("#reasonTab form"),r=$("#Description").val(),i=$("#PELITypes").dataTable();if(alreadyExist(r,i))return alert("Reason already exists"),!1;if(!t.valid())return!1;$.ajax({url:t.attr("action"),dataType:"json",type:"POST",data:t.serialize(),success:function(n){if(n.Success){var r=n.data.Description,u=n.data.Id,f=n.data.SortOrder,e=n.data.DataEntryFlg,o=i.fnAddData([r,f,e,'<a class="edit" href="">Edit<\/a>',""]),s=i.fnSettings().aoData[o[0]].nTr;s.setAttribute("id",u);t[0].reset()}else alert(n.message)},error:function(){alert("Server is not responding. Please reload page and try again")}})});var n=$("#CommunityTable").dataTable({bFilter:!1,bAutoWidth:!1,sScrollY:"400px",sDom:"frtS",iDisplayLength:-1,oLanguage:{sEmptyTable:"No Communities"}});$(".checkbox").click(function(){var t=$(this),n=$(this).is(":checked"),i=$(this).attr("id"),r=$(this).parents("tr").children(":first-child").text();$.ajax({url:path+"/Base/ChangeDataFlgCom",dataType:"json",cache:!1,type:"POST",data:{community:i,dFlag:n,appCode:"PELI"},success:function(i){i.Success||(t.attr("checked",!n),alert("Community has failed to be enabled/disabled. Please try again and if you see this message repeatedly the server may be down."))}})});$("#SaveLookback").validate({rules:{LookbackDays:{required:!0,number:!0}}});PELIAdmin.setupLookupAdminTable("#PELITypes",path+"/PELIAdmin/EditType",path+"/PELIAdmin/DeleteType")});$(document).ajaxSend(function(){ShowProgress()});$(document).ajaxComplete(function(){HideProgress()});