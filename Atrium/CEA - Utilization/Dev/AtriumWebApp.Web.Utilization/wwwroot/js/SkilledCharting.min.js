function PreparePage(){var n=$("#PatientSkilledChartingTable").dataTable({bFilter:!1,bAutoWidth:!1,sScrollY:"300px",sDom:"frtS",iDisplayLength:-1,aoColumns:[{sWidth:"400px"},{bVisible:!1},{bVisible:!1},{sWidth:"50px"},{sWidth:"50px"}],oLanguage:{sEmptyTable:"No Skilled Charting Guidelines for this resident."}});n.fnSort([[1,"asc"],[0,"asc"]]);$("#PatientSkilledChartingTable").on("click","a.edit",function(t){t.preventDefault();var i=$(this).parents("tr")[0],r=$(this).closest("tr").attr("id"),u;$("#EditFlag").val("true");u=r!="-1"?n.fnGetData(i)[2].split(","):n.fnGetData(i)[2].split(";;");LaunchModal(r,u)});$("#PatientSkilledChartingTable").on("click","a.delete",function(t){var i;if(t.preventDefault(),i=confirm("Are you sure you want to delete?"),i==!0){var r=$(this).parents("tr")[0],u=$(this).closest("tr").attr("id"),f=$("#PatientId").val();$.ajax({url:path+"SkilledCharting/DeleteSkilledCharting",cache:!1,type:"POST",data:{patientId:f,guidelineId:u},success:function(){n.fnDeleteRow(r)},error:function(){alert("Server is not responding. Please reload page and try again")}})}});$("#btnCreate").click(function(){var n=$("#Guidelines").val(),t;n!=""&&(t=$("#PatientSkilledChartingTable tr[id='"+n+"']"),t.length>0?$("a.edit",t).click():LaunchModal(n))});SetupModal()}function SetupModal(){$("#btnSave").click(function(){var u=$("#PatientId").val(),t=$("#GuidelineId").val(),i=$("#DocumentationQueues_"+t),r,n={patientId:u,guidelineId:t,documentationQueues:[]};if(t!="-1"?(r=path+"SkilledCharting/SaveSkilledCharting",$("input:checkbox:checked",i).each(function(){var t=$(this).closest("tr").attr("id");n.documentationQueues.push(t)})):(r=path+"SkilledCharting/SaveSkilledChartingCustom",$("input:checkbox:checked",i).each(function(){var i=$(this).closest("tr").attr("id"),t=$("#CustomQueue_"+i).val();t!=""&&n.documentationQueues.push(t)})),n.documentationQueues.length==0){alert("At least one Documentation Queue must be selected.");return}$.ajax({url:r,dataType:"json",cache:!1,traditional:!0,type:"POST",data:n,success:function(n){alert("Skilled Charting Record has been successfully saved.");UpdateGuidelinesTable(i,n);$("#Guidelines").val("");$("#btnClose").click()},error:function(){alert("Skilled Charting Record save failure occurred!")}})});$("#btnClear").click(function(){var t=$("#GuidelineId").val(),n=$("#DocumentationQueues_"+t);$("input:checkbox",n).prop("checked",!1);$("textarea",n).val("")});$("#btnClose").click(function(){$(".modal, #popupModal").hide();$(".docQueueTable").hide();$("#btnClear").click();$("#modalTitle").text("");$("#GuidelineId").val("");$("#EditFlag").val("false")})}function LaunchModal(n,t){var e=$("<div />"),r,u,o,s,h,c,i,f;if(e.addClass("modal"),$("body").append(e),r=$("#popupModal"),r.show(),u=$("#DocumentationQueues_"+n),u.show(),$("#EditFlag").val()=="true"?(o=$("#PatientSkilledChartingTable").dataTable(),s=$("#PatientSkilledChartingTable tr[id='"+n+"']")[0],$("#modalTitle").text(o.fnGetData(s)[0])):$("#modalTitle").text($("#Guidelines option[value='"+n+"']").text()),h=Math.max($(window).height()/3-r[0].offsetHeight/3,0),c=Math.max($(window).width()/2-r[0].offsetWidth/2,0),r.css({top:h,left:c}),$("#GuidelineId").val(n),t)for(i=0;i<t.length;i++)n!="-1"?$("#"+n+"_"+t[i],u).prop("checked",!0):t[i]!=""&&(f=i+1,$("#"+n+"_"+f,u).prop("checked",!0),$("#CustomQueue_"+f).val(t[i]))}function UpdateGuidelinesTable(n,t){var i=$("#PatientSkilledChartingTable").dataTable(),u=[t.Guidline.GuidelineName,t.Guidline.SortOrder,t.DocumentationQueues.toString(),'<a class="edit" href="">Edit<\/a>','<a class="delete" href="">Delete<\/a>'],r,f,e,o;$("#EditFlag").val()=="true"?(r=document.getElementById(t.Guidline.GuidelineId),r!=null&&(f=i.fnGetPosition(r),i.fnUpdate(u,f),r.setAttribute("id",t.Guidline.GuidelineId))):(e=i.fnAddData(u),o=i.fnSettings().aoData[e[0]].nTr,o.setAttribute("id",t.Guidline.GuidelineId));i.fnSort([[1,"asc"],[0,"asc"]])}